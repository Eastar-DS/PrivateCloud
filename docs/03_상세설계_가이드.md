# 상세설계 가이드

## 에이블스택(HCI) 기반 멀티테넌트 프라이빗 클라우드 인프라 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 상세설계 가이드 |
| 버전 | 1.0 |
| 작성일 | 2026-01-30 |
| 목적 | 각 팀이 상세 설계를 수행하기 전 알아야 할 배경지식 정리 |

---

**목차**

1. [설계 영향 요소 (Tier 1~4)](#1-설계-영향-요소-tier-14)
2. [에이블스택 플랫폼 이해](#2-에이블스택-플랫폼-이해)
3. [멀티테넌시 격리 원칙](#3-멀티테넌시-격리-원칙)
4. [Zero Trust 보안 모델](#4-zero-trust-보안-모델)
5. [IaC 가이드](#5-iac-가이드)
6. [참고 자료](#6-참고-자료)

---

## 1. 설계 영향 요소 (Tier 1~4)

본 프로젝트의 설계는 단순 자원 생성이 아닌, **계층화된 설계 영향 요소**를 체계적으로 고려한다.

### 1.1 Tier 구조 개요

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      설계 영향 요소 Tier 구조                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Tier 1: 아키텍처 결정 (전체 구조에 영향)                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  고가용성(HA) | 망분리 | DR/백업 | 멀티테넌시 | 컴플라이언스       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 2: 데이터/처리 특성                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  트랜잭션 | 실시간 처리 | 대용량 데이터 | 수평 확장 | 비동기 처리   │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 3: 보안/접근제어 (횡단 관심사)                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  RBAC | 암호화 | 마이크로세그멘테이션 | Secrets | PKI               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 4: 레이어별 세부 (구현)                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  네트워크(SDN) | 컴퓨트(리소스풀) | 스토리지(SDS) | 운영(IaC)       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 Tier 1: 아키텍처 결정

전체 시스템 구조에 영향을 미치는 최상위 결정 사항.

| 요소 | 설명 | 설계 시 고려 사항 |
|------|------|------------------|
| **고가용성(HA)** | 장애 시에도 서비스 지속 | SPOF 제거, 이중화, 자동 복구 |
| **망분리** | 네트워크 계층 분리 | DMZ/업무망/DB망, VLAN 설계 |
| **DR/백업** | 재해 복구 및 데이터 보호 | RPO/RTO 정의, 복제 전략 |
| **멀티테넌시** | 다수 테넌트 격리 운영 | 네트워크/스토리지/컴퓨트 격리 |
| **컴플라이언스** | 규정 준수 | 감사 로그, 접근 통제 |

### 1.3 Tier 2: 데이터/처리 특성

워크로드 특성에 따른 설계 결정.

| 요소 | 설명 | 영향 받는 설계 |
|------|------|--------------|
| **트랜잭션** | 데이터 무결성 보장 | DB 복제, 동기화 |
| **실시간 처리** | 저지연 요구 | 네트워크 QoS, 캐시 |
| **대용량 데이터** | 대량 저장/처리 | 스토리지 티어링 |
| **수평 확장** | 스케일아웃 필요 | 클러스터 설계 |

### 1.4 Tier 3: 보안/접근제어

모든 계층에 적용되는 횡단 관심사.

| 요소 | 설명 | 적용 범위 |
|------|------|----------|
| **RBAC** | 역할 기반 접근 제어 | 전체 시스템 |
| **암호화** | 전송/저장 데이터 암호화 | 네트워크, 스토리지 |
| **마이크로세그멘테이션** | 워크로드 단위 네트워크 분리 | 네트워크 |
| **Secrets** | 비밀정보 관리 | 애플리케이션, 운영 |
| **PKI** | 인증서 기반 인증 | 인증/인가 |

### 1.5 Tier 4: 레이어별 세부

각 기술 레이어의 구체적인 구현 사항.

| 레이어 | 주요 기술 | 세부 항목 |
|--------|----------|----------|
| **네트워크** | SDN, OVS | L2/L3 설계, VLAN, LB, QoS |
| **컴퓨트** | KVM, 리소스풀 | 하이퍼바이저, Migration, 쿼터 |
| **스토리지** | Ceph, SDS | 복제, 캐시, 스냅샷, 티어링 |
| **운영** | IaC, 모니터링 | Terraform, Ansible, Prometheus |

---

## 2. 에이블스택 플랫폼 이해

### 2.1 ABLESTACK 개요

| 항목 | 내용 |
|------|------|
| **플랫폼** | ABLESTACK HCI (Hyper-Converged Infrastructure) |
| **관리 도구** | Mold (CloudStack 기반) |
| **하이퍼바이저** | KVM |
| **스토리지** | Ceph (분산 스토리지) |
| **네트워크** | OVS (Open vSwitch) |

### 2.2 아키텍처 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ABLESTACK HCI 아키텍처                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        Mold 관리 콘솔                                │  │
│   │   - 웹 기반 관리 UI                                                 │  │
│   │   - VM, 네트워크, 스토리지 관리                                     │  │
│   │   - 테넌트(Account/Domain) 관리                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        HCI 노드 클러스터                             │  │
│   │                                                                     │  │
│   │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐              │  │
│   │   │   노드 1    │   │   노드 2    │   │   노드 3    │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │   KVM   │ │   │ │   KVM   │ │   │ │   KVM   │ │              │  │
│   │   │ │ (VM 호스팅)│ │   │ │ (VM 호스팅)│ │   │ │ (VM 호스팅)│ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │   OVS   │ │   │ │   OVS   │ │   │ │   OVS   │ │              │  │
│   │   │ │(네트워크) │ │   │ │(네트워크) │ │   │ │(네트워크) │ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │  Ceph   │ │   │ │  Ceph   │ │   │ │  Ceph   │ │              │  │
│   │   │ │  (OSD)  │ │   │ │  (OSD)  │ │   │ │  (OSD)  │ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   └─────────────┘   └─────────────┘   └─────────────┘              │  │
│   │                                                                     │  │
│   │         ◄─────────── Ceph 복제 (데이터 분산) ───────────►          │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Mold 관리 도구

Mold는 CloudStack 기반의 관리 플랫폼으로, 다음 기능을 제공한다:

| 기능 | 설명 |
|------|------|
| **인프라 관리** | Zone, Pod, Cluster, Host 관리 |
| **VM 관리** | 인스턴스 생성/삭제/시작/정지 |
| **네트워크 관리** | VLAN, VPC, Security Group |
| **스토리지 관리** | Primary/Secondary Storage, 볼륨 |
| **테넌트 관리** | Domain, Account, User, Project |
| **템플릿/ISO** | VM 템플릿, ISO 이미지 관리 |

### 2.4 KVM 하이퍼바이저

| 항목 | 내용 |
|------|------|
| **역할** | VM 가상화 |
| **관리** | libvirt를 통한 VM 관리 |
| **기능** | Live Migration, Snapshot, 리소스 제한 |

**주요 개념:**
- **호스트(Host)**: VM을 실행하는 물리 서버
- **인스턴스(Instance)**: 실행 중인 VM
- **템플릿(Template)**: VM 생성을 위한 기본 이미지

### 2.5 Ceph 분산 스토리지

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Ceph 아키텍처                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                           Ceph 클러스터                              │  │
│   │                                                                     │  │
│   │   ┌─────────┐   ┌─────────┐   ┌─────────┐                          │  │
│   │   │   MON   │   │   MON   │   │   MON   │  ← Monitor (클러스터 상태)│  │
│   │   └─────────┘   └─────────┘   └─────────┘                          │  │
│   │                                                                     │  │
│   │   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐           │  │
│   │   │   OSD   │   │   OSD   │   │   OSD   │   │   OSD   │           │  │
│   │   │  (SSD)  │   │  (SSD)  │   │  (HDD)  │   │  (HDD)  │           │  │
│   │   │   Hot   │   │   Hot   │   │  Cold   │   │  Cold   │           │  │
│   │   └─────────┘   └─────────┘   └─────────┘   └─────────┘           │  │
│   │                                                                     │  │
│   │   데이터 복제: replica 3 (3중 복제)                                 │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   접근 방식:                                                                │
│   - RBD (Block): VM 디스크                                                 │
│   - CephFS (File): 공유 파일시스템                                         │
│   - RGW (Object): S3 호환 오브젝트 스토리지                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**주요 개념:**
- **MON (Monitor)**: 클러스터 상태 관리, Quorum 유지
- **OSD (Object Storage Daemon)**: 실제 데이터 저장
- **Pool**: 논리적 스토리지 그룹
- **CRUSH Map**: 데이터 배치 규칙

### 2.6 OVS (Open vSwitch)

| 항목 | 내용 |
|------|------|
| **역할** | 가상 네트워크 스위치 |
| **기능** | VLAN, VXLAN, 트래픽 제어 |
| **통합** | OpenFlow 지원, SDN 연동 |

---

## 3. 멀티테넌시 격리 원칙

### 3.1 격리의 4계층

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        멀티테넌시 격리 4계층                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 1: 네트워크 격리                                              │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - 테넌트별 전용 VLAN 할당                                          │  │
│   │  - 마이크로세그멘테이션으로 East-West 트래픽 차단                   │  │
│   │  - 공용 서비스 접근은 API Gateway 경유만 허용                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 2: 스토리지 격리                                              │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - 테넌트별 Ceph Pool 분리                                          │  │
│   │  - 쿼터 기반 용량 제한                                              │  │
│   │  - 스냅샷/백업 테넌트별 분리                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 3: 컴퓨트 격리                                                │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - 테넌트별 리소스 쿼터 (vCPU, Memory)                              │  │
│   │  - Affinity/Anti-Affinity 규칙                                      │  │
│   │  - 전용 호스트 옵션 (민감 워크로드용)                               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 4: 접근제어 격리                                              │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - RBAC: 플랫폼관리자 / 테넌트관리자 / 사용자                       │  │
│   │  - 테넌트 A 관리자는 테넌트 B 리소스 접근 불가                      │  │
│   │  - 감사 로그 테넌트별 분리                                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 격리 원칙

| 원칙 | 설명 | 적용 |
|------|------|------|
| **기본 차단** | 테넌트 간 통신은 기본 차단 | 네트워크 정책 |
| **명시적 허용** | 허용된 통신만 명시적으로 개방 | 방화벽 규칙 |
| **최소 권한** | 필요한 최소 권한만 부여 | RBAC |
| **감사 추적** | 모든 접근 기록 | 로깅 |

### 3.3 테넌트 구조 (Mold)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Mold 테넌트 구조                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ROOT Domain (최상위)                                                      │
│   │                                                                         │
│   ├── Domain: TenantA (A시청)                                              │
│   │   ├── Account: admin-a (테넌트 관리자)                                 │
│   │   ├── Account: user-a1 (일반 사용자)                                   │
│   │   └── Account: user-a2 (일반 사용자)                                   │
│   │                                                                         │
│   ├── Domain: TenantB (B구청)                                              │
│   │   ├── Account: admin-b (테넌트 관리자)                                 │
│   │   └── Account: user-b1 (일반 사용자)                                   │
│   │                                                                         │
│   └── Domain: TenantC (C군청)                                              │
│       ├── Account: admin-c (테넌트 관리자)                                 │
│       └── Account: user-c1 (일반 사용자)                                   │
│                                                                             │
│   리소스 격리:                                                              │
│   - 각 Domain은 독립된 VLAN, 스토리지 Pool, 쿼터 할당                       │
│   - Domain 간 리소스 접근 불가                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Zero Trust 보안 모델

### 4.1 Zero Trust 원칙

> **"신뢰하지 않고 항상 검증한다 (Never Trust, Always Verify)"**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Zero Trust 아키텍처                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                       ┌─────────────────┐                                  │
│                       │    접근 요청    │                                  │
│                       └────────┬────────┘                                  │
│                                │                                            │
│                                ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     1. 신원 확인 (Who)                               │  │
│   │   - 사용자/서비스 인증                                               │  │
│   │   - MFA (관리자 필수)                                                │  │
│   │   - 인증서 기반 인증 (mTLS)                                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                │                                            │
│                                ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     2. 장치 검증 (What)                              │  │
│   │   - 장치 상태 확인                                                   │  │
│   │   - 보안 패치 상태                                                   │  │
│   │   - 네트워크 위치                                                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                │                                            │
│                                ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     3. 접근 권한 확인 (How)                          │  │
│   │   - RBAC 기반 권한 확인                                              │  │
│   │   - 최소 권한 원칙                                                   │  │
│   │   - 컨텍스트 기반 접근 제어                                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                │                                            │
│                                ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     4. 지속적 모니터링                               │  │
│   │   - 세션 검증                                                        │  │
│   │   - 이상 행위 탐지                                                   │  │
│   │   - 감사 로깅                                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                │                                            │
│                                ▼                                            │
│                       ┌─────────────────┐                                  │
│                       │    접근 허용    │                                  │
│                       └─────────────────┘                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 RBAC (Role-Based Access Control)

| 역할 | 권한 | 대상 |
|------|------|------|
| **플랫폼 관리자** | 전체 시스템 관리, 테넌트 생성/삭제 | 인프라 관리자 |
| **테넌트 관리자** | 자기 테넌트 내 리소스 관리, 사용자 관리 | 기관 담당자 |
| **일반 사용자** | 할당된 리소스 사용 (읽기/실행) | 기관 직원 |
| **감사자** | 로그 조회 (읽기 전용) | 보안 담당자 |

### 4.3 암호화 체계

| 구간 | 암호화 방식 | 적용 |
|------|-----------|------|
| **전송 중** | TLS 1.3 | 모든 네트워크 통신 |
| **저장 시** | AES-256 | 스토리지 데이터 |
| **키 관리** | Vault 등 KMS | 암호화 키 중앙 관리 |

---

## 5. IaC 가이드

### 5.1 IaC 도구

| 도구 | 용도 | 적용 범위 |
|------|------|----------|
| **Terraform** | 인프라 프로비저닝 | VM, 네트워크, 스토리지 생성 |
| **Ansible** | 구성 관리 | OS 설정, 패키지 설치, 앱 배포 |
| **Git** | 버전 관리 | 모든 IaC 코드 |

### 5.2 Terraform 구조

```
terraform/
├── modules/
│   ├── compute/              # VM 생성 모듈
│   │   ├── main.tf           # 리소스 정의
│   │   ├── variables.tf      # 입력 변수
│   │   └── outputs.tf        # 출력 변수
│   │
│   ├── network/              # 네트워크 모듈
│   │   ├── vlan.tf           # VLAN 정의
│   │   ├── firewall.tf       # 방화벽 규칙
│   │   └── loadbalancer.tf   # 로드밸런서
│   │
│   ├── storage/              # 스토리지 모듈
│   │   ├── pool.tf           # 스토리지 풀
│   │   └── quota.tf          # 쿼터 설정
│   │
│   └── tenant/               # 테넌트 모듈
│       ├── main.tf           # 테넌트 프로비저닝
│       └── rbac.tf           # 권한 설정
│
├── environments/
│   ├── dev/                  # 개발 환경
│   │   ├── main.tf
│   │   └── terraform.tfvars
│   │
│   └── prod/                 # 운영 환경
│       ├── main.tf
│       └── terraform.tfvars
│
└── main.tf                   # 루트 모듈
```

### 5.3 Terraform 작성 원칙

| 원칙 | 설명 |
|------|------|
| **모듈화** | 재사용 가능한 모듈로 분리 |
| **상태 관리** | 원격 백엔드로 상태 파일 관리 |
| **변수화** | 하드코딩 대신 변수 사용 |
| **버전 관리** | 프로바이더/모듈 버전 명시 |

### 5.4 Ansible 구조

```
ansible/
├── inventory/
│   ├── dev.yml               # 개발 환경 인벤토리
│   └── prod.yml              # 운영 환경 인벤토리
│
├── playbooks/
│   ├── base-setup.yml        # 기본 OS 설정
│   ├── monitoring-agent.yml  # 모니터링 에이전트
│   ├── security-hardening.yml# 보안 강화
│   └── app-deploy.yml        # 애플리케이션 배포
│
├── roles/
│   ├── common/               # 공통 설정
│   ├── prometheus-exporter/  # Prometheus 에이전트
│   ├── filebeat/             # 로그 수집
│   └── hardening/            # 보안 강화
│
└── ansible.cfg               # Ansible 설정
```

### 5.5 Ansible 작성 원칙

| 원칙 | 설명 |
|------|------|
| **멱등성** | 여러 번 실행해도 동일한 결과 |
| **역할 분리** | 기능별 Role로 분리 |
| **변수 우선순위** | inventory < playbook < role < task |
| **비밀정보 관리** | Ansible Vault 사용 |

---

## 6. 참고 자료

### 6.1 공식 문서

| 기술 | 문서 링크 |
|------|----------|
| **ABLESTACK** | 에이블스택 공식 문서 |
| **CloudStack** | https://docs.cloudstack.apache.org/ |
| **Ceph** | https://docs.ceph.com/ |
| **KVM** | https://www.linux-kvm.org/page/Documents |
| **Terraform** | https://developer.hashicorp.com/terraform/docs |
| **Ansible** | https://docs.ansible.com/ |

### 6.2 학습 키워드

**컴퓨트 팀:**
```
KVM, libvirt, QEMU, vCPU, Memory overcommit
Resource Pool, Affinity, Anti-Affinity
Live Migration, HA, Fault Domain
Cloud-init, VM Template
```

**네트워크/보안 팀:**
```
VLAN, VXLAN, OVS, SDN
Security Group, Firewall, iptables
Zero Trust, RBAC, ABAC
TLS, PKI, mTLS
마이크로세그멘테이션, East-West 트래픽
```

**스토리지 팀:**
```
Ceph, OSD, MON, CRUSH Map
Pool, Replication, Erasure Coding
Tiering, Hot/Warm/Cold
RBD, CephFS, RGW
Snapshot, Backup, DR
RPO, RTO
```

### 6.3 본 프로젝트 관련 문서

- [01_프로젝트_개요서.md](01_프로젝트_개요서.md)
- [02_팀_역할분담.md](02_팀_역할분담.md)
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md)
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md)
- [06_스토리지_설계서.md](06_스토리지_설계서.md)
