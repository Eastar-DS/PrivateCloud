# 상세설계 가이드

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 상세설계 가이드 |
| 버전 | 7.0 |
| 작성일 | 2026-02-10 |
| 목적 | 각 팀이 상세 설계를 수행하기 전 알아야 할 배경지식 정리 |

---

**목차**

1. [설계 영향 요소 (Tier 1~4)](#1-설계-영향-요소-tier-14)
2. [에이블스택 플랫폼 이해](#2-에이블스택-플랫폼-이해)
3. [부서 격리 원칙](#3-부서-격리-원칙)
4. [AI 워크로드 인프라](#4-ai-워크로드-인프라)
5. [접근 제어 모델](#5-접근-제어-모델)
6. [IaC 가이드](#6-iac-가이드)
7. [참고 자료](#7-참고-자료)

---

## 1. 설계 영향 요소 (Tier 1~4)

본 프로젝트의 설계는 단순 자원 생성이 아닌, **계층화된 설계 영향 요소**를 체계적으로 고려한다.

### 1.1 Tier 구조 개요

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      설계 영향 요소 Tier 구조                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Tier 1: 아키텍처 결정 (전체 구조에 영향)                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  고가용성(HA) | 망분리 | DR/백업 | RBAC 부서 격리 | 컴플라이언스    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 2: 데이터/처리 특성                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  비동기 처리 | 문서 저장 | 대용량 데이터 | 수평 확장 | AI 추론      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 3: 보안/접근제어 (횡단 관심사)                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  RBAC | 암호화 | 마이크로세그멘테이션 | 감사 로깅 | 기존 인증 연동  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   Tier 4: 레이어별 세부 (구현)                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  네트워크(SDN) | 컴퓨트(리소스풀) | 스토리지(SDS) | 운영(IaC)          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 Tier 1: 아키텍처 결정

전체 시스템 구조에 영향을 미치는 최상위 결정 사항.

| 요소 | 설명 | 설계 시 고려 사항 |
|------|------|------------------|
| **고가용성(HA)** | 장애 시에도 서비스 지속 | SPOF 제거, 이중화, 자동 복구 |
| **망분리** | 네트워크 계층 분리 | DMZ/백엔드/AI/DB/스토리지/관리, 6-VLAN 설계 |
| **DR/백업** | 재해 복구 및 데이터 보호 | RPO/RTO 정의, 복제 전략 |
| **부서 격리** | 앱 레벨 RBAC 기반 부서 격리 | Hibernate @Filter, NFS 디렉토리 분리 |
| **컴플라이언스** | 규정 준수 | 감사 로그, 접근 통제 |

### 1.3 Tier 2: 데이터/처리 특성

워크로드 특성에 따른 설계 결정.

| 요소 | 설명 | 영향 받는 설계 |
|------|------|--------------|
| **비동기 처리** | 문서 업로드와 태깅 분리 | RabbitMQ, Spring AMQP Consumer |
| **문서 저장** | 다양한 형식 문서 저장 | NFS 파일 스토리지, 메타데이터 |
| **대용량 데이터** | 대량 문서 저장/처리 | 스토리지 티어링 |
| **수평 확장** | 스케일아웃 필요 | 클러스터 설계 |
| **AI 추론** | 모델 기반 태깅 | OCR FastAPI(:8001), 태깅 FastAPI(:8000) — Stateless |

### 1.4 Tier 3: 보안/접근제어

모든 계층에 적용되는 횡단 관심사.

| 요소 | 설명 | 적용 범위 |
|------|------|----------|
| **RBAC** | 역할 기반 접근 제어 | 전체 시스템 |
| **암호화** | 전송/저장 데이터 암호화 | 네트워크, 스토리지 |
| **마이크로세그멘테이션** | 워크로드 단위 네트워크 분리 | 네트워크 |
| **감사 로깅** | 모든 접근 및 작업 기록 | 전체 시스템 |
| **기존 인증 연동** | 내부 인증 체계 연동 전제 | 인증/인가 |

### 1.5 Tier 4: 레이어별 세부

각 기술 레이어의 구체적인 구현 사항.

| 레이어 | 주요 기술 | 세부 항목 |
|--------|----------|----------|
| **네트워크** | SDN, OVS | L2/L3 설계, VLAN, LB, QoS |
| **컴퓨트** | KVM, 리소스풀 | 하이퍼바이저, Migration, 쿼터 |
| **스토리지** | Ceph, SDS | 복제, 캐시, 스냅샷, 티어링 |
| **운영** | IaC, 모니터링 | Terraform, Ansible, ABLESTACK Mold |

---

## 2. 에이블스택 플랫폼 이해

### 2.1 ABLESTACK 개요

| 항목 | 내용 |
|------|------|
| **플랫폼** | ABLESTACK HCI (Hyper-Converged Infrastructure) |
| **관리 도구** | Mold (CloudStack 기반) |
| **하이퍼바이저** | KVM |
| **스토리지** | Ceph (분산 스토리지) |
| **네트워크** | OVS (Open vSwitch) |

### 2.2 아키텍처 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ABLESTACK HCI 아키텍처                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        Mold 관리 콘솔                                │  │
│   │   - 웹 기반 관리 UI                                                 │  │
│   │   - VM, 네트워크, 스토리지 관리                                     │  │
│   │   - 테넌트(Account/Domain) 관리                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                        HCI 노드 클러스터                             │  │
│   │                                                                     │  │
│   │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐              │  │
│   │   │   노드 1    │   │   노드 2    │   │   노드 3    │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │   KVM   │ │   │ │   KVM   │ │   │ │   KVM   │ │              │  │
│   │   │ │ (VM 호스팅)│ │   │ │ (VM 호스팅)│ │   │ │ (VM 호스팅)│ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │   OVS   │ │   │ │   OVS   │ │   │ │   OVS   │ │              │  │
│   │   │ │(네트워크) │ │   │ │(네트워크) │ │   │ │(네트워크) │ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   │ ┌─────────┐ │   │ ┌─────────┐ │   │ ┌─────────┐ │              │  │
│   │   │ │  Ceph   │ │   │ │  Ceph   │ │   │ │  Ceph   │ │              │  │
│   │   │ │  (OSD)  │ │   │ │  (OSD)  │ │   │ │  (OSD)  │ │              │  │
│   │   │ └─────────┘ │   │ └─────────┘ │   │ └─────────┘ │              │  │
│   │   └─────────────┘   └─────────────┘   └─────────────┘              │  │
│   │                                                                     │  │
│   │         ◄─────────── Ceph 복제 (데이터 분산) ───────────►          │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Mold 관리 도구

Mold는 CloudStack 기반의 관리 플랫폼으로, 다음 기능을 제공한다:

| 기능 | 설명 |
|------|------|
| **인프라 관리** | Zone, Pod, Cluster, Host 관리 |
| **VM 관리** | 인스턴스 생성/삭제/시작/정지 |
| **네트워크 관리** | VLAN, VPC, Security Group |
| **스토리지 관리** | Primary/Secondary Storage, 볼륨 |
| **테넌트 관리** | Domain, Account, User, Project |
| **템플릿/ISO** | VM 템플릿, ISO 이미지 관리 |
| **메트릭** | 리소스 모니터링, 쿼터 관리 |

### 2.4 KVM 하이퍼바이저

| 항목 | 내용 |
|------|------|
| **역할** | VM 가상화 |
| **관리** | libvirt를 통한 VM 관리 |
| **기능** | Live Migration, Snapshot, 리소스 제한 |

**주요 개념:**
- **호스트(Host)**: VM을 실행하는 물리 서버
- **인스턴스(Instance)**: 실행 중인 VM
- **템플릿(Template)**: VM 생성을 위한 기본 이미지

### 2.5 Ceph 분산 스토리지

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Ceph 아키텍처                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                           Ceph 클러스터                              │  │
│   │                                                                     │  │
│   │   ┌─────────┐   ┌─────────┐   ┌─────────┐                          │  │
│   │   │   MON   │   │   MON   │   │   MON   │  ← Monitor (클러스터 상태)│  │
│   │   └─────────┘   └─────────┘   └─────────┘                          │  │
│   │                                                                     │  │
│   │   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐           │  │
│   │   │   OSD   │   │   OSD   │   │   OSD   │   │   OSD   │           │  │
│   │   │  (NVMe) │   │  (NVMe) │   │  (HDD)  │   │  (HDD)  │           │  │
│   │   │   Hot   │   │   Hot   │   │  Cold   │   │  Cold   │           │  │
│   │   └─────────┘   └─────────┘   └─────────┘   └─────────┘           │  │
│   │                                                                     │  │
│   │   데이터 복제: replica 3 (3중 복제)                                 │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   접근 방식:                                                                │
│   - RBD (Block): VM 디스크                                                 │
│   - CephFS (File): 공유 파일시스템                                         │
│   - CephFS (File): NFS 파일 스토리지 (문서 저장)                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**주요 개념:**
- **MON (Monitor)**: 클러스터 상태 관리, Quorum 유지
- **OSD (Object Storage Daemon)**: 실제 데이터 저장
- **Pool**: 논리적 스토리지 그룹
- **CRUSH Map**: 데이터 배치 규칙

### 2.6 OVS (Open vSwitch)

| 항목 | 내용 |
|------|------|
| **역할** | 가상 네트워크 스위치 |
| **기능** | VLAN, VXLAN, 트래픽 제어 |
| **통합** | OpenFlow 지원, SDN 연동 |

---

## 3. 부서 격리 원칙

### 3.1 격리 구조 (앱 레벨 RBAC)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        부서 격리 구조 (앱 레벨 RBAC)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 1: 망분리 (역할별 VLAN)                                       │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - 6개 VLAN: DMZ(10)/백엔드(20)/AI(30)/DB(40)/스토리지(50)/관리(100) │  │
│   │  - AI 서버 → DB 직접 접근 차단, NFS 읽기 전용 (Stateless 원칙)      │  │
│   │  - 부서 격리는 네트워크가 아닌 앱 레벨 RBAC로 수행                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 2: 스토리지 격리 (NFS 디렉토리 분리)                           │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - NFS 디렉토리 기반 부서별 문서 분리 (/mnt/documents/{department_id}/...) │  │
│   │  - 백엔드 서버: NFS 읽기/쓰기, AI 서버: NFS 읽기 전용              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 3: 서비스 격리 (DepartmentContext @Filter)                    │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - Hibernate @Filter로 department_id 자동 필터링                    │  │
│   │  - 부서별 검색 범위 제한 (자기 부서 문서만 조회)                    │  │
│   │  - 공용 AI 태깅 서비스 공유, 데이터는 격리                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Layer 4: 접근제어 격리 (RBAC 4단계)                                 │  │
│   │  ────────────────────────────────────────────────────────────────   │  │
│   │  - RBAC: platform-admin / dept-admin / dept-user / viewer           │  │
│   │  - HTTP 헤더 인증: X-User-ID, X-Department-ID, X-Role              │  │
│   │  - 부서 A 사용자는 부서 B 문서 접근 불가                            │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 격리 원칙

| 원칙 | 설명 | 적용 |
|------|------|------|
| **앱 레벨 격리** | 부서 격리는 네트워크가 아닌 RBAC로 수행 | DepartmentContext @Filter |
| **명시적 허용** | 허용된 통신만 명시적으로 개방 | 방화벽 규칙 |
| **최소 권한** | 필요한 최소 권한만 부여 | RBAC 4단계 |
| **감사 추적** | 모든 접근 기록 | 로깅 |

### 3.3 부서 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        부서 격리 구조                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   부서 격리 = 앱 레벨 RBAC 기반 (네트워크 테넌트 VLAN 없음)                │
│                                                                             │
│   ├── 부서 A (department_id=1) - 문서 태깅 서비스 이용자                   │
│   │   ├── dept-admin: 부서 관리자 (문서 관리, 사용자 관리)                 │
│   │   └── dept-user: 일반 사용자 (문서 업로드, 검색)                       │
│   │                                                                         │
│   ├── 부서 B (department_id=2) - 문서 태깅 서비스 이용자                   │
│   │   ├── dept-admin: 부서 관리자                                          │
│   │   └── dept-user: 일반 사용자                                           │
│   │                                                                         │
│   └── 부서 C (department_id=3) - 문서 태깅 서비스 이용자                   │
│       ├── dept-admin: 부서 관리자                                          │
│       └── dept-user: 일반 사용자                                           │
│                                                                             │
│   격리 메커니즘:                                                             │
│   - DB 조회: Hibernate @Filter (DepartmentContext) 자동 적용               │
│   - NFS 저장: /mnt/documents/{department_id}/ 디렉토리 분리                │
│   - 인증: HTTP 헤더 (X-User-ID, X-Department-ID, X-Role)                  │
│                                                                             │
│   ※ 인증: 기존 내부 인증 체계 전제 (로그인 미구현)                         │
│   ※ 사용자 정보는 HTTP 헤더를 통해 수신                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. AI 워크로드 인프라

### 4.1 문서 태깅 서비스 특성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      문서 태깅 서비스 vs 대규모 학습                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌───────────────────────────────┬───────────────────────────────┐        │
│   │        대규모 학습 (설계만)    │    문서 태깅 서비스 (구현)      │        │
│   ├───────────────────────────────┼───────────────────────────────┤        │
│   │                               │                               │        │
│   │  • GPU 집약적 연산            │  • CPU 기반 추론 (KoBERT)     │        │
│   │  • 대용량 VRAM 필요           │  • 중간 메모리 사용           │        │
│   │  • 높은 I/O (학습 데이터)     │  • 비동기 처리 (문서별)       │        │
│   │  • 장시간 작업                │  • 실시간 응답               │        │
│   │                               │                               │        │
│   │  ※ 설계 문서로 대체          │  예: 문서 자동 태깅, 검색      │        │
│   │                               │                               │        │
│   └───────────────────────────────┴───────────────────────────────┘        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 문서 태깅 인프라 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      문서 태깅 서비스 인프라 구성                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                         ┌─────────────────────┐                            │
│                         │   사용자 (부서별)   │                            │
│                         │   A, B, C 부서      │                            │
│                         └──────────┬──────────┘                            │
│                                    │                                        │
│                         ┌──────────▼──────────┐                            │
│                         │    API Gateway     │                            │
│                         │  (인증 연동, 라우팅) │                            │
│                         └──────────┬──────────┘                            │
│                                    │                                        │
│              ┌─────────────────────┼─────────────────────┐                 │
│              │                     │                     │                 │
│              ▼                     ▼                     ▼                 │
│   ┌─────────────────┐   ┌─────────────────┐                               │
│   │  웹 서버 (x2)   │   │  App 서버 (x2)  │   (nginx / Spring Boot 4.0.2) │
│   │   Reverse Proxy │   │ REST API +      │                               │
│   │   (VLAN 10)     │   │ AMQP Consumer   │                               │
│   └────────┬────────┘   └────────┬────────┘                               │
│            │                     │ HTTP                                    │
│            │              ┌──────▼──────┐                                  │
│            │              │ AI 서버     │   OCR FastAPI(:8001)              │
│            │              │ (Stateless) │   태깅 FastAPI(:8000)            │
│            │              └─────────────┘                                  │
│            │                     ※ DB/NFS 접근 없음                       │
│            └────────────────────┬──────────────────────────────────────────┘
│                                │                                            │
│              ┌─────────────────┼─────────────────┐                         │
│              ▼                 ▼                 ▼                         │
│   ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐             │
│   │  문서 스토리지   │ │  MariaDB        │ │  모델 저장소    │             │
│   │(NFS 디렉토리분리)│ │ (Pri/Rep 이중화)│ │ (사전학습 모델) │             │
│   └─────────────────┘ └─────────────────┘ └─────────────────┘             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 비동기 처리 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      문서 업로드 → 태깅 비동기 처리                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   1. 문서 업로드                                                            │
│   ┌─────────┐    ┌─────────────┐    ┌─────────────────┐                   │
│   │ 사용자  │───►│  API        │───►│  문서 스토리지   │                   │
│   │         │    │  Gateway    │    │  (원본 저장)    │                   │
│   └─────────┘    └──────┬──────┘    └─────────────────┘                   │
│                         │                                                   │
│   2. 태깅 요청 큐 등록   │                                                   │
│                  ┌──────▼──────┐                                           │
│                  │ 메시지 큐   │                                           │
│                  │ (RabbitMQ)  │                                           │
│                  └──────┬──────┘                                           │
│                         │                                                   │
│   3. 비동기 태깅 (Spring AMQP Consumer)                                    │
│   ┌───────────────┐ ┌─────▼─────┐ ┌────────────────┐                      │
│   │ AMQP Consumer │◄┤ RabbitMQ  │ │ AI 서버        │                      │
│   │(@RabbitListener│ └───────────┘ │ OCR :8001      │                      │
│   │ on App 서버)  │ ──HTTP 호출──►│ 태깅 :8000     │                      │
│   └──────┬────────┘               │ (Stateless)    │                      │
│          │                         └────────────────┘                      │
│   4. 태그 저장 (Consumer가 직접 DB/NFS 저장)                               │
│          │      ┌─────────────────┐                                        │
│          └─────►│  메타데이터 DB  │                                        │
│                 │  (태그 저장)    │                                        │
│                 └─────────────────┘                                        │
│                                                                             │
│   5. 검색 (별도 흐름)                                                       │
│   ┌─────────┐    ┌─────────────┐    ┌─────────────────┐                   │
│   │ 사용자  │───►│  검색 API   │───►│  메타데이터 DB  │                   │
│   │         │◄───│  (태그검색) │◄───│  (태그 조회)    │                   │
│   └─────────┘    └─────────────┘    └─────────────────┘                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.4 OCR 기능 (설계만)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      OCR 처리 설계 (구현 제외)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ※ OCR 기능은 설계 문서에만 포함하며, 구현은 추후 확장 예정                │
│                                                                             │
│   설계 내용:                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                                                                     │  │
│   │   1. OCR 대상 문서                                                  │  │
│   │      - 스캔 문서 (이미지 형식 PDF)                                  │  │
│   │      - 이미지 파일 (JPG, PNG 등)                                    │  │
│   │      - 손글씨 포함 문서                                             │  │
│   │                                                                     │  │
│   │   2. OCR 처리 흐름 (설계)                                           │  │
│   │      문서 업로드 → OCR 필요 여부 판단 → OCR 처리 →                  │  │
│   │      텍스트 추출 → AI 태깅 → 메타데이터 저장                        │  │
│   │                                                                     │  │
│   │   3. OCR 엔진 후보 (설계)                                           │  │
│   │      - Tesseract OCR (오픈소스)                                     │  │
│   │      - PaddleOCR (딥러닝 기반)                                      │  │
│   │      - 클라우드 OCR API (향후)                                      │  │
│   │                                                                     │  │
│   │   4. 스토리지 설계                                                   │  │
│   │      - OCR 임시 저장소 (처리 대기 문서)                             │  │
│   │      - OCR 결과 저장소 (추출 텍스트)                                │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.5 문서 스토리지 요구사항

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      문서 스토리지 티어 구조                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Hot Tier (NVMe SSD) - 고성능                                       │  │
│   │  ─────────────────────────────────────────────────────────────────  │  │
│   │  • 최근 업로드 문서                                                 │  │
│   │  • 현재 서빙 중인 모델                                              │  │
│   │  • 자주 검색되는 문서                                               │  │
│   │                                                                     │  │
│   │  I/O 요구: 빠른 읽기/쓰기, 문서 업로드 처리                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                               │ 30일 미접근                                │
│                               ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Warm Tier (SATA SSD) - 중간                                        │  │
│   │  ─────────────────────────────────────────────────────────────────  │  │
│   │  • 최근 태깅 완료 문서                                              │  │
│   │  • 이전 버전 모델                                                   │  │
│   │  • 검색 빈도 낮은 문서                                              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                               │ 90일 미접근                                │
│                               ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Cold Tier (HDD) - 대용량                                           │  │
│   │  ─────────────────────────────────────────────────────────────────  │  │
│   │  • 오래된 문서 아카이브                                             │  │
│   │  • 컴플라이언스 보존 문서                                           │  │
│   │                                                                     │  │
│   │  Erasure Coding 적용 (저장 효율)                                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 접근 제어 모델

### 5.1 인증 전제 조건

> **중요**: 본 프로젝트는 기존 내부 인증 체계가 존재한다고 전제합니다. 로그인 기능은 구현하지 않으며, 인증된 사용자 정보를 받아 저장하고 권한 관리에 활용합니다.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        인증 연동 아키텍처                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     기존 내부 인증 시스템 (전제)                     │  │
│   │                     (SSO, AD, LDAP 등)                              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    │ 인증된 사용자 정보                     │
│                                    │ (사용자 ID, 소속, 역할)               │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     API Gateway                                     │  │
│   │   ────────────────────────────────────────────────────────────────  │  │
│   │   - 사용자 정보 수신 (헤더 또는 토큰)                               │  │
│   │   - 사용자 정보 검증                                                │  │
│   │   - 요청별 권한 확인                                                │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     사용자 정보 저장                                 │  │
│   │   ────────────────────────────────────────────────────────────────  │  │
│   │   - 사용자 ID (X-User-ID)                                           │  │
│   │   - 소속 부서 (X-Department-ID)                                     │  │
│   │   - 역할 (X-Role: platform-admin/dept-admin/dept-user/viewer)       │  │
│   │   - 최초 접근 시간, 마지막 접근 시간                                │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 RBAC (역할 기반 접근 제어)

| 역할 | 권한 | 대상 |
|------|------|------|
| **platform-admin** | 전체 시스템 관리, 모니터링 | 인프라 관리자 |
| **dept-admin** | 자기 부서 내 사용자 관리, 문서 관리 | 부서 담당자 |
| **dept-user** | 문서 업로드, 검색, 조회 | 부서 직원 |
| **viewer** | 조회 전용 (읽기 전용) | 열람 권한자 |

### 5.3 권한 매트릭스

| 기능 | platform-admin | dept-admin | dept-user | viewer |
|------|---------------|-----------|----------|--------|
| 사용자 관리 | ✅ | ✅ (자기 부서) | ❌ | ❌ |
| 문서 업로드 | ✅ | ✅ | ✅ (자기 부서) | ❌ |
| 문서 검색 | ✅ | ✅ (자기 부서) | ✅ (자기 부서) | ✅ (자기 부서) |
| 전체 로그 조회 | ✅ | ❌ | ❌ | ❌ |
| 부서 로그 조회 | ✅ | ✅ (자기 부서) | ❌ | ❌ |

### 5.4 감사 로깅

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        감사 로깅 체계                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     로깅 대상                                        │  │
│   │   ────────────────────────────────────────────────────────────────  │  │
│   │   - 모든 API 호출 (요청자, 시간, 엔드포인트, 결과)                  │  │
│   │   - 문서 접근 이력 (업로드, 조회, 검색, 삭제)                       │  │
│   │   - 권한 변경 이력                                                  │  │
│   │   - 시스템 이벤트                                                   │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     로그 구조                                        │  │
│   │   ────────────────────────────────────────────────────────────────  │  │
│   │   {                                                                 │  │
│   │     "timestamp": "2026-02-05T10:30:00Z",                           │  │
│   │     "user_id": "user-a1",                                          │  │
│   │     "department_id": "dept-a",                                     │  │
│   │     "action": "DOCUMENT_UPLOAD",                                   │  │
│   │     "resource": "doc-123",                                         │  │
│   │     "result": "SUCCESS",                                           │  │
│   │     "ip_address": "192.168.20.10"                                  │  │
│   │   }                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     로그 분리                                        │  │
│   │   ────────────────────────────────────────────────────────────────  │  │
│   │   - 부서별 로그 분리 저장                                           │  │
│   │   - 감사 로그 보존 기간: 1년                                        │  │
│   │   - 접근 로그 보존 기간: 90일                                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.5 암호화 체계

| 구간 | 암호화 방식 | 적용 |
|------|-----------|------|
| **전송 중** | TLS 1.3 | 모든 네트워크 통신 |
| **저장 시** | AES-256 | 스토리지 데이터 |
| **키 관리** | Vault 등 KMS | 암호화 키 중앙 관리 |

---

## 6. IaC 가이드

### 6.1 IaC 도구

| 도구 | 용도 | 적용 범위 |
|------|------|----------|
| **Terraform** | 인프라 프로비저닝 | VM, 네트워크, 스토리지 |
| **Ansible** | 구성 관리 | OS 설정, 패키지 설치, 앱 배포 |
| **Git** | 버전 관리 | 모든 IaC 코드 |

### 6.2 Terraform 구조

```
terraform/
├── modules/
│   ├── compute/              # VM 생성 모듈
│   │   ├── main.tf           # 리소스 정의
│   │   ├── variables.tf      # 입력 변수
│   │   └── outputs.tf        # 출력 변수
│   │
│   │
│   ├── network/              # 네트워크 모듈
│   │   ├── vlan.tf           # VLAN 정의
│   │   ├── firewall.tf       # 방화벽 규칙
│   │   └── loadbalancer.tf   # 로드밸런서
│   │
│   ├── storage/              # 스토리지 모듈
│   │   ├── pool.tf           # 스토리지 풀
│   │   ├── document_storage.tf # 문서 스토리지
│   │   └── quota.tf          # 쿼터 설정
│   │
│   └── rbac/                 # RBAC 모듈
│       ├── main.tf           # 부서 격리 설정
│       └── rbac.tf           # 권한 설정
│
├── environments/
│   ├── dev/                  # 개발 환경
│   │   ├── main.tf
│   │   └── terraform.tfvars
│   │
│   └── prod/                 # 운영 환경
│       ├── main.tf
│       └── terraform.tfvars
│
└── main.tf                   # 루트 모듈
```

### 6.3 Terraform 작성 원칙

| 원칙 | 설명 |
|------|------|
| **모듈화** | 재사용 가능한 모듈로 분리 |
| **상태 관리** | 원격 백엔드로 상태 파일 관리 |
| **변수화** | 하드코딩 대신 변수 사용 |
| **버전 관리** | 프로바이더/모듈 버전 명시 |

### 6.4 Ansible 구조

```
ansible/
├── inventory/
│   ├── dev.yml               # 개발 환경 인벤토리
│   └── prod.yml              # 운영 환경 인벤토리
│
├── playbooks/
│   ├── base-setup.yml        # 기본 OS 설정
│   ├── ai-server.yml         # AI 서버 (OCR/태깅 FastAPI) 배포
│   ├── model-serving.yml     # 모델 서빙 배포
│   ├── monitoring-agent.yml  # 모니터링 에이전트
│   ├── security-hardening.yml# 보안 강화
│   └── app-deploy.yml        # 애플리케이션 배포
│
├── roles/
│   ├── common/               # 공통 설정
│   ├── python-runtime/       # Python 런타임
│   ├── model-serving/        # 모델 서빙 (TorchServe 등)
│   ├── node-exporter/        # 기본 메트릭 (ABLESTACK Mold 연동)
│   ├── filebeat/             # 로그 수집
│   └── hardening/            # 보안 강화
│
└── ansible.cfg               # Ansible 설정
```

### 6.5 Ansible 작성 원칙

| 원칙 | 설명 |
|------|------|
| **멱등성** | 여러 번 실행해도 동일한 결과 |
| **역할 분리** | 기능별 Role로 분리 |
| **변수 우선순위** | inventory < playbook < role < task |
| **비밀정보 관리** | Ansible Vault 사용 |

---

## 7. 참고 자료

### 7.1 공식 문서

| 기술 | 문서 링크 |
|------|----------|
| **ABLESTACK** | 에이블스택 공식 문서 |
| **CloudStack** | https://docs.cloudstack.apache.org/ |
| **Ceph** | https://docs.ceph.com/ |
| **KVM** | https://www.linux-kvm.org/page/Documents |
| **Terraform** | https://developer.hashicorp.com/terraform/docs |
| **Ansible** | https://docs.ansible.com/ |
| **KoBERT** | https://github.com/SKTBrain/KoBERT |

### 7.2 학습 키워드

**컴퓨트 팀:**
```
KVM, libvirt, QEMU, vCPU, Memory overcommit
Resource Pool, Affinity, Anti-Affinity
Live Migration, HA, Fault Domain
Cloud-init, VM Template
모델 서빙, OCR FastAPI(:8001), 태깅 FastAPI(:8000), KoBERT
비동기 처리, Spring AMQP (Producer + Consumer), @RabbitListener, RabbitMQ
CPU 추론, PyTorch
Spring Boot 4.0.2, SpringDoc OpenAPI (Swagger UI)
```

**네트워크/보안 팀:**
```
VLAN, VXLAN, OVS, SDN
Security Group, Firewall, iptables
RBAC, ABAC
TLS, PKI
마이크로세그멘테이션, East-West 트래픽
감사 로깅, Audit Trail
기존 인증 연동, SSO, AD
```

**스토리지 팀:**
```
Ceph, OSD, MON, CRUSH Map
Pool, Replication, Erasure Coding
Tiering, Hot/Warm/Cold
RBD, CephFS, MDS
Snapshot, Backup, DR
RPO, RTO
NFS 파일 스토리지, CephFS
문서 저장소, 메타데이터
```

### 7.3 본 프로젝트 관련 문서

- [00_사이징.md](00_사이징.md) - 사이징 가정서 및 요청서
- [00_프로젝트_계획서.md](00_프로젝트_계획서.md) - 프로젝트 계획서
- [00_요구사항_명세서.md](00_요구사항_명세서.md) - 요구사항 명세서
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 개요서
- [02_팀_역할분담.md](02_팀_역할분담.md) - 팀 역할분담
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md) - 컴퓨트 설계서
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md) - 네트워크/보안 설계서
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계서
- [07_백엔드_설계서.md](07_백엔드_설계서.md) - 백엔드 상세 설계서

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-30 | 초안 작성 | - |
| 2.0 | 2026-02-02 | AI 배경지식 추가 | - |
| 3.0 | 2026-02-04 | AI 플랫폼 중심 재구성 | - |
| 4.0 | 2026-02-05 | 문서 태깅 시스템 변경 | - |
| 5.0 | 2026-02-06 | GPU 제거: GPU 가상화 섹션 삭제, CPU 기반 KoBERT 추론으로 변경 | - |
| 6.0 | 2026-02-06 | **사이징 반영**: 8 VM 구조, Web/App 분리, MariaDB Primary/Replica 이중화 반영 | - |
| 1.1 | 2026-02-09 | Spring Boot 4.0.2, SpringDoc OpenAPI 반영, sesac-smartdocs 업데이트 | - |
| 7.0 | 2026-02-10 | 아키텍처 변경 반영: 멀티테넌시→RBAC 부서 격리, AI Worker→OCR/태깅 FastAPI (Stateless), Spring AMQP Consumer | - |
