# 컴퓨트 설계서

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 멀티 테넌트 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 컴퓨트 설계서 |
| 버전 | 7.0 |
| 작성일 | 2026-02-06 |
| 담당팀 | 컴퓨트/개발 팀 |

---

**목차**

1. [설계 개요 및 목표](#1-설계-개요-및-목표)
2. [리소스 풀 설계](#2-리소스-풀-설계)
3. [VM 배치 전략](#3-vm-배치-전략)
4. [리소스 쿼터](#4-리소스-쿼터)
5. [고가용성(HA) 설계](#5-고가용성ha-설계)
6. [VM 템플릿 및 표준화](#6-vm-템플릿-및-표준화)
7. [검증 워크로드 배포 계획](#7-검증-워크로드-배포-계획)

---

## 1. 설계 개요 및 목표

### 1.1 설계 목표

| 목표 | 설명 | 검증 방법 |
|------|------|----------|
| **문서 태깅 플랫폼** | 문서 자동 태깅 서비스를 위한 컴퓨트 인프라 | 태깅 서비스 정상 동작 |
| **테넌트 격리** | 테넌트별 문서 접근 권한 분리 | 테넌트 간 문서 접근 차단 확인 |
| **고가용성** | 서비스 VM 장애 시 자동 복구 | Failover 테스트 |
| **표준화** | VM 템플릿으로 일관된 환경 | 템플릿 기반 배포 |

### 1.2 설계 범위 정의

> **핵심 원칙**: 본 프로젝트는 AI 기반 문서 태깅 플랫폼 인프라 구축 프로젝트이다.
> 테넌트(부서)는 문서 업로드 및 검색 기능을 사용하며, AI 자동 태깅 서비스는 공용 플랫폼에서 제공한다.

**범위에 포함:**
- 문서 태깅 플랫폼 (Web 서버, App 서버, AI Worker)
- 메타데이터 DB (MariaDB Primary/Replica 이중화)
- AI Model Training Worker (경량 파인튜닝, 비정기 가동)
- 모니터링 (ABLESTACK Mold 기본 기능 활용)

**범위에 제외:**
- OCR 기능 (AI Worker에서 처리, 설계만 포함)

### 1.3 상세 설계 범위

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   문서 태깅 플랫폼 컴퓨트 설계 범위                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   In-Scope (담당 영역)                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - 리소스 풀 구성 및 관리                                            │  │
│   │  - VM 배치 전략 (Affinity/Anti-Affinity)                            │  │
│   │  - 장애 도메인 설계 (서비스 HA)                                      │  │
│   │  - HA 설정 (VM 자동 재시작, Live Migration)                         │  │
│   │  - VM 템플릿 관리 (Web/App/AI Worker/DB)                            │  │
│   │  - 검증 워크로드 배포 (문서 자동 태깅 서비스)                        │  │
│   │  - DB 이중화 설계 (MariaDB Primary/Replica)                         │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   Out-of-Scope (범위 제외)                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  ✗ OCR 기능 구현 (설계만, AI Worker에서 처리)                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   협업 영역 (다른 팀과 공동)                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - VM 네트워크 연결 (네트워크 팀)                                    │  │
│   │  - VM 스토리지 연결 (스토리지 팀)                                    │  │
│   │  - 메트릭 수집 (공통)                                                │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 리소스 풀 설계

### 2.1 풀 구성 전략

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        리소스 풀 구조                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                         ┌─────────────────┐                                │
│                         │   Root Pool     │                                │
│                         │  (전체 클러스터) │                                │
│                         └────────┬────────┘                                │
│                                  │                                          │
│       ┌──────────────────────────┼──────────────────────────┐              │
│       │                          │                          │              │
│       ▼                          ▼                          ▼              │
│   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐         │
│   │ 서비스 풀   │         │ 데이터 풀   │         │ 관리 풀     │         │
│   │ (Service)   │         │ (Data)      │         │ (Mgmt)      │         │
│   └──────┬──────┘         └──────┬──────┘         └──────┬──────┘         │
│          │                       │                       │                 │
│   ┌──────┼──────┐         ┌──────┼──────┐               │                 │
│   │      │      │         │      │      │               │                 │
│   ▼      ▼      ▼         ▼      ▼      ▼               ▼                 │
│ ┌─────┐┌─────┐┌─────┐  ┌─────┐┌─────┐┌─────┐      ┌─────────┐            │
│ │ Web ││ App ││ AI  │  │ DB  ││ DB  ││Model│      │Training │            │
│ │ x2  ││ x2  ││Worker│  │Pri ││Rep  ││Train│      │ Worker  │            │
│ └─────┘└─────┘└─────┘  └─────┘└─────┘└─────┘      └─────────┘            │
│                                                                             │
│   서비스 풀: Web 서버 (HA), App 서버 (HA), AI Tagging/OCR Worker           │
│   데이터 풀: MariaDB Primary/Replica (HA), AI Model Training Worker        │
│   관리 풀: 비정기 가동 워크로드                                             │
│   모니터링: ABLESTACK Mold 기본 기능 활용 (별도 VM 불필요)                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 오버커밋 정책

| 리소스 | 오버커밋 비율 | 설명 |
|--------|-------------|------|
| **CPU** | 2:1 | 물리 1코어당 가상 2코어 할당 가능 |
| **Memory** | 1:1 | 메모리는 오버커밋 없음 (안정성) |
| **Storage** | Thin Provisioning | 실제 사용량만 할당 |

**오버커밋 설정 근거:**
- CPU는 일반적으로 100% 사용되지 않으므로 2:1 오버커밋 적용
- Memory는 스왑 발생 시 성능 저하가 심하므로 오버커밋 없음
- 스토리지는 Thin Provisioning으로 효율적 활용

### 2.3 클러스터 구성

| 구성 요소 | 수량 | 설명 |
|----------|------|------|
| **Zone** | 1개 | 단일 데이터센터 |
| **Pod** | 1개 | 네트워크 도메인 |
| **Cluster** | 1개 | 호스트 그룹 |
| **Host** | 최소 3노드 | HCI 클러스터 (1노드 장애 허용) |

---

## 3. VM 배치 전략

### 3.1 Affinity / Anti-Affinity

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Affinity / Anti-Affinity 규칙                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Anti-Affinity (분산 배치) - HA 목적                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                                                                     │  │
│   │   Host 1              Host 2              Host 3                    │  │
│   │   ┌─────────┐        ┌─────────┐        ┌─────────┐                │  │
│   │   │ Web-01  │        │ Web-02  │        │ App-01  │                │  │
│   │   │ DB-Pri  │        │ DB-Rep  │        │ App-02  │                │  │
│   │   └─────────┘        └─────────┘        └─────────┘                │  │
│   │                                                                     │  │
│   │   ✓ 동일 서비스 VM은 다른 호스트에 분산 → 호스트 장애 시 서비스 유지 │  │
│   │   ✓ DB Primary/Replica는 반드시 다른 호스트에 배치                  │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   Affinity (동일 배치) - 성능 목적                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                                                                     │  │
│   │   Host 1                                                            │  │
│   │   ┌─────────┐  ┌─────────┐                                         │  │
│   │   │   AI   │──│ Model   │  ← AI Worker와 Model Training은           │  │
│   │   │ Worker │  │Training │    빈번한 통신 시 동일 호스트 (레이턴시) │  │
│   │   └─────────┘  └─────────┘                                         │  │
│   │                                                                     │  │
│   │   ✓ 빈번하게 통신하는 VM은 동일 호스트에 배치                       │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 배치 규칙 정의

| 규칙 ID | 유형 | 대상 VM | 설명 |
|---------|------|--------|------|
| **AA-001** | Anti-Affinity | Web 서버 (2대) | 서비스 HA를 위해 분산 배치 |
| **AA-002** | Anti-Affinity | App 서버 (2대) | 서비스 HA를 위해 분산 배치 |
| **AA-003** | Anti-Affinity | DB Primary/Replica | 데이터 HA를 위해 필수 분산 |
| **AF-001** | Affinity | AI Worker - DB | 데이터 처리 레이턴시 최소화 |

### 3.3 장애 도메인 분리

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        장애 도메인 설계                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   물리 인프라 구성: 최소 3노드 HCI 클러스터 (1노드 장애 허용)               │
│                                                                             │
│   장애 도메인 레벨:                                                         │
│                                                                             │
│   Level 1: Host (호스트)                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  단일 호스트 장애 시 해당 호스트의 VM만 영향                         │  │
│   │  → Anti-Affinity로 중요 VM 분산 배치                                 │  │
│   │  → DB Primary/Replica 필수 분리                                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   Level 2: Rack (랙) - 설계 문서용                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  랙 단위 장애 (전원, 네트워크) 시 해당 랙의 모든 호스트 영향         │  │
│   │  → 중요 서비스는 다른 랙에 분산 (실제 구현 시)                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   데모 환경 적용:                                                           │
│   - Host 레벨 Anti-Affinity 적용                                           │
│   - 호스트 장애 시 VM 자동 재시작 (다른 호스트에서)                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 리소스 쿼터

### 4.1 쿼터 정책

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        리소스 쿼터 설계                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   문서 태깅 플랫폼 환경 할당 (사이징 요청서 기준):                           │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                                                                     │  │
│   │   [서비스 계층] - 4대 (HA 구성)                                     │  │
│   │   Web 서버: vCPU 2개, Memory 4GB, Disk 50GB, VM 2대 (HA)           │  │
│   │   App 서버: vCPU 4개, Memory 8GB, Disk 100GB, VM 2대 (HA)          │  │
│   │                                                                     │  │
│   │   [AI 처리 계층] - 2대                                              │  │
│   │   AI Tagging/OCR Worker: vCPU 4개, Memory 8GB, Disk 200GB, VM 1대  │  │
│   │   AI Model Training: vCPU 4개, Memory 8GB, Disk 100GB, VM 1대      │  │
│   │                                                                     │  │
│   │   [데이터 계층] - 2대 (HA 구성)                                     │  │
│   │   MariaDB Primary: vCPU 4개, Memory 8GB, Disk 200GB, VM 1대        │  │
│   │   MariaDB Replica: vCPU 4개, Memory 8GB, Disk 200GB, VM 1대        │  │
│   │                                                                     │  │
│   │   [모니터링]                                                        │  │
│   │   ABLESTACK Mold 기본 기능 활용 (별도 VM 불필요)                   │  │
│   │   ─────────────────────────────────────────────────────────────    │  │
│   │   합계: vCPU 18개, Memory 36GB, Disk 650GB, VM 8대                 │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 VM 리소스 할당

| 구성 요소 | vCPU | Memory | Disk | VM 수 | HA | 백업 | 용도 |
|----------|------|--------|------|-------|-----|------|------|
| **Web 서버** | 2 | 4 GB | 50 GB | 2대 | Y | 일일 | Nginx, 정적 파일 서빙, 리버스 프록시 |
| **App 서버** | 4 | 8 GB | 100 GB | 2대 | Y | 일일 | Spring Boot, REST API, 비즈니스 로직 |
| **AI Tagging/OCR Worker** | 4 | 8 GB | 200 GB | 1대 | N | - | Docker Python, 비동기 태깅/OCR |
| **AI Model Training** | 4 | 8 GB | 100 GB | 1대 | N | - | 경량 파인튜닝, 비정기 가동 |
| **MariaDB Primary** | 4 | 8 GB | 200 GB | 1대 | Y | 실시간 | 문서 메타데이터, 태그 정보 |
| **MariaDB Replica** | 4 | 8 GB | 200 GB | 1대 | Y | 실시간 | 읽기 분산, 장애 복구 |

> **모니터링**: ABLESTACK Mold 기본 제공 기능 활용 (VM 상태, CPU/Memory/Disk 사용량, 알림)

### 4.3 테넌트별 사용량 관리

> 테넌트(부서)는 VM을 직접 소유하지 않고, 공용 플랫폼을 사용한다.
> 사용량은 문서 업로드 용량과 검색 횟수로 관리된다.

| 테넌트 | 사용자 수 | Alliance 저장소 | Confidential 저장소 | 비고 |
|--------|----------|-----------------|---------------------|------|
| **부서 A** | 30명 | 공용 1TB 공유 | 500 GB (전용) | 테넌트 관리자 1명 |
| **부서 B** | 30명 | 공용 1TB 공유 | 500 GB (전용) | 테넌트 관리자 1명 |
| **부서 C** | 30명 | 공용 1TB 공유 | 500 GB (전용) | 테넌트 관리자 1명 |

### 4.4 쿼터 초과 정책

| 상황 | 정책 |
|------|------|
| 문서 저장 용량 80% 도달 | 테넌트 관리자 경고 알림 |
| 문서 저장 용량 100% 도달 | 추가 업로드 차단 |
| 동시 태깅 요청 과다 | 큐 대기 (비동기 처리) |

---

## 5. 고가용성(HA) 설계

### 5.1 HA 전략

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        고가용성 설계                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   HA 대상 VM:                                                               │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  • Web 서버 (2대) - Anti-Affinity 분산                              │  │
│   │  • App 서버 (2대) - Anti-Affinity 분산                              │  │
│   │  • MariaDB Primary/Replica (2대) - 반드시 다른 호스트               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   DB 장애 시나리오 (MariaDB Replication):                                   │
│                                                                             │
│   [정상 상태]                      [Primary 장애]                           │
│   ┌─────────┐  ┌─────────┐        ┌─────────┐  ┌─────────┐               │
│   │ Host 1  │  │ Host 2  │        │ Host 1  │  │ Host 2  │               │
│   │ ┌─────┐ │  │ ┌─────┐ │        │   ✗     │  │ ┌─────┐ │               │
│   │ │ Pri │ │──│ │ Rep │ │   ──►  │ 장애!   │  │ │ Rep │ │               │
│   │ └─────┘ │  │ └─────┘ │        │         │  │ │→Pri │ │ ← 승격        │
│   └─────────┘  └─────────┘        └─────────┘  └─────────┘               │
│                                                                             │
│   HA 동작 순서:                                                             │
│   1. Primary 장애 감지 (하트비트 타임아웃)                                  │
│   2. Replica를 Primary로 승격                                               │
│   3. App 서버 DB 연결 변경 (또는 VIP 이동)                                  │
│   4. 기존 Primary 복구 후 Replica로 재구성                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 HA 설정

| 설정 항목 | 값 | 설명 |
|----------|-----|------|
| **HA 활성화** | 예 | 클러스터 레벨 HA 활성화 |
| **장애 감지 시간** | 30초 | 하트비트 타임아웃 |
| **자동 재시작** | 예 | 장애 VM 자동 재시작 |
| **재시작 우선순위** | DB > App > Web > AI | VM별 우선순위 설정 |

### 5.3 DB 이중화 (MariaDB Replication)

| 항목 | 설명 |
|------|------|
| **복제 방식** | Semi-Synchronous Replication |
| **역할** | Primary (쓰기) + Replica (읽기/대기) |
| **Failover** | 수동 또는 자동 (MHA 등) |
| **백업** | Primary → Replica 실시간 복제 |

```
MariaDB Replication 구성:

   Primary (Host 1)                    Replica (Host 2)
   ┌─────────────────┐                ┌─────────────────┐
   │   MariaDB       │                │   MariaDB       │
   │   (Read/Write)  │ ──── 복제 ────► │   (Read Only)   │
   │                 │                │                 │
   │   Binlog 생성   │                │   Relay Log     │
   └─────────────────┘                └─────────────────┘

   - 복제 지연 목표: < 1초
   - Failover 시간: 수동 < 5분, 자동 < 30초
```

### 5.4 Live Migration

| 항목 | 설명 |
|------|------|
| **목적** | 서비스 중단 없이 VM을 다른 호스트로 이동 |
| **사용 시점** | 호스트 유지보수, 부하 분산 |
| **요구 사항** | 공유 스토리지 (Ceph), 동일 CPU 아키텍처 |

---

## 6. VM 템플릿 및 표준화

### 6.1 VM 템플릿 목록

| 템플릿 ID | OS | vCPU | Memory | Disk | 용도 | 포함 패키지 |
|----------|-----|------|--------|------|------|------------|
| **TPL-WEB** | Rocky Linux 9 | 2 | 4GB | 50GB | Web 서버 | Nginx |
| **TPL-APP** | Rocky Linux 9 | 4 | 8GB | 100GB | App 서버 | Java, Spring Boot |
| **TPL-AI-WORKER** | Rocky Linux 9 | 4 | 8GB | 200GB | AI Worker | Docker, Python |
| **TPL-AI-TRAIN** | Rocky Linux 9 | 4 | 8GB | 100GB | Model Training | Docker, Python, PyTorch |
| **TPL-DB** | Rocky Linux 9 | 4 | 8GB | 200GB | MariaDB | MariaDB Server |

### 6.2 서비스 VM 템플릿 구성 상세

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        VM 템플릿 구성                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   TPL-WEB (Web 서버):                                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - Rocky Linux 9                                                    │  │
│   │  - Nginx (리버스 프록시, 정적 파일 서빙)                            │  │
│   │  - SSL/TLS 인증서 관리                                              │  │
│   │  - node_exporter (메트릭)                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   TPL-APP (App 서버):                                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - Rocky Linux 9                                                    │  │
│   │  - OpenJDK 17+                                                      │  │
│   │  - Spring Boot (REST API, 비즈니스 로직)                            │  │
│   │  - MariaDB JDBC Driver                                              │  │
│   │  - node_exporter (메트릭)                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   TPL-AI-WORKER (AI Tagging/OCR Worker):                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - Rocky Linux 9                                                    │  │
│   │  - Docker Engine                                                    │  │
│   │  - Python 3.10+ (Docker 컨테이너)                                   │  │
│   │  - AI 태깅 모델, OCR 라이브러리                                    │  │
│   │  - 비동기 작업 큐 연동                                              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   TPL-DB (MariaDB):                                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - Rocky Linux 9                                                    │  │
│   │  - MariaDB Server 10.11+                                           │  │
│   │  - Replication 구성 (Primary/Replica)                               │  │
│   │  - 자동 백업 스크립트                                               │  │
│   │  - node_exporter, mysqld_exporter (메트릭)                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.3 VM 명명 규칙

```
{환경}-{계층}-{역할}-{번호}

예시:
- dev-svc-web-01      : 개발환경, 서비스, Web 서버, 1번
- dev-svc-web-02      : 개발환경, 서비스, Web 서버, 2번
- dev-svc-app-01      : 개발환경, 서비스, App 서버, 1번
- dev-svc-app-02      : 개발환경, 서비스, App 서버, 2번
- dev-ai-worker-01    : 개발환경, AI, Tagging/OCR Worker, 1번
- dev-ai-train-01     : 개발환경, AI, Model Training, 1번
- dev-data-db-pri     : 개발환경, 데이터, DB Primary
- dev-data-db-rep     : 개발환경, 데이터, DB Replica
```

---

## 7. 검증 워크로드 배포 계획

### 7.1 검증 목적

> 인프라 설계의 정상 동작을 확인하기 위한 샘플 워크로드 배포

| 검증 항목 | 검증 방법 |
|----------|----------|
| **테넌트 격리** | 테넌트 간 문서 접근 불가 확인 |
| **HA** | 호스트 장애 시 VM 자동 재시작 확인 |
| **DB 이중화** | Primary 장애 시 Replica 승격 확인 |
| **Anti-Affinity** | VM이 다른 호스트에 분산되었는지 확인 |
| **비동기 처리** | 문서 업로드 → 태깅 완료 흐름 확인 |

### 7.2 검증 환경 VM 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   문서 태깅 플랫폼 검증 워크로드 배포 구성                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [서비스 계층] - 4대 (HA 구성)                                              │
│   ┌─────────────────┐ ┌─────────────────┐                                  │
│   │ dev-svc-web-01  │ │ dev-svc-web-02  │  ← Anti-Affinity (다른 호스트)   │
│   │ (2vCPU/4GB)     │ │ (2vCPU/4GB)     │                                  │
│   │ Nginx           │ │ Nginx           │                                  │
│   └─────────────────┘ └─────────────────┘                                  │
│                                                                             │
│   ┌─────────────────┐ ┌─────────────────┐                                  │
│   │ dev-svc-app-01  │ │ dev-svc-app-02  │  ← Anti-Affinity (다른 호스트)   │
│   │ (4vCPU/8GB)     │ │ (4vCPU/8GB)     │                                  │
│   │ Spring Boot     │ │ Spring Boot     │                                  │
│   └─────────────────┘ └─────────────────┘                                  │
│                                                                             │
│   [AI 처리 계층] - 2대                                                       │
│   ┌─────────────────┐ ┌─────────────────┐                                  │
│   │dev-ai-worker-01 │ │dev-ai-train-01  │                                  │
│   │ (4vCPU/8GB)     │ │ (4vCPU/8GB)     │                                  │
│   │ Docker Python   │ │ Docker Python   │  ← 비정기 가동                   │
│   │ 태깅/OCR 처리   │ │ 경량 파인튜닝   │                                  │
│   └─────────────────┘ └─────────────────┘                                  │
│                                                                             │
│   [데이터 계층] - 2대 (HA 구성)                                              │
│   ┌─────────────────┐ ┌─────────────────┐                                  │
│   │ dev-data-db-pri │ │ dev-data-db-rep │  ← 반드시 다른 호스트            │
│   │ (4vCPU/8GB)     │ │ (4vCPU/8GB)     │                                  │
│   │ MariaDB Primary │◄──────────────────│ MariaDB Replica                  │
│   │ (Read/Write)    │    복제           │ (Read Only)                      │
│   └─────────────────┘ └─────────────────┘                                  │
│                                                                             │
│   [모니터링]                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │ ABLESTACK Mold 기본 제공: VM 상태, CPU/Memory/Disk 사용량, 알림    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   총 VM: 8대                                                                │
│   총 리소스: vCPU 18개, Memory 36GB, Disk 650GB                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.3 검증 시나리오

| 시나리오 | 절차 | 예상 결과 |
|----------|------|----------|
| **SC-01: 테넌트 격리** | 부서 A에서 부서 B 문서 조회 시도 | 접근 거부 |
| **SC-02: VM HA 테스트** | 호스트 장애 시뮬레이션 | VM 자동 재시작 |
| **SC-03: DB Failover** | Primary DB 장애 시뮬레이션 | Replica 승격, 서비스 정상 |
| **SC-04: Anti-Affinity** | 동일 서비스 VM 배치 확인 | 다른 호스트에 분산 |
| **SC-05: 문서 업로드** | 문서 업로드 후 태깅 확인 | 자동 태깅 완료 |
| **SC-06: 비동기 처리** | 대량 문서 업로드 | 큐잉 후 순차 처리 |

### 7.4 검증 워크로드: 문서 자동 태깅

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   문서 자동 태깅 워크로드 (검증용)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   목표 서비스: 문서 자동 태깅                                               │
│   - 기능: 문서 업로드 시 내용 기반 자동 태깅                                │
│   - 기술: 경량 NLP 모델 (CPU 기반)                                         │
│   - 처리 시간: 문서당 5초 이내                                              │
│   - 일 평균: 150건 처리                                                     │
│                                                                             │
│   태깅 워크플로우:                                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  [사용자] 문서 업로드                                               │  │
│   │      ↓                                                              │  │
│   │  [Web 서버] 요청 수신, App 서버로 전달                              │  │
│   │      ↓                                                              │  │
│   │  [App 서버] 문서 저장, 태깅 요청 큐에 등록                          │  │
│   │      ↓                                                              │  │
│   │  [AI Worker] 큐에서 작업 수신, 태깅 처리                            │  │
│   │      ↓                                                              │  │
│   │  [MariaDB] 태그 결과 저장                                           │  │
│   │      ↓                                                              │  │
│   │  [사용자] 태그 기반 검색 가능                                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   모델 개선 (월 1회 또는 필요 시):                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - AI Model Training Worker에서 경량 파인튜닝                       │  │
│   │  - 사용자 태그 교정 데이터 기반                                     │  │
│   │  - CPU 기반 처리 (GPU 불필요)                                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.5 모니터링 (ABLESTACK Mold)

> ABLESTACK Mold 기본 제공 모니터링 기능 활용

| 모니터링 항목 | 설명 |
|-------------|------|
| **VM 상태** | Running, Stopped, Error 상태 실시간 확인 |
| **CPU Utilization** | VM별 CPU 사용률 |
| **Memory Usage** | VM별 메모리 사용률 |
| **Disk Usage** | VM별 디스크 사용량 |
| **호스트 감시** | 물리 호스트 상태 모니터링 |
| **알림 설정** | 임계치 초과 시 이메일 알림 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-30 | 초안 작성 | - |
| 2.0 | 2026-02-02 | GPU 가상화 통합 | - |
| 3.0 | 2026-02-04 | AI 플랫폼 중심 재구성 | - |
| 4.0 | 2026-02-05 | 문서 태깅 시스템으로 변경 | - |
| 5.0 | 2026-02-06 | GPU 제거, CPU 기반 KoBERT 추론으로 변경 | - |
| 6.0 | 2026-02-06 | 구조 단순화, Elasticsearch 제거, ABLESTACK Mold 모니터링 | - |
| 7.0 | 2026-02-06 | **사이징 기준 전면 개편**: MariaDB 이중화(Pri/Rep), Web/App 분리, AI Worker 통합, Rocky Linux 9, VM 8대 | - |

---

## 관련 문서

- [00_사이징.md](00_사이징.md) - 사이징 가정서 및 요청서
- [00_프로젝트_계획서.md](00_프로젝트_계획서.md) - 프로젝트 계획서
- [00_요구사항_명세서.md](00_요구사항_명세서.md) - 요구사항 명세서
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 개요서
- [02_팀_역할분담.md](02_팀_역할분담.md) - 팀 역할분담
- [03_상세설계_가이드.md](03_상세설계_가이드.md) - 상세설계 가이드
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md) - 네트워크/보안 설계서
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계서
