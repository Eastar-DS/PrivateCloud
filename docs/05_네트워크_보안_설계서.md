# 네트워크/보안 설계서

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 멀티 테넌트 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 네트워크/보안 설계서 |
| 버전 | 4.0 |
| 작성일 | 2026-02-05 |
| 담당팀 | 네트워크/보안 팀 |

---

**목차**

1. [설계 개요 및 목표](#1-설계-개요-및-목표)
2. [망분리 설계](#2-망분리-설계)
3. [마이크로세그멘테이션](#3-마이크로세그멘테이션)
4. [방화벽 정책](#4-방화벽-정책)
5. [로드밸런서 설계](#5-로드밸런서-설계)
6. [인증 연동 및 접근 제어](#6-인증-연동-및-접근-제어)
7. [암호화 체계](#7-암호화-체계)
8. [감사 및 로깅](#8-감사-및-로깅)

---

## 1. 설계 개요 및 목표

### 1.1 설계 목표

| 목표 | 설명 | 검증 방법 |
|------|------|----------|
| **망분리** | 서비스/데이터/관리 네트워크 존 분리 | VLAN 구성 확인 |
| **테넌트 격리** | 부서 간 네트워크 통신 차단 | 격리 테스트 |
| **서비스 보호** | 태깅 서비스 내부망 격리 | 접근 제어 확인 |
| **접근 제어** | 기존 내부 인증 연동, RBAC 기반 권한 관리 | 권한 테스트 |
| **암호화** | 전송/저장 데이터 암호화 | 암호화 적용 확인 |

### 1.2 설계 범위

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     네트워크/보안 설계 범위                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   In-Scope (담당 영역)                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - 망분리 설계 (VLAN, 네트워크 존)                                   │  │
│   │  - 서비스 네트워크 (프론트엔드/백엔드/스토리지망)                    │  │
│   │  - 마이크로세그멘테이션 (테넌트 간 격리)                             │  │
│   │  - 방화벽 정책 (Security Group)                                     │  │
│   │  - 로드밸런서 설계                                                   │  │
│   │  - 내부 인증 연동 설계                                               │  │
│   │  - RBAC 설계 및 구현                                                 │  │
│   │  - 암호화 체계 (TLS, 저장 데이터)                                    │  │
│   │  - 감사 로깅                                                         │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   협업 영역 (다른 팀과 공동)                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - VM 네트워크 연결 (컴퓨트/개발 팀)                                 │  │
│   │  - 스토리지 네트워크 (스토리지 팀)                                   │  │
│   │  - 모니터링 네트워크 (공통)                                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   Out-of-Scope (범위 외)                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - 로그인 기능 구현 (기존 내부 인증 체계 활용)                       │  │
│   │  - 인증 서버 구축 (기존 시스템 연동)                                 │  │
│   │  - GPU 네트워크 설계 (설계 문서만, 구현 제외)                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 인증 전제 조건

> **중요**: 본 시스템은 기존 내부 인증 체계가 존재함을 전제로 설계됩니다.
> - 로그인 기능은 구현하지 않음
> - 기존 인증 시스템으로부터 사용자 정보를 수신하여 DB에 저장
> - 인증된 사용자 정보를 기반으로 접근 제어 수행

---

## 2. 망분리 설계

### 2.1 네트워크 존 정의

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        네트워크 존 구조 (6개 VLAN)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [기관 내부망]                                                              │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  서비스망 (VLAN 10)                                                 │  │
│   │  - 웹 서버, API Gateway                                             │  │
;<font color="#666666">│   │  - 기관 내부 사용자 접근 구간                                       │  │
│   │  - 기존 인증 시스템 연동 지점                                       │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  테넌트 데이터 영역 (VLAN 20, 21, 22)                               │  │
│   │  ┌───────────┐  ┌───────────┐  ┌───────────┐                       │  │
│   │  │ 부서 A    │  │ 부서 B    │  │ 부서 C    │                       │  │
│   │  │ 문서 저장 │  │ 문서 저장 │  │ 문서 저장 │                       │  │
│   │  │ VLAN 20   │  │ VLAN 21   │  │ VLAN 22   │                       │  │
│   │  └───────────┘  └───────────┘  └───────────┘                       │  │
│   │      ↕ 테넌트 간 통신 차단 (마이크로세그멘테이션)                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  백엔드망 (VLAN 30)                                                 │  │
│   │  - 태깅 워커, 모델 서빙 서버                                        │  │
│   │  - 메타데이터 DB, 검색 서버                                         │  │
│   │  - 비동기 큐 (RabbitMQ)                                             │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  스토리지망 (VLAN 40)                                               │  │
│   │  - Ceph 클러스터 전용 네트워크                                       │  │
│   │  - 문서 원본/태깅 결과 저장                                          │  │
│   │  - 고대역폭, 저지연 (10Gbps)                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  관리망 (VLAN 100)                                                  │  │
│   │  - SSH 접근 (Bastion 경유)                                          │  │
│   │  - 모니터링, 관리 콘솔                                               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 VLAN 할당 계획

| VLAN ID | 네트워크 존 | IP 대역 | 용도 | MTU |
|---------|-----------|---------|------|-----|
| **10** | 서비스망 | 10.0.10.0/24 | 웹 서버, API Gateway, 인증 연동 | 1500 |
| **20** | 테넌트 A | 10.0.20.0/24 | 부서 A 문서 데이터 영역 | 1500 |
| **21** | 테넌트 B | 10.0.21.0/24 | 부서 B 문서 데이터 영역 | 1500 |
| **22** | 테넌트 C | 10.0.22.0/24 | 부서 C 문서 데이터 영역 | 1500 |
| **30** | 백엔드망 | 10.0.30.0/24 | 태깅 워커, DB, 검색 서버 | 1500 |
| **40** | 스토리지망 | 10.0.40.0/24 | Ceph 클러스터 | 9000 |
| **100** | 관리망 | 10.0.100.0/24 | 관리, 모니터링 | 1500 |

**총 VLAN 사용: 7개**

### 2.3 IP 대역 설계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        IP 대역 할당 상세                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   10.0.10.0/24 (서비스망)                                                   │
│   ├── 10.0.10.1       : 게이트웨이                                          │
│   ├── 10.0.10.10-15   : 웹 서버                                             │
│   ├── 10.0.10.20-25   : API Gateway                                         │
│   └── 10.0.10.50      : 인증 연동 프록시                                     │
│                                                                             │
│   10.0.20.0/24 (테넌트 A - 부서 A 문서 영역)                                │
│   ├── 10.0.20.1       : 게이트웨이                                          │
│   └── 10.0.20.10-50   : 부서 A 전용 스토리지 접근                            │
│                                                                             │
│   10.0.21.0/24 (테넌트 B - 부서 B 문서 영역)                                │
│   ├── 10.0.21.1       : 게이트웨이                                          │
│   └── 10.0.21.10-50   : 부서 B 전용 스토리지 접근                            │
│                                                                             │
│   10.0.22.0/24 (테넌트 C - 부서 C 문서 영역)                                │
│   ├── 10.0.22.1       : 게이트웨이                                          │
│   └── 10.0.22.10-50   : 부서 C 전용 스토리지 접근                            │
│                                                                             │
│   10.0.30.0/24 (백엔드망)                                                   │
│   ├── 10.0.30.1       : 게이트웨이                                          │
│   ├── 10.0.30.10-15   : 태깅 워커                                           │
│   ├── 10.0.30.20-22   : 모델 서빙 서버                                       │
│   ├── 10.0.30.30-32   : PostgreSQL (메타데이터 DB)                          │
│   ├── 10.0.30.40-42   : Elasticsearch (검색)                                │
│   ├── 10.0.30.50      : RabbitMQ (비동기 큐)                                │
│   └── 10.0.30.60      : Redis (캐시)                                        │
│                                                                             │
│   10.0.40.0/24 (스토리지망)                                                 │
│   ├── 10.0.40.1       : 게이트웨이                                          │
│   ├── 10.0.40.10-12   : Ceph MON                                            │
│   ├── 10.0.40.20-30   : Ceph OSD (문서 저장)                                │
│   └── 10.0.40.40-42   : Ceph MDS (CephFS용)                                 │
│                                                                             │
│   10.0.100.0/24 (관리망)                                                    │
│   ├── 10.0.100.1      : 게이트웨이                                          │
│   ├── 10.0.100.10     : Bastion Host                                        │
│   ├── 10.0.100.20-22  : 모니터링 (Prometheus, Grafana)                      │
│   └── 10.0.100.30     : 로그 수집 (ELK)                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 네트워크 토폴로지

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        물리 네트워크 토폴로지                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                     [기관 내부 네트워크]                                     │
│                              │                                              │
│                              ▼                                              │
│                     ┌──────────────┐                                        │
│                     │   방화벽     │                                        │
│                     │  (L3/L4 FW)  │                                        │
│                     └──────┬───────┘                                        │
│                            │                                                │
│              ┌─────────────┼─────────────┐                                  │
│              ▼             ▼             ▼                                  │
│        ┌──────────┐  ┌──────────┐  ┌──────────┐                            │
│        │  Core    │──│  Core    │──│  Core    │   (이중화)                  │
│        │ Switch 1 │  │ Switch 2 │  │ Switch 3 │                            │
│        │ (Spine)  │  │ (Spine)  │  │ (Spine)  │                            │
│        └────┬─────┘  └────┬─────┘  └────┬─────┘                            │
│             │             │             │                                   │
│    ┌────────┴─────────────┴─────────────┴────────┐                         │
│    │                                              │                         │
│    ▼                    ▼                    ▼                              │
│  ┌──────────┐      ┌──────────┐      ┌──────────┐                          │
│  │ Leaf SW  │      │ Leaf SW  │      │ Leaf SW  │  (ToR)                   │
│  │ (Rack 1) │      │ (Rack 2) │      │ (Rack 3) │                          │
│  └────┬─────┘      └────┬─────┘      └────┬─────┘                          │
│       │                 │                 │                                 │
│  ┌────┴────┐       ┌────┴────┐       ┌────┴────┐                           │
│  │ HCI     │       │ HCI     │       │ HCI     │                           │
│  │ Node 1-3│       │ Node 4-6│       │ Node 7-9│                           │
│  │ (서비스)│       │ (백엔드)│       │(스토리지)│                           │
│  └─────────┘       └─────────┘       └─────────┘                           │
│                                                                             │
│   VLAN Trunk: 모든 VLAN (10,20,21,22,30,40,100)                            │
│   Bonding: LACP (4x10G → 40Gbps per node)                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 마이크로세그멘테이션

### 3.1 세그멘테이션 원칙

> **기본 차단, 명시적 허용 (Default Deny, Explicit Allow)**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     마이크로세그멘테이션 개념                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   기존 방식 (Perimeter Security)                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    내부 네트워크                                     │  │
│   │   [VM-A] ◄───────► [VM-B] ◄───────► [VM-C]                         │  │
│   │              ✓ 내부 통신 자유                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│   문제: 하나가 침해되면 전체 확산 가능                                      │
│                                                                             │
│   마이크로세그멘테이션 (Zero Trust)                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │   ┌───────┐     ┌───────┐     ┌───────┐                            │  │
│   │   │ VM-A  │     │ VM-B  │     │ VM-C  │                            │  │
│   │   │ ───── │     │ ───── │     │ ───── │                            │  │
│   │   │정책 A │     │정책 B │     │정책 C │                            │  │
│   │   └───┬───┘     └───┬───┘     └───┬───┘                            │  │
│   │       │     ✗       │     ✗       │                                 │  │
│   │       └─────────────┴─────────────┘                                 │  │
│   │            허용된 통신만 가능                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│   효과: 침해 시 영향 범위 최소화                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 테넌트(부서) 간 격리

| 출발지 | 목적지 | 허용 여부 | 비고 |
|--------|--------|----------|------|
| 부서 A | 부서 B | **차단** | 기본 정책 |
| 부서 A | 부서 C | **차단** | 기본 정책 |
| 부서 B | 부서 C | **차단** | 기본 정책 |
| 부서 A | 백엔드망 | **차단** | 직접 접근 불가 (API 경유) |
| 부서 A | 서비스망 | **허용** | API Gateway 경유 (443) |
| 부서 A | 스토리지망 | **차단** | 직접 접근 불가 |
| 부서 A | 관리망 | **차단** | Bastion 제외 |

### 3.3 문서 태깅 서비스 데이터 흐름 정책

```
┌─────────────────────────────────────────────────────────────────────────────┐
│               문서 태깅 서비스 데이터 흐름 정책                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [기관 내부 사용자]                                                        │
│          │                                                                  │
│          │ HTTPS (443) - 기존 인증 정보 포함                                │
│          ▼                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  서비스망 (VLAN 10)                                                 │  │
│   │  ┌──────────────┐   ┌──────────────┐                               │  │
│   │  │   웹 서버    │   │ API Gateway  │                               │  │
│   │  │ (프론트엔드) │ → │ (인증 검증)  │                               │  │
│   │  └──────────────┘   └──────┬───────┘                               │  │
│   └────────────────────────────┼───────────────────────────────────────┘  │
│                                │ 내부 API (8080)                           │
│                                ▼                                           │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  백엔드망 (VLAN 30)                                                 │  │
│   │  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐            │  │
│   │  │ 태깅 워커    │ ← │  RabbitMQ    │ ← │  API 서버   │            │  │
│   │  │ (비동기처리) │   │   (큐)       │   │              │            │  │
│   │  └──────┬───────┘   └──────────────┘   └──────────────┘            │  │
│   │         │                                                           │  │
│   │         ▼                                                           │  │
│   │  ┌──────────────┐   ┌──────────────┐                               │  │
│   │  │ 모델 서빙    │   │ PostgreSQL   │                               │  │
│   │  │ (추론)       │   │ (메타데이터) │                               │  │
│   │  └──────────────┘   └──────────────┘                               │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                │                                                           │
│                │ NFS/S3 (2049, 9000)                                       │
│                ▼                                                           │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  스토리지망 (VLAN 40)                                               │  │
│   │  ┌──────────────────────────────────────────────────────────────┐  │  │
│   │  │  Ceph 클러스터                                                │  │  │
│   │  │  - 문서 원본 저장 (테넌트별 Pool 분리)                        │  │  │
│   │  │  - 태깅 결과 저장                                             │  │  │
│   │  │  - 모델 파일 저장                                             │  │  │
│   │  └──────────────────────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   허용 규칙:                                                                │
│   - 서비스망 → 백엔드망: 8080 (API 호출)                                   │
│   - 백엔드망 → 스토리지망: 2049, 9000 (파일 접근)                          │
│   - 백엔드망 내부: DB, 큐, 워커 간 통신                                    │
│                                                                             │
│   거부 규칙 (핵심):                                                         │
│   ✗ 테넌트 데이터 영역 → 백엔드망: 직접 접근 불가                          │
│   ✗ 테넌트 데이터 영역 → 스토리지망: 직접 접근 불가                        │
│   ✗ 서비스망 → 스토리지망: 직접 접근 불가                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 서비스 계층 간 통신 정책

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     서비스 계층 간 통신 정책                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  1계층: 서비스망 (VLAN 10)                                          │  │
│   │  - 웹 서버 (프론트엔드)                                             │  │
│   │  - API Gateway (인증 검증, 라우팅)                                  │  │
│   │  - 기존 내부 인증 연동                                              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                           │                                                 │
│                           │ 8080 (HTTP/REST)                                │
│                           ▼                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  2계층: 백엔드망 (VLAN 30)                                          │  │
│   │  - API 서버 (비즈니스 로직)                                         │  │
│   │  - 태깅 워커 (비동기 처리)                                          │  │
│   │  - 모델 서빙 (추론)                                                 │  │
│   │  - 메타데이터 DB, 검색 서버                                         │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                           │                                                 │
│                           │ NFS/S3 (2049, 9000)                             │
│                           ▼                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  3계층: 스토리지망 (VLAN 40)                                        │  │
│   │  - Ceph 클러스터                                                    │  │
│   │  - 테넌트별 Pool 격리                                               │  │
│   │  - 문서/모델/결과 저장                                              │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   계층 간 통신 매트릭스:                                                    │
│   ┌──────────────────┬─────────┬─────────┬─────────┐                       │
│   │ 출발 \ 목적지    │ 1계층   │ 2계층   │ 3계층   │                       │
│   ├──────────────────┼─────────┼─────────┼─────────┤                       │
│   │ 1계층 (서비스)   │ 허용    │ 허용    │ 차단    │                       │
│   │ 2계층 (백엔드)   │ 응답만  │ 허용    │ 허용    │                       │
│   │ 3계층 (스토리지) │ 차단    │ 응답만  │ 허용    │                       │
│   └──────────────────┴─────────┴─────────┴─────────┘                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 방화벽 정책

### 4.1 계층별 접근 제어 규칙

#### 4.1.1 서비스망 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **SVC-001** | 기관 내부망 | 서비스망 웹서버 | 443 | TCP | 허용 |
| **SVC-002** | 기관 내부망 | 서비스망 API GW | 443 | TCP | 허용 |
| **SVC-003** | 서비스망 | 백엔드망 | 8080 | TCP | 허용 |
| **SVC-004** | 관리망 | 서비스망 | 22 | TCP | 허용 |
| **SVC-999** | ANY | 서비스망 | ANY | ANY | **거부** |

#### 4.1.2 테넌트(부서) 데이터 영역 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **TNT-001** | 부서 A | 부서 B | ANY | ANY | **거부** |
| **TNT-002** | 부서 A | 부서 C | ANY | ANY | **거부** |
| **TNT-003** | 부서 B | 부서 C | ANY | ANY | **거부** |
| **TNT-004** | 부서 ANY | 백엔드망 | ANY | ANY | **거부** |
| **TNT-005** | 부서 ANY | 스토리지망 | ANY | ANY | **거부** |
| **TNT-006** | 관리망 | 테넌트 데이터 영역 | 22 | TCP | 허용 |
| **TNT-999** | ANY | 테넌트 데이터 영역 | ANY | ANY | **거부** |

> **참고**: 테넌트(부서)는 API Gateway를 통해서만 서비스에 접근 가능

#### 4.1.3 백엔드망 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **BE-001** | 서비스망 | 백엔드망 API 서버 | 8080 | TCP | 허용 |
| **BE-002** | 백엔드망 | 백엔드망 DB | 5432 | TCP | 허용 |
| **BE-003** | 백엔드망 | 백엔드망 Redis | 6379 | TCP | 허용 |
| **BE-004** | 백엔드망 | 백엔드망 RabbitMQ | 5672 | TCP | 허용 |
| **BE-005** | 백엔드망 | 백엔드망 ES | 9200 | TCP | 허용 |
| **BE-006** | 백엔드망 | 스토리지망 | 2049 | TCP | 허용 (NFS) |
| **BE-007** | 백엔드망 | 스토리지망 | 9000 | TCP | 허용 (S3) |
| **BE-008** | 관리망 | 백엔드망 | 22 | TCP | 허용 |
| **BE-999** | ANY | 백엔드망 | ANY | ANY | **거부** |

#### 4.1.4 스토리지망 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **STG-001** | 백엔드망 | 스토리지망 | 2049 | TCP | 허용 (NFS) |
| **STG-002** | 백엔드망 | 스토리지망 | 9000 | TCP | 허용 (S3) |
| **STG-003** | 스토리지망 | 스토리지망 | 6789 | TCP | 허용 (Ceph MON) |
| **STG-004** | 스토리지망 | 스토리지망 | 6800-7300 | TCP | 허용 (Ceph OSD) |
| **STG-005** | 관리망 | 스토리지망 | 22 | TCP | 허용 |
| **STG-999** | ANY | 스토리지망 | ANY | ANY | **거부** |

### 4.2 Security Group 설계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Security Group 구성                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   SG-WEB (웹 서버용)                                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 443/tcp from 기관 내부망                                         │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 8080/tcp to SG-API-GW                                            │  │
│   │  - 9100/tcp to SG-MONITOR (메트릭)                                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-API-GW (API Gateway용)                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 443/tcp from 기관 내부망                                         │  │
│   │  - 8080/tcp from SG-WEB                                             │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 8080/tcp to SG-API-SERVER                                        │  │
│   │  - 6379/tcp to SG-REDIS (세션/캐시)                                 │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-API-SERVER (API 서버용)                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 8080/tcp from SG-API-GW                                          │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 5432/tcp to SG-DB                                                │  │
│   │  - 5672/tcp to SG-RABBITMQ                                          │  │
│   │  - 9200/tcp to SG-SEARCH                                            │  │
│   │  - 2049,9000/tcp to SG-STORAGE                                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-TAGGING-WORKER (태깅 워커용)                                           │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 5672/tcp to SG-RABBITMQ (작업 수신)                              │  │
│   │  - 8080/tcp to SG-MODEL-SERVER (추론 요청)                          │  │
│   │  - 5432/tcp to SG-DB (결과 저장)                                    │  │
│   │  - 2049,9000/tcp to SG-STORAGE (문서 접근)                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-MODEL-SERVER (모델 서빙용)                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 8080/tcp from SG-TAGGING-WORKER                                  │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 2049,9000/tcp to SG-STORAGE (모델 로드)                          │  │
│   │  - 9100/tcp to SG-MONITOR                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-DB (PostgreSQL용)                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 5432/tcp from SG-API-SERVER                                      │  │
│   │  - 5432/tcp from SG-TAGGING-WORKER                                  │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 9100/tcp to SG-MONITOR                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-STORAGE (Ceph 클러스터용)                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 2049/tcp from SG-API-SERVER, SG-TAGGING-WORKER (NFS)             │  │
│   │  - 9000/tcp from SG-API-SERVER, SG-TAGGING-WORKER (S3)              │  │
│   │  - 6789,6800-7300/tcp from SG-STORAGE (Ceph 내부)                   │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 9100/tcp to SG-MONITOR                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-BASTION (Bastion Host용)                                               │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 22/tcp from 관리자 IP (Whitelist)                                │  │
│   │  Outbound:                                                          │  │
│   │  - 22/tcp to ALL (내부망)                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 로드밸런서 설계

### 5.1 로드밸런서 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     로드밸런서 구성                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [기관 내부 사용자]                                                        │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    L7 Load Balancer (HAProxy)                       │  │
│   │                                                                     │  │
│   │   VIP: 10.0.10.10                                                   │  │
│   │                                                                     │  │
│   │   URL Routing (문서 태깅 서비스):                                   │  │
│   │   - /                  → 웹 서버 (프론트엔드)                       │  │
│   │   - /api/v1/documents  → API Gateway (문서 관리)                   │  │
│   │   - /api/v1/tags       → API Gateway (태그 관리)                   │  │
│   │   - /api/v1/search     → API Gateway (검색)                        │  │
│   │   - /api/v1/status     → API Gateway (태깅 상태)                   │  │
│   │   - /health            → Health Check                              │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│           │                │                                               │
│           ▼                ▼                                               │
│     ┌──────────┐    ┌──────────┐                                          │
│     │ 웹 서버  │    │ API      │                                          │
│     │ Pool     │    │ Gateway  │                                          │
│     │ (2대)    │    │ Pool     │                                          │
│     │          │    │ (2대)    │                                          │
│     └──────────┘    └──────────┘                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 로드밸런서 설정

| 항목 | 설정 값 |
|------|--------|
| **알고리즘** | Round Robin (기본), Least Connections (API) |
| **Health Check** | HTTP /health, 10초 간격, 3회 실패 시 제외 |
| **Session Persistence** | Cookie 기반 (웹), 없음 (API) |
| **SSL Termination** | LB에서 TLS 1.3 종료 |
| **Connection Timeout** | 연결 30초, 읽기 60초 |
| **Rate Limiting** | 테넌트(부서)별 1000 req/min |

### 5.3 API 라우팅 상세

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     API 라우팅 상세                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [사용자]                                                                  │
│       │                                                                     │
│       │ /api/v1/documents/upload (문서 업로드)                             │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    API Gateway (L7)                                 │  │
│   │                                                                     │  │
│   │   VIP: 10.0.10.20                                                   │  │
│   │                                                                     │  │
│   │   Endpoint Routing:                                                 │  │
│   │   - POST /v1/documents/upload → API 서버 (업로드 처리)             │  │
│   │   - GET  /v1/documents/{id}   → API 서버 (문서 조회)               │  │
│   │   - GET  /v1/documents/{id}/tags → API 서버 (태그 조회)            │  │
│   │   - GET  /v1/search          → API 서버 (검색)                     │  │
│   │   - GET  /v1/status/{job_id} → API 서버 (태깅 상태)                │  │
│   │                                                                     │  │
│   │   인증 검증:                                                        │  │
│   │   - 기존 인증 토큰 검증                                             │  │
│   │   - 사용자/부서 정보 추출                                           │  │
│   │   - 권한(RBAC) 확인                                                 │  │
│   │                                                                     │  │
│   │   Rate Limiting (테넌트별):                                        │  │
│   │   - /v1/documents/upload: 100 req/min                              │  │
│   │   - /v1/search: 500 req/min                                        │  │
│   │   - 기타: 1000 req/min                                             │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                    │                                                       │
│                    ▼                                                       │
│              ┌──────────┐                                                  │
│              │ API 서버 │                                                  │
│              │ Pool     │                                                  │
│              │ (2대)    │                                                  │
│              └──────────┘                                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 인증 연동 및 접근 제어

### 6.1 인증 연동 아키텍처

> **전제**: 본 시스템은 로그인 기능을 구현하지 않습니다.
> 기관의 기존 내부 인증 시스템과 연동하여 사용자 정보를 수신합니다.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     인증 연동 아키텍처                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [기관 내부 인증 시스템] (기존 시스템 - 구현 범위 외)                        │
│         │                                                                   │
│         │ 1. 인증된 사용자 정보 전달                                         │
│         │    (토큰 또는 헤더)                                                │
│         ▼                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    API Gateway                                      │  │
│   │                                                                     │  │
│   │   2. 인증 정보 검증                                                  │  │
│   │      - 토큰 유효성 확인                                              │  │
│   │      - 사용자/부서 정보 추출                                         │  │
│   │      - 권한(RBAC) 확인                                               │  │
│   │                                                                     │  │
│   └────────┬────────────────────────────────────────────────────────────┘  │
│            │ 3. 인증 컨텍스트 전달                                          │
│            ▼                                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    API 서버                                         │  │
│   │                                                                     │  │
│   │   4. 사용자 정보 DB 저장/조회                                        │  │
│   │      - 최초 접근 시 사용자 정보 저장                                 │  │
│   │      - 부서 매핑 관리                                                │  │
│   │      - 권한 정보 캐싱                                                │  │
│   │                                                                     │  │
│   └────────┬────────────────────────────────────────────────────────────┘  │
│            │ 5. 사용자 정보 저장                                            │
│            ▼                                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    PostgreSQL (사용자 DB)                           │  │
│   │                                                                     │  │
│   │   users 테이블:                                                      │  │
│   │   - user_id (기관 인증 시스템의 ID)                                  │  │
│   │   - department_id (부서 A/B/C)                                       │  │
│   │   - role (admin, user, viewer)                                       │  │
│   │   - created_at, last_login_at                                        │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ※ 로그인 화면, 비밀번호 관리 등은 구현하지 않음                           │
│   ※ 기존 인증 시스템의 토큰/세션을 신뢰                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 RBAC 역할 정의

| 역할 | 권한 | 대상 리소스 |
|------|------|-----------|
| **platform-admin** | 전체 관리 | 모든 리소스, 모든 부서 |
| **dept-admin-a** | 부서 A 관리 | 부서 A 문서, 태그 관리 |
| **dept-admin-b** | 부서 B 관리 | 부서 B 문서, 태그 관리 |
| **dept-admin-c** | 부서 C 관리 | 부서 C 문서, 태그 관리 |
| **dept-user** | 문서 업로드/조회 | 소속 부서 문서 |
| **viewer** | 조회만 | 소속 부서 문서 (읽기 전용) |

### 6.3 권한 매트릭스

| 역할 | 문서 업로드 | 문서 조회 | 태그 수정 | 검색 | 설정 관리 |
|------|-----------|----------|----------|------|----------|
| platform-admin | O (전체) | O (전체) | O (전체) | O (전체) | O |
| dept-admin | O (자기 부서) | O (자기 부서) | O (자기 부서) | O (자기 부서) | O (자기 부서) |
| dept-user | O (자기 부서) | O (자기 부서) | X | O (자기 부서) | X |
| viewer | X | O (자기 부서) | X | O (자기 부서) | X |

### 6.4 테넌트(부서) 격리 모델

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     테넌트 격리 모델                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   인증된 요청 (기존 인증 시스템에서 전달)                                    │
│         │                                                                   │
│         ▼                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  테넌트(부서) 컨텍스트 주입                                          │  │
│   │                                                                     │  │
│   │  요청 헤더 예시:                                                     │  │
│   │  X-User-ID: user123                                                 │  │
│   │  X-Department-ID: dept-a                                            │  │
│   │  X-Role: dept-user                                                  │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                                   │
│         ▼                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  리소스 접근 시 테넌트 필터링                                        │  │
│   │                                                                     │  │
│   │  SQL 예시:                                                           │  │
│   │  SELECT * FROM documents                                             │  │
│   │  WHERE department_id = 'dept-a'  -- 자동 추가                       │  │
│   │    AND user_id = 'user123'                                           │  │
│   │                                                                     │  │
│   │  스토리지 접근:                                                      │  │
│   │  Ceph Pool: pool-dept-a  -- 부서별 분리                             │  │
│   │  경로: /dept-a/documents/{doc_id}                                   │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   격리 보장:                                                                │
│   - DB: 모든 쿼리에 department_id 조건 자동 추가                           │
│   - 스토리지: 부서별 Ceph Pool 분리 (pool-dept-a, pool-dept-b, pool-dept-c)│
│   - API: 테넌트 컨텍스트 미포함 요청 거부                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 암호화 체계

### 7.1 전송 구간 암호화 (TLS)

| 구간 | 프로토콜 | 설정 |
|------|---------|------|
| **사용자 → LB** | TLS 1.3 | 인증서 적용, HSTS |
| **LB → 웹서버** | TLS 1.2+ | 내부 인증서 |
| **LB → API Gateway** | TLS 1.2+ | 내부 인증서 |
| **API Gateway → 백엔드** | HTTP | 내부망 (VLAN 격리) |
| **백엔드 → 스토리지** | 암호화 선택적 | 내부망 (VLAN 격리) |
| **관리 접속** | SSH | 키 기반 인증 |

### 7.2 저장 데이터 암호화

| 대상 | 암호화 방식 | 키 관리 |
|------|-----------|--------|
| **문서 스토리지 (Ceph)** | AES-256-XTS | Ceph 자체 암호화 |
| **메타데이터 DB** | TDE (AES-256) | PostgreSQL 자체 관리 |
| **모델 파일** | AES-256 | 파일 시스템 레벨 |
| **백업 데이터** | AES-256 | 별도 키 관리 |

### 7.3 인증서 관리

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     인증서 구조                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [Internal CA] (기관 내부 CA 또는 자체 CA)                                 │
│       │                                                                     │
│       ├── [서비스 인증서]                                                   │
│       │       │                                                             │
│       │       └── 웹 서버, API Gateway 인증서                               │
│       │                                                                     │
│       └── [내부 통신 인증서]                                                │
│               │                                                             │
│               ├── 서비스 간 mTLS (선택적)                                   │
│               └── 관리용 인증서                                             │
│                                                                             │
│   인증서 유효기간:                                                          │
│   - 서비스 인증서: 1년 (자동 갱신)                                          │
│   - 내부 인증서: 2년                                                        │
│   - CA: 10년                                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 감사 및 로깅

### 8.1 로깅 대상

| 로그 유형 | 수집 대상 | 보관 기간 |
|----------|----------|----------|
| **접근 로그** | API 호출, 문서 접근 | 90일 |
| **변경 로그** | 문서 업로드/수정/삭제, 태그 변경 | 1년 |
| **보안 로그** | 인증 실패, 권한 오류, 방화벽 차단 | 1년 |
| **시스템 로그** | OS, 서비스 로그 | 30일 |

### 8.2 로그 형식

```json
{
  "timestamp": "2026-02-05T10:30:00Z",
  "log_type": "document_access",
  "department_id": "dept-a",
  "user_id": "user123",
  "source_ip": "10.0.10.100",
  "action": "document.upload",
  "resource": "documents/doc-uuid-1234",
  "request_id": "req-uuid-5678",
  "file_size": 1048576,
  "file_type": "application/pdf",
  "result": "success",
  "latency_ms": 250
}
```

### 8.3 로그 수집 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     로그 수집 아키텍처                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [각 서비스/VM]                                                            │
│        │                                                                    │
│        │ Filebeat                                                           │
│        ▼                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    Logstash                                         │  │
│   │                    (로그 파싱/변환)                                 │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│        │                                                                    │
│        ▼                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    Elasticsearch                                    │  │
│   │                    (검색/분석용)                                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│        │                                                                    │
│        ▼                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    Kibana / Grafana                                 │  │
│   │                    (시각화/대시보드)                                │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 8.4 알림 정책

| 이벤트 | 심각도 | 조건 | 알림 방법 |
|--------|--------|------|----------|
| 인증 실패 연속 5회 | Critical | 동일 사용자/IP | 즉시 알림 |
| 권한 밖 접근 시도 | High | 타 부서 문서 접근 시도 | 즉시 알림 |
| 업로드 용량 90% 도달 | Medium | 부서별 쿼터 | 10분 내 알림 |
| 방화벽 차단 급증 | Medium | 1분간 100건 이상 | 10분 내 알림 |
| 비정상 트래픽 패턴 | High | 이상 탐지 | 즉시 알림 |
| SSL 인증서 만료 임박 | Medium | 30일 이내 만료 | 일일 알림 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-30 | 초안 작성 | - |
| 2.0 | 2026-02-02 | AI 플랫폼 네트워크 추가 | - |
| 3.0 | 2026-02-04 | AI 플랫폼 중심 재구성 | - |
| 4.0 | 2026-02-05 | **문서 태깅 시스템용 전면 재구성**: 테넌트→부서 A/B/C, 인증 연동 설계(로그인 미구현), 서비스 계층 단순화 | - |

---

## 관련 문서

- [00_프로젝트_계획서.md](00_프로젝트_계획서.md) - 프로젝트 계획서
- [00_요구사항_명세서.md](00_요구사항_명세서.md) - 요구사항 명세서
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 개요서
- [02_팀_역할분담.md](02_팀_역할분담.md) - 팀 역할분담
- [03_상세설계_가이드.md](03_상세설계_가이드.md) - 상세설계 가이드
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md) - 컴퓨트 설계서
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계서
