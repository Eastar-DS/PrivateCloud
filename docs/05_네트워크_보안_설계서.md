# 네트워크/보안 설계서

## 에이블스택(HCI) 기반 멀티테넌트 프라이빗 클라우드 인프라 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 네트워크/보안 설계서 |
| 버전 | 1.0 |
| 작성일 | 2026-01-30 |
| 담당팀 | 네트워크/보안 팀 |

---

**목차**

1. [설계 개요 및 목표](#1-설계-개요-및-목표)
2. [망분리 설계](#2-망분리-설계)
3. [마이크로세그멘테이션](#3-마이크로세그멘테이션)
4. [방화벽 정책](#4-방화벽-정책)
5. [로드밸런서 설계](#5-로드밸런서-설계)
6. [Zero Trust 아키텍처](#6-zero-trust-아키텍처)
7. [암호화 체계](#7-암호화-체계)
8. [감사 및 로깅](#8-감사-및-로깅)

---

## 1. 설계 개요 및 목표

### 1.1 설계 목표

| 목표 | 설명 | 검증 방법 |
|------|------|----------|
| **망분리** | 6개 이상 네트워크 존 분리 | VLAN 구성 확인 |
| **테넌트 격리** | 테넌트 간 네트워크 통신 차단 | 격리 테스트 |
| **접근 제어** | RBAC 기반 권한 관리 | 권한 테스트 |
| **암호화** | 전송/저장 데이터 암호화 | 암호화 적용 확인 |

### 1.2 설계 범위

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     네트워크/보안 설계 범위                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   In-Scope (담당 영역)                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - 망분리 설계 (VLAN, 네트워크 존)                                   │  │
│   │  - 마이크로세그멘테이션 (테넌트 간 격리)                             │  │
│   │  - 방화벽 정책 (Security Group)                                     │  │
│   │  - 로드밸런서 설계                                                   │  │
│   │  - RBAC 설계 및 구현                                                 │  │
│   │  - 암호화 체계 (TLS, 저장 데이터)                                    │  │
│   │  - 감사 로깅                                                         │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   협업 영역 (다른 팀과 공동)                                                │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  - VM 네트워크 연결 (컴퓨트 팀)                                      │  │
│   │  - 스토리지 네트워크 (스토리지 팀)                                   │  │
│   │  - 모니터링 네트워크 (공통)                                          │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 망분리 설계

### 2.1 네트워크 존 정의

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        네트워크 존 구조                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [인터넷]                                                                  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  DMZ (VLAN 10)                                                      │  │
│   │  - 외부 접근 허용 구간                                               │  │
│   │  - 로드밸런서, 리버스 프록시                                         │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  업무망 (VLAN 20, 21, 22)                                           │  │
│   │  ┌───────────┐  ┌───────────┐  ┌───────────┐                       │  │
│   │  │ 테넌트 A  │  │ 테넌트 B  │  │ 테넌트 C  │                       │  │
│   │  │ VLAN 20   │  │ VLAN 21   │  │ VLAN 22   │                       │  │
│   │  └───────────┘  └───────────┘  └───────────┘                       │  │
│   │      ↕ 테넌트 간 통신 차단 (마이크로세그멘테이션)                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  DB망 (VLAN 30)                                                     │  │
│   │  - 데이터베이스 서버 전용                                            │  │
│   │  - 업무망에서만 접근 허용                                            │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  스토리지망 (VLAN 40)                                               │  │
│   │  - Ceph 클러스터 전용 네트워크                                       │  │
│   │  - 고대역폭, 저지연                                                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  관리망 (VLAN 100)                                                  │  │
│   │  - SSH 접근 (Bastion 경유)                                          │  │
│   │  - 모니터링 에이전트 통신                                            │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 VLAN 할당 계획

| VLAN ID | 네트워크 존 | IP 대역 | 용도 |
|---------|-----------|---------|------|
| **10** | DMZ | 10.0.1.0/24 | 외부 접근, 로드밸런서 |
| **20** | 테넌트 A | 10.0.2.0/26 | A시청 업무 환경 |
| **21** | 테넌트 B | 10.0.2.64/26 | B구청 업무 환경 |
| **22** | 테넌트 C | 10.0.2.128/26 | C군청 업무 환경 |
| **30** | DB망 | 10.0.3.0/24 | 데이터베이스 |
| **40** | 스토리지망 | 10.0.4.0/24 | Ceph 전용 |
| **100** | 관리망 | 10.0.10.0/24 | 관리, 모니터링 |

**총 VLAN 사용: 7개** (가용 90개 중)

### 2.3 IP 대역 설계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        IP 대역 할당                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   10.0.1.0/24 (DMZ)                                                         │
│   ├── 10.0.1.1       : 게이트웨이                                           │
│   ├── 10.0.1.10-20   : 로드밸런서 VIP                                       │
│   └── 10.0.1.100-110 : DMZ 서버                                             │
│                                                                             │
│   10.0.2.0/24 (업무망)                                                      │
│   ├── 10.0.2.0/26 (테넌트 A)                                                │
│   │   ├── 10.0.2.1   : 게이트웨이                                           │
│   │   └── 10.0.2.10-60: 테넌트 A VM                                         │
│   ├── 10.0.2.64/26 (테넌트 B)                                               │
│   │   ├── 10.0.2.65  : 게이트웨이                                           │
│   │   └── 10.0.2.70-120: 테넌트 B VM                                        │
│   └── 10.0.2.128/26 (테넌트 C)                                              │
│       ├── 10.0.2.129 : 게이트웨이                                           │
│       └── 10.0.2.130-180: 테넌트 C VM                                       │
│                                                                             │
│   10.0.3.0/24 (DB망)                                                        │
│   ├── 10.0.3.1       : 게이트웨이                                           │
│   └── 10.0.3.10-50   : DB 서버                                              │
│                                                                             │
│   10.0.4.0/24 (스토리지망)                                                  │
│   ├── 10.0.4.1       : 게이트웨이                                           │
│   └── 10.0.4.10-100  : Ceph 노드                                            │
│                                                                             │
│   10.0.10.0/24 (관리망)                                                     │
│   ├── 10.0.10.1      : 게이트웨이                                           │
│   ├── 10.0.10.10     : Bastion Host                                         │
│   └── 10.0.10.50-100 : 모니터링, 관리 서버                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 마이크로세그멘테이션

### 3.1 세그멘테이션 원칙

> **기본 차단, 명시적 허용 (Default Deny, Explicit Allow)**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     마이크로세그멘테이션 개념                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   기존 방식 (Perimeter Security)                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    내부 네트워크                                     │  │
│   │   [VM-A] ◄───────► [VM-B] ◄───────► [VM-C]                         │  │
│   │              ✓ 내부 통신 자유                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│   문제: 하나가 침해되면 전체 확산 가능                                      │
│                                                                             │
│   마이크로세그멘테이션 (Zero Trust)                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │   ┌───────┐     ┌───────┐     ┌───────┐                            │  │
│   │   │ VM-A  │     │ VM-B  │     │ VM-C  │                            │  │
│   │   │ ───── │     │ ───── │     │ ───── │                            │  │
│   │   │정책 A │     │정책 B │     │정책 C │                            │  │
│   │   └───┬───┘     └───┬───┘     └───┬───┘                            │  │
│   │       │     ✗       │     ✗       │                                 │  │
│   │       └─────────────┴─────────────┘                                 │  │
│   │            허용된 통신만 가능                                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│   효과: 침해 시 영향 범위 최소화                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 테넌트 간 격리

| 출발지 | 목적지 | 허용 여부 | 비고 |
|--------|--------|----------|------|
| 테넌트 A | 테넌트 B | **차단** | 기본 정책 |
| 테넌트 A | 테넌트 C | **차단** | 기본 정책 |
| 테넌트 B | 테넌트 C | **차단** | 기본 정책 |
| 테넌트 A | DB망 (공용 DB) | **허용** | 특정 포트만 |
| 테넌트 A | 관리망 | **차단** | Bastion 제외 |

### 3.3 서비스 간 통신 정책

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     서비스 간 통신 정책                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [테넌트 A 내부]                                                           │
│                                                                             │
│   ┌─────────┐         ┌─────────┐         ┌─────────┐                     │
│   │  Web    │ ──8080──► │  App    │ ──5432──► │  DB     │                     │
│   │ Server  │         │ Server  │         │ Server  │                     │
│   └─────────┘         └─────────┘         └─────────┘                     │
│       ▲                                                                     │
│       │ 443                                                                 │
│   [LB/DMZ]                                                                  │
│                                                                             │
│   허용 규칙:                                                                │
│   - DMZ → Web: 443 (HTTPS)                                                 │
│   - Web → App: 8080 (HTTP)                                                 │
│   - App → DB: 5432 (PostgreSQL)                                            │
│                                                                             │
│   거부 규칙 (암묵적):                                                       │
│   - Web → DB: 직접 접근 차단                                                │
│   - App → Web: 역방향 차단 (응답 제외)                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 방화벽 정책

### 4.1 계층별 접근 제어 규칙

#### 4.1.1 DMZ 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **DMZ-001** | ANY | DMZ LB | 443 | TCP | 허용 |
| **DMZ-002** | DMZ LB | 업무망 | 8080 | TCP | 허용 |
| **DMZ-003** | 관리망 | DMZ | 22 | TCP | 허용 |
| **DMZ-999** | ANY | DMZ | ANY | ANY | **거부** |

#### 4.1.2 업무망 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **BIZ-001** | 테넌트 A | DB망 | 5432 | TCP | 허용 |
| **BIZ-002** | 테넌트 B | DB망 | 5432 | TCP | 허용 |
| **BIZ-003** | 테넌트 C | DB망 | 5432 | TCP | 허용 |
| **BIZ-004** | 관리망 | 업무망 | 22 | TCP | 허용 |
| **BIZ-005** | 업무망 | 업무망 (동일 테넌트) | ANY | ANY | 허용 |
| **BIZ-006** | 테넌트 A | 테넌트 B | ANY | ANY | **거부** |
| **BIZ-007** | 테넌트 A | 테넌트 C | ANY | ANY | **거부** |
| **BIZ-008** | 테넌트 B | 테넌트 C | ANY | ANY | **거부** |
| **BIZ-999** | ANY | 업무망 | ANY | ANY | **거부** |

#### 4.1.3 DB망 방화벽 규칙

| 규칙 ID | 출발지 | 목적지 | 포트 | 프로토콜 | 동작 |
|---------|--------|--------|------|---------|------|
| **DB-001** | 업무망 | DB망 | 5432 | TCP | 허용 |
| **DB-002** | 관리망 | DB망 | 22 | TCP | 허용 |
| **DB-999** | ANY | DB망 | ANY | ANY | **거부** |

### 4.2 Security Group 설계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Security Group 구성                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   SG-WEB (웹서버용)                                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 443/tcp from SG-LB                                               │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 8080/tcp to SG-APP                                               │  │
│   │  - 9100/tcp to SG-MONITOR (메트릭)                                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-APP (애플리케이션용)                                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 8080/tcp from SG-WEB                                             │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 5432/tcp to SG-DB                                                │  │
│   │  - 9100/tcp to SG-MONITOR                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-DB (데이터베이스용)                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 5432/tcp from SG-APP                                             │  │
│   │  - 22/tcp from SG-BASTION                                           │  │
│   │  Outbound:                                                          │  │
│   │  - 9100/tcp to SG-MONITOR                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   SG-BASTION (Bastion Host용)                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  Inbound:                                                           │  │
│   │  - 22/tcp from 관리자 IP                                            │  │
│   │  Outbound:                                                          │  │
│   │  - 22/tcp to ALL (내부망)                                           │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 로드밸런서 설계

### 5.1 로드밸런서 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     로드밸런서 구성                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [인터넷]                                                                  │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    L7 Load Balancer                                 │  │
│   │                   (HAProxy / Nginx)                                 │  │
│   │                                                                     │  │
│   │   VIP: 10.0.1.10                                                    │  │
│   │   Public IP: xxx.xxx.xxx.xxx                                        │  │
│   │                                                                     │  │
│   │   URL Routing:                                                      │  │
│   │   - /tenant-a/* → 테넌트 A 웹서버                                   │  │
│   │   - /tenant-b/* → 테넌트 B 웹서버                                   │  │
│   │   - /tenant-c/* → 테넌트 C 웹서버                                   │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                    │                │                │                     │
│                    ▼                ▼                ▼                     │
│              ┌──────────┐    ┌──────────┐    ┌──────────┐                 │
│              │ 테넌트 A │    │ 테넌트 B │    │ 테넌트 C │                 │
│              │ Web Pool │    │ Web Pool │    │ Web Pool │                 │
│              └──────────┘    └──────────┘    └──────────┘                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 로드밸런서 설정

| 항목 | 설정 값 |
|------|--------|
| **알고리즘** | Round Robin |
| **Health Check** | HTTP /health, 10초 간격 |
| **Session Persistence** | 없음 (Stateless) |
| **SSL Termination** | LB에서 종료 |
| **Timeout** | 연결 30초, 읽기 60초 |

---

## 6. Zero Trust 아키텍처

### 6.1 인증/인가 체계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Zero Trust 인증 흐름                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [사용자/서비스]                                                           │
│         │                                                                   │
│         │ 1. 인증 요청                                                      │
│         ▼                                                                   │
│   ┌─────────────────┐                                                      │
│   │   인증 서버     │   - ID/Password 검증                                  │
│   │   (SSO/LDAP)    │   - MFA (관리자)                                      │
│   └────────┬────────┘                                                      │
│            │ 2. 토큰 발급                                                   │
│            ▼                                                                │
│   ┌─────────────────┐                                                      │
│   │   API Gateway   │   - 토큰 검증                                         │
│   │                 │   - 권한 확인 (RBAC)                                  │
│   └────────┬────────┘                                                      │
│            │ 3. 접근 허용                                                   │
│            ▼                                                                │
│   ┌─────────────────┐                                                      │
│   │   리소스 접근   │                                                      │
│   └─────────────────┘                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 RBAC 역할 정의

| 역할 | 권한 | 대상 리소스 |
|------|------|-----------|
| **platform-admin** | 전체 관리 | 모든 리소스 |
| **tenant-admin-a** | 테넌트 A 관리 | 테넌트 A 리소스만 |
| **tenant-admin-b** | 테넌트 B 관리 | 테넌트 B 리소스만 |
| **tenant-admin-c** | 테넌트 C 관리 | 테넌트 C 리소스만 |
| **tenant-user** | 리소스 사용 (읽기/실행) | 할당된 리소스 |
| **auditor** | 로그 조회 (읽기 전용) | 감사 로그 |

### 6.3 권한 매트릭스

| 역할 | VM 생성 | VM 삭제 | 네트워크 설정 | 사용자 관리 | 로그 조회 |
|------|--------|--------|-------------|-----------|----------|
| platform-admin | O | O | O | O | O |
| tenant-admin | O (자기 테넌트) | O (자기 테넌트) | X | O (자기 테넌트) | O (자기 테넌트) |
| tenant-user | X | X | X | X | X |
| auditor | X | X | X | X | O |

---

## 7. 암호화 체계

### 7.1 전송 구간 암호화 (TLS)

| 구간 | 프로토콜 | 설정 |
|------|---------|------|
| **외부 → LB** | TLS 1.3 | 인증서 적용, HSTS |
| **LB → 웹서버** | HTTP | 내부망 (선택적 TLS) |
| **서비스 간** | TLS 1.2+ | 내부 인증서 |
| **관리 접속** | SSH | 키 기반 인증 |

### 7.2 저장 데이터 암호화

| 대상 | 암호화 방식 | 키 관리 |
|------|-----------|--------|
| **스토리지 (Ceph)** | AES-256 | Ceph 자체 암호화 |
| **DB 데이터** | TDE (선택) | DB 자체 관리 |
| **백업 데이터** | AES-256 | 별도 키 관리 |

### 7.3 인증서 관리

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     인증서 구조                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   [Root CA]                                                                 │
│       │                                                                     │
│       ├── [Intermediate CA]                                                 │
│       │       │                                                             │
│       │       ├── 외부 서비스 인증서 (LB, 웹)                               │
│       │       └── 내부 서비스 인증서 (서비스 간)                            │
│       │                                                                     │
│       └── [관리용 CA]                                                       │
│               └── SSH 키, 관리 인증서                                       │
│                                                                             │
│   인증서 유효기간:                                                          │
│   - 외부 서비스: 1년 (자동 갱신)                                            │
│   - 내부 서비스: 2년                                                        │
│   - CA: 10년                                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 감사 및 로깅

### 8.1 로깅 대상

| 로그 유형 | 수집 대상 | 보관 기간 |
|----------|----------|----------|
| **인증 로그** | 로그인 성공/실패 | 1년 |
| **접근 로그** | API 호출, 리소스 접근 | 90일 |
| **변경 로그** | 리소스 생성/수정/삭제 | 1년 |
| **보안 로그** | 방화벽, 차단 이벤트 | 1년 |
| **시스템 로그** | OS, 서비스 로그 | 30일 |

### 8.2 로그 형식

```json
{
  "timestamp": "2026-01-30T10:30:00Z",
  "event_type": "access",
  "user": "admin-a@tenant-a",
  "source_ip": "10.0.2.10",
  "action": "vm.create",
  "resource": "vm/dev-a-web-01",
  "result": "success",
  "tenant": "tenant-a"
}
```

### 8.3 알림 정책

| 이벤트 | 심각도 | 알림 방법 |
|--------|--------|----------|
| 인증 실패 5회 이상 | Critical | 즉시 알림 |
| 권한 밖 접근 시도 | High | 즉시 알림 |
| 방화벽 차단 급증 | Medium | 10분 내 알림 |
| 비정상 트래픽 | Medium | 10분 내 알림 |

---

## 관련 문서

- [01_프로젝트_개요서.md](01_프로젝트_개요서.md)
- [02_팀_역할분담.md](02_팀_역할분담.md)
- [03_상세설계_가이드.md](03_상세설계_가이드.md)
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md)
- [06_스토리지_설계서.md](06_스토리지_설계서.md)
- [07_AI플랫폼_인프라_설계서.md](07_AI플랫폼_인프라_설계서.md) - AI 플랫폼 네트워크 (VLAN 50, 55, 60)
