# 컴퓨트 아키텍처 구성도

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 컴퓨트 아키텍처 구성도 |
| 버전 | 5.0 |
| 작성일 | 2026-02-10 |
| 담당팀 | 컴퓨트/개발 팀 |
| 목적 | Excalidraw 기반 아키텍처 다이어그램 작성 가이드 |

---

**목차**

1. [전체 아키텍처 구성도](#1-전체-아키텍처-구성도)
2. [리소스 풀 계층 구조](#2-리소스-풀-계층-구조)
3. [VM 배치 및 Anti-Affinity](#3-vm-배치-및-anti-affinity)
4. [서비스 데이터 흐름](#4-서비스-데이터-흐름)
5. [고가용성(HA) 구조](#5-고가용성ha-구조)
6. [네트워크 연결 구조](#6-네트워크-연결-구조)
7. [하드웨어 구성도](#7-하드웨어-구성도)
8. [소프트웨어 구성도](#8-소프트웨어-구성도)
9. [네트워크 토폴로지 구성도](#9-네트워크-토폴로지-구성도)
10. [Excalidraw 작성 가이드](#10-excalidraw-작성-가이드)

---

## 1. 전체 아키텍처 구성도

> **핵심 다이어그램**: 팀/멘토 발표 시 가장 먼저 보여줄 메인 구성도

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                        문서 태깅 플랫폼 컴퓨트 아키텍처 (전체 구성도)                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                                    ┌─────────────┐                                     │
│                                    │   사용자     │                                     │
│                                    │ (브라우저)   │                                     │
│                                    └──────┬──────┘                                     │
│                                           │ HTTPS                                       │
│                                           ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                            DMZ 계층 (VLAN 10)                                    │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-svc-web-01        │     │     dev-svc-web-02        │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 2vCPU / 4GB RAM   │   │     │   │ 2vCPU / 4GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ nginx             │   │     │   │ nginx             │   │      │   │  │
│   │   │   │   │ (Reverse Proxy)   │   │     │   │ (Reverse Proxy)   │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │       웹 서버 #1          │     │       웹 서버 #2          │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                ↑                              ↑                         │   │  │
│   │   │                └──────────────────────────────┘                         │   │  │
│   │   │                      Anti-Affinity (분산 배치)                          │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         │ /api/* 프록시                                 │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          백엔드 계층 (VLAN 20)                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-svc-app-01        │     │     dev-svc-app-02        │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 4vCPU / 8GB RAM   │   │     │   │ 4vCPU / 8GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ Spring Boot 4.0.2 │   │     │   │ Spring Boot 4.0.2 │   │      │   │  │
│   │   │   │   │ (REST API +       │   │     │   │ (REST API)        │   │      │   │  │
│   │   │   │   │  AMQP Consumer)   │   │     │   │                   │   │      │   │  │
│   │   │   │   │ RabbitMQ 3.12+    │   │     │   │                   │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │       App 서버 #1         │     │       App 서버 #2         │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                ↑                              ↑                         │   │  │
│   │   │                └──────────────────────────────┘                         │   │  │
│   │   │                      Anti-Affinity (분산 배치)                          │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                          │                                     │                        │
│   RabbitMQ (메시지 큐)   │                                     │ DB/NFS 접근            │
│   AMQP Consumer ─────────┤                                     │                        │
│                          │ HTTP                                │                        │
│                          ▼                                     ▼                        │
│   ┌──────────────────────────────────┐  ┌───────────────────────────────────────────┐  │
│   │      AI 처리 계층 (VLAN 30)      │  │              데이터 계층 (VLAN 40/50)      │  │
│   │   ┌──────────────────────────┐   │  │   ┌───────────────────────────────────┐   │  │
│   │   │                          │   │  │   │                                   │   │  │
│   │   │  ┌────────────────────┐  │   │  │   │  ┌──────────────┐ ┌────────────┐  │   │  │
│   │   │  │ dev-ai-worker-01   │  │   │  │   │  │ dev-data-    │ │ dev-data-  │  │   │  │
│   │   │  │ ┌────────────────┐ │  │   │  │   │  │  db-pri      │ │  db-rep    │  │   │  │
│   │   │  │ │ 4vCPU / 8GB   │ │  │   │  │   │  │ ┌──────────┐ │ │ ┌────────┐ │  │   │  │
│   │   │  │ │ Rocky Linux 9 │ │  │   │  │   │  │ │ 4vCPU    │ │ │ │ 4vCPU  │ │  │   │  │
│   │   │  │ │ Docker        │ │  │   │  │   │  │ │ 8GB RAM  │ │ │ │ 8GB RAM│ │  │   │  │
│   │   │  │ │ OCR  :8001    │ │  │   │  │   │  │ │ MariaDB  │ │ │ │MariaDB │ │  │   │  │
│   │   │  │ │ 태깅 :8000    │ │  │   │  │   │  │ │ 11.4 LTS │ │ │ │11.4 LTS│ │  │   │  │
│   │   │  │ │ (Stateless)   │ │  │   │  │   │  │ │ (R/W)    │ │ │ │(R Only)│ │  │   │  │
│   │   │  │ └────────────────┘ │  │   │  │   │  │ └──────────┘ │ │ └────────┘ │  │   │  │
│   │   │  │  AI 서버            │  │   │  │   │  │  DB Primary  │ │ DB Replica │  │   │  │
│   │   │  │  (Stateless)       │  │   │  │   │  │  (쓰기 담당) │ │ (읽기 담당)│  │   │  │
│   │   │  └────────────────────┘  │   │  │   │  └──────────────┘ └────────────┘  │   │  │
│   │   │                          │   │  │   │        │ Semi-Sync │               │   │  │
│   │   │  ┌────────────────────┐  │   │  │   │        └──────────►┘               │   │  │
│   │   │  │ dev-ai-train-01    │  │   │  │   │                                   │   │  │
│   │   │  │ ┌────────────────┐ │  │   │  │   │  ※ MariaDB Full-text Search      │   │  │
│   │   │  │ │ 4vCPU / 8GB   │ │  │   │  │   │                                   │   │  │
│   │   │  │ │ Rocky Linux 9 │ │  │   │  │   └───────────────────────────────────┘   │  │
│   │   │  │ │ Docker Python │ │  │   │  │                                           │  │
│   │   │  │ │ 모델 파인튜닝 │ │  │   │  │              NFS (CephFS) (VLAN 50)       │  │
│   │   │  │ │ (주기적 학습) │ │  │   │  │   ┌───────────────────────────────────┐   │  │
│   │   │  │ └────────────────┘ │  │   │  │   │  NFS 파일 스토리지                │   │  │
│   │   │  │  모델 학습 서버    │  │   │  │   │  • 문서 파일 저장                  │   │  │
│   │   │  │  (주기적 운영)     │  │   │  │   │  • OCR 결과 저장                   │   │  │
│   │   │  └────────────────────┘  │   │  │   └───────────────────────────────────┘   │  │
│   │   │                          │   │  │                                           │  │
│   │   └──────────────────────────┘   │  └───────────────────────────────────────────┘  │
│   └──────────────────────────────────┘                                                  │
│                                                                                         │
│   ────────────────────────────────────────────────────────────────────────────────────  │
│                                    인프라 계층                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          ABLESTACK HCI 클러스터                                   │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                       │  │
│   │   │   Host 1    │     │   Host 2    │     │   Host 3    │                       │  │
│   │   │   (KVM)     │     │   (KVM)     │     │   (KVM)     │                       │  │
│   │   │ ┌─────────┐ │     │ ┌─────────┐ │     │ ┌─────────┐ │                       │  │
│   │   │ │ Ceph OSD│ │     │ │ Ceph OSD│ │     │ │ Ceph OSD│ │                       │  │
│   │   │ └─────────┘ │     │ └─────────┘ │     │ └─────────┘ │                       │  │
│   │   └─────────────┘     └─────────────┘     └─────────────┘                       │  │
│   │          │                   │                   │                              │  │
│   │          └───────────────────┼───────────────────┘                              │  │
│   │                              │                                                   │  │
│   │                     Ceph 분산 스토리지                                           │  │
│   │                  (공유 스토리지 - Live Migration 지원)                           │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                     ABLESTACK Mold (모니터링)                            │   │  │
│   │   │   • VM 상태 모니터링      • CPU/Memory/Disk 사용률                       │   │  │
│   │   │   • 호스트 상태 감시      • 알림 및 이벤트 관리                          │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

총 VM: 8대
- DMZ 계층: 2대 (웹 서버 x2)  — VLAN 10
- 백엔드 계층: 2대 (App 서버 x2, RabbitMQ 내장)  — VLAN 20
- AI 처리 계층: 2대 (AI 서버 x1, Model Train x1)  — VLAN 30
- 데이터 계층: 2대 (DB Primary x1, DB Replica x1)  — VLAN 40
- 스토리지: NFS (CephFS)  — VLAN 50
- 모니터링: ABLESTACK Mold 기본 기능 활용  — VLAN 100

총 리소스: 26 vCPU, 52GB RAM, 850GB VM 디스크

핵심 통신 흐름:
- 사용자 → nginx (VLAN 10) → Spring Boot (VLAN 20) → MariaDB (VLAN 40) / NFS (VLAN 50)
- Spring AMQP Consumer (VLAN 20) → HTTP → AI 서버 (VLAN 30) [Stateless]
- AI 서버는 DB/NFS에 직접 접근하지 않음 (Consumer가 결과 저장)
```

---

## 2. 리소스 풀 계층 구조

> **설명용 다이어그램**: 리소스 풀 구조와 오버커밋 정책 설명

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            리소스 풀 계층 구조                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                              ┌─────────────────────────┐                               │
│                              │       Root Pool         │                               │
│                              │    (전체 클러스터)       │                               │
│                              │                         │                               │
│                              │  ┌─────────────────┐   │                               │
│                              │  │ 오버커밋 정책   │   │                               │
│                              │  │ CPU: 2:1       │   │                               │
│                              │  │ Memory: 1:1    │   │                               │
│                              │  │ Storage: Thin  │   │                               │
│                              │  └─────────────────┘   │                               │
│                              └────────────┬────────────┘                               │
│                                           │                                             │
│               ┌───────────────────────────┼───────────────────────────┐                │
│               │                           │                           │                │
│               ▼                           ▼                           ▼                │
│   ┌───────────────────────┐   ┌───────────────────────┐   ┌───────────────────────┐   │
│   │       서비스 풀        │   │       데이터 풀        │   │       관리 풀         │   │
│   │    (Service Pool)     │   │      (Data Pool)      │   │    (Mgmt Pool)       │   │
│   ├───────────────────────┤   ├───────────────────────┤   ├───────────────────────┤   │
│   │                       │   │                       │   │                       │   │
│   │  할당 리소스:          │   │  할당 리소스:          │   │  할당 리소스:          │   │
│   │  vCPU: 12개           │   │  vCPU: 12개           │   │  (Mold 기본 기능)     │   │
│   │  Memory: 24GB         │   │  Memory: 24GB         │   │                       │   │
│   │                       │   │                       │   │                       │   │
│   │  용도:                │   │  용도:                │   │  용도:                │   │
│   │  - 웹 서버 (x2)       │   │  - DB Primary (x1)    │   │  - ABLESTACK Mold    │   │
│   │  - App 서버 (x2)      │   │  - DB Replica (x1)    │   │  - 모니터링/관리      │   │
│   │                       │   │  - AI 서버 (x1)       │   │                       │   │
│   │                       │   │  - Model Train (x1)   │   │                       │   │
│   │                       │   │                       │   │                       │   │
│   └───────────┬───────────┘   └───────────┬───────────┘   └───────────────────────┘   │
│               │                           │                                             │
│   ┌───────────┼───────────┐   ┌───────────┼───────────────────────┐                   │
│   │   │       │   │       │   │   │       │       │       │       │                   │
│   ▼   ▼       ▼   ▼       │   ▼   ▼       ▼       ▼       ▼       │                   │
│ ┌─────┐┌─────┐┌─────┐┌─────┐ ┌─────┐┌─────┐┌─────┐┌─────┐        │                   │
│ │ Web ││ Web ││ App ││ App │ │DB   ││DB   ││ AI  ││Model│        │                   │
│ │ #1  ││ #2  ││ #1  ││ #2  │ │Pri  ││Rep  ││Srvr ││Train│        │                   │
│ │     ││     ││     ││     │ │     ││     ││     ││     │        │                   │
│ └─────┘└─────┘└─────┘└─────┘ └─────┘└─────┘└─────┘└─────┘        │                   │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   오버커밋 정책 상세:                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   CPU 오버커밋 2:1                      Memory 오버커밋 없음 (1:1)              │  │
│   │   ┌───────────────────┐                ┌───────────────────┐                   │  │
│   │   │ 물리 CPU: 24코어  │                │ 물리 Mem: 96GB    │                   │  │
│   │   │        │          │                │        │          │                   │  │
│   │   │        ▼          │                │        ▼          │                   │  │
│   │   │ 가상 CPU: 48vCPU  │                │ 가상 Mem: 96GB    │                   │  │
│   │   │   할당 가능       │                │   할당 가능       │                   │  │
│   │   │                   │                │                   │                   │  │
│   │   │ 현재 할당: 26vCPU │                │ 현재 할당: 52GB   │                   │  │
│   │   └───────────────────┘                └───────────────────┘                   │  │
│   │                                                                                 │  │
│   │   이유: CPU는 항상 100%     이유: Memory 스왑 발생 시                           │  │
│   │   사용되지 않음              성능 저하 심함                                      │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. VM 배치 및 Anti-Affinity

> **핵심 다이어그램**: HA를 위한 VM 분산 배치 전략

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          VM 배치 전략 (Anti-Affinity / Affinity)                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [Anti-Affinity 규칙] - 동일 서비스 VM 분산 배치 (HA 목적)                             │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │       Host 1                    Host 2                    Host 3               │  │
│   │   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │ web-01    │  │      │  │ web-02    │  │      │  │ai-worker-01│  │       │  │
│   │   │  │ 2vCPU/4GB │  │      │  │ 2vCPU/4GB │  │      │  │ 4vCPU/8GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │        │        │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │ app-01    │  │      │  │ app-02    │  │      │  │ai-train-01│  │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │                 │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │                 │       │  │
│   │   │  │ db-pri    │  │      │  │ db-rep    │  │      │                 │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │                 │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │                 │       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   └─────────────────┘      └─────────────────┘      └─────────────────┘       │  │
│   │                                                                                 │  │
│   │   리소스 배분:                                                                  │  │
│   │   • Host 1: 10vCPU / 20GB (web-01, app-01, db-pri)                            │  │
│   │   • Host 2: 10vCPU / 20GB (web-02, app-02, db-rep)                            │  │
│   │   • Host 3: 8vCPU / 16GB (ai-worker-01, ai-train-01)                          │  │
│   │                                                                                 │  │
│   │   ════════════════════════════════════════════════════════════════════════════ │  │
│   │                                                                                 │  │
│   │   Anti-Affinity 규칙:                                                          │  │
│   │   • AA-001: web-01 ≠ web-02           (웹 서버 분산)                           │  │
│   │   • AA-002: app-01 ≠ app-02           (App 서버 분산)                          │  │
│   │   • AA-003: db-pri ≠ db-rep           (DB Primary/Replica 분산)               │  │
│   │                                                                                 │  │
│   │   ✓ Host 1 장애 → web-02, app-02, db-rep가 서비스 유지                        │  │
│   │   ✓ Host 2 장애 → web-01, app-01, db-pri가 서비스 유지                        │  │
│   │   ✓ Host 3 장애 → AI 처리 일시 중단 (서비스 영향 최소화)                       │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [배치 규칙 요약표]                                                                    │
│   ┌────────────┬──────────────┬─────────────────────┬──────────────────────────────┐  │
│   │  규칙 ID   │     유형     │      대상 VM        │            설명              │  │
│   ├────────────┼──────────────┼─────────────────────┼──────────────────────────────┤  │
│   │  AA-001    │ Anti-Affinity│  웹 서버 (x2)       │  서비스 HA - 분산 배치       │  │
│   │  AA-002    │ Anti-Affinity│  App 서버 (x2)      │  API 서비스 HA - 분산 배치   │  │
│   │  AA-003    │ Anti-Affinity│  DB Pri/Rep (x2)    │  DB HA - Primary/Replica 분산│  │
│   └────────────┴──────────────┴─────────────────────┴──────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 서비스 데이터 흐름

> **설명용 다이어그램**: 문서 업로드 → 태깅 → 검색 흐름

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           문서 태깅 서비스 데이터 흐름                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [1단계: 문서 업로드]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌─────────────┐      ┌─────────────────┐          │
│   │ 사용자  │──①──►│ 웹 서버 │──②──►│ App 서버    │──③──►│ 문서 스토리지   │          │
│   │         │      │ (nginx) │      │(Spring Boot)│      │ (NFS/CephFS)    │          │
│   └─────────┘      └─────────┘      └─────────────┘      └─────────────────┘          │
│        │            VLAN 10             VLAN 20                VLAN 50                  │
│        │                                   │                                           │
│        │                                   │ ③-1 documents 레코드 저장 (MariaDB)       │
│        │                                   │ ③-2 Job 자동 생성 (status=PENDING)        │
│        │                                   │                                           │
│        │                                   │ ④ 태깅 요청 메시지 발행                   │
│        │                                   ▼                                           │
│        │                             ┌───────────┐                                    │
│        │                             │ RabbitMQ  │  ◄─── App 서버 내장 (VLAN 20)     │
│        │                             │   Queue   │                                    │
│        │                             └─────┬─────┘                                    │
│        │                                   │                                           │
│   ──────────────────────────────────────────┼─────────────────────────────────────────   │
│                                            │                                           │
│   [2단계: 비동기 태깅 처리]                  │                                           │
│                                            │ ⑤ Spring AMQP Consumer 수신               │
│                                            │   (@RabbitListener)                       │
│                                            ▼                                           │
│                                      ┌───────────────┐                                │
│                                      │ AMQP Consumer │                                │
│                                      │ (App 서버)    │                                │
│                                      └───────┬───────┘                                │
│                                              │                                         │
│                              ┌───────────────┼───────────────┐                        │
│                              │ document_type │               │                        │
│                              │ 분기 처리     │               │                        │
│                              ▼               ▼               │                        │
│                    ┌──────────────┐ ┌──────────────┐         │                        │
│                    │ 파일 문서     │ │ 텍스트 문서   │         │                        │
│                    │(pdf,txt,     │ │(text 타입)   │         │                        │
│                    │ docx,hwp)    │ │              │         │                        │
│                    └──────┬───────┘ └──────┬───────┘         │                        │
│                           │                │                  │                        │
│                           ▼                │                  │                        │
│   ┌─────────────────────────────────────┐  │                  │                        │
│   │    OCR FastAPI (:8001) — VLAN 30    │  │                  │                        │
│   │   ┌─────────────────────────────┐   │  │                  │                        │
│   │   │ POST /ocr                   │   │  │                  │                        │
│   │   │ • NFS에서 파일 읽기           │   │  │                  │                        │
│   │   │ • Tesseract OCR 추출        │   │  │                  │                        │
│   │   │ • 추출 텍스트 반환           │   │  │                  │                        │
│   │   │ • 타임아웃: 60초            │   │  │                  │                        │
│   │   └─────────────────────────────┘   │  │                  │                        │
│   └─────────────────┬───────────────────┘  │                  │                        │
│                     │ OCR 텍스트            │ content_text     │                        │
│                     ▼                       ▼                  │                        │
│   ┌─────────────────────────────────────────────────────────┐ │                        │
│   │           태깅 FastAPI (:8000) — VLAN 30                │ │                        │
│   │   ┌─────────────────────────────────────────────────┐   │ │                        │
│   │   │ POST /predict                                   │   │ │                        │
│   │   │ • 텍스트 입력 → KoBERT 추론                     │   │ │                        │
│   │   │ • 태그 분류 결과 반환                            │   │ │                        │
│   │   │ • 타임아웃: 30초                                │   │ │                        │
│   │   └─────────────────────────────────────────────────┘   │ │                        │
│   └─────────────────┬───────────────────────────────────────┘ │                        │
│                     │                                          │                        │
│                     └──────────────────┬───────────────────────┘                        │
│                                        │                                                │
│                                        │ ⑥ Consumer가 결과 저장                        │
│                                        ▼                                                │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [3단계: 결과 저장 (Consumer)]                                                         │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                       AMQP Consumer 결과 저장                                    │  │
│   │                                                                                 │  │
│   │   ┌──────────────────────────┐     ┌──────────────────────────┐                │  │
│   │   │ MariaDB (VLAN 40)        │     │ NFS (VLAN 50)            │                │  │
│   │   │ • documents.status 갱신  │     │ • OCR 텍스트 저장 (선택) │                │  │
│   │   │ • documents.ocr_text 저장│     │                          │                │  │
│   │   │ • tags 레코드 생성       │     │                          │                │  │
│   │   │ • jobs.status 갱신       │     │                          │                │  │
│   │   └──────────────────────────┘     └──────────────────────────┘                │  │
│   │                                                                                 │  │
│   │   DB Replication:                                                               │  │
│   │   ┌─────────────────────┐        ┌─────────────────────┐                       │  │
│   │   │    DB Primary       │        │    DB Replica       │                       │  │
│   │   │   (Read/Write)      │───────►│   (Read Only)       │                       │  │
│   │   │                     │  복제  │                     │                       │  │
│   │   └─────────────────────┘        └─────────────────────┘                       │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [4단계: 검색 서비스]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌─────────────┐      ┌─────────────────┐       │
│   │ 사용자  │──⑦──►│ 웹 서버 │──⑧──►│ App 서버    │──⑨──►│  DB Replica     │       │
│   │         │◄─⑩───│         │◄─────│(Spring Boot)│◄─────│ (읽기 분산)     │       │
│   └─────────┘      └─────────┘      └─────────────┘      └─────────────────┘       │
│                     VLAN 10            VLAN 20                VLAN 40                │
│                                                                                         │
│   검색: GET /api/search/documents?q=계약서                                             │
│   → MariaDB Full-text Search (title, content_text 대상)                                │
│   → 부서별 격리: DepartmentContext (@Filter) 자동 적용                                  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 고가용성(HA) 구조

> **핵심 다이어그램**: 장애 시나리오와 자동 복구

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              고가용성(HA) 설계                                           │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [시나리오 1: 정상 상태]                                                               │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1                        Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   │ web-01  │   │          │   │ web-02  │   │          │   │ai-worker│   ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   │ app-01  │   │          │   │ app-02  │   │          │   │ai-train │   ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │                 ││  │
│   │   │   │ db-pri  │   │          │   │ db-rep  │   │          │                 ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │                 ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │                 ││  │
│   │   │                 │          │                 │          │                 ││  │
│   │   └─────────────────┘          └─────────────────┘          └─────────────────┘│  │
│   │                                                                                 │  │
│   │   ◄─────────────────────── 로드밸런서 ───────────────────────►                 │  │
│   │                            (트래픽 분산)                                        │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [시나리오 2: Host 1 장애 발생]                                                        │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1 (장애!)                Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │                 │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │ web-02  │   │          │   │ai-worker│   ││  │
│   │   │   ╳ web-01 ╳    │  ───►    │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  장애    │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  감지    │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳ app-01 ╳    │          │   │ app-02  │   │          │   │ai-train │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ╳ db-pri ╳    │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │ db-rep  │   │          │   │ web-01' │   ││  │
│   │   │                 │          │   │   승격   │   │          │   │ (재시작)│   ││  │
│   │   │                 │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │                 │          │                 │          │   ┌─────────┐   ││  │
│   │   │                 │          │                 │          │   │ app-01' │   ││  │
│   │   │                 │          │                 │          │   │ (재시작)│   ││  │
│   │   └─────────────────┘          └─────────────────┘          │   └─────────┘   ││  │
│   │                                                              └─────────────────┘│  │
│   │                                                                                 │  │
│   │   HA 동작 순서:                                                                 │  │
│   │   ① 하트비트 타임아웃 (30초)                                                    │  │
│   │   ② Host 1 장애 확정                                                            │  │
│   │   ③ web-01, app-01, db-pri VM 목록 확인                                        │  │
│   │   ④ Host 3에서 web-01, app-01 VM 자동 재시작                                   │  │
│   │   ⑤ db-rep를 Primary로 승격 (수동 또는 자동)                                   │  │
│   │   ⑥ Ceph RBD 스토리지 재연결 (공유 스토리지)                                    │  │
│   │   ⑦ 서비스 복구 완료                                                            │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [MariaDB Replication HA]                                                             │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   ┌─────────────────────┐              ┌─────────────────────┐                 │  │
│   │   │    DB Primary       │              │    DB Replica       │                 │  │
│   │   │   (dev-data-db-pri) │───────────►  │  (dev-data-db-rep)  │                 │  │
│   │   │                     │  Semi-Sync   │                     │                 │  │
│   │   │   Read/Write        │  Replication │   Read Only         │                 │  │
│   │   │                     │              │                     │                 │  │
│   │   └─────────────────────┘              └─────────────────────┘                 │  │
│   │            │                                     │                              │  │
│   │            │ 장애 발생 시                        │                              │  │
│   │            ▼                                     ▼                              │  │
│   │   ┌─────────────────────┐              ┌─────────────────────┐                 │  │
│   │   │   장애 감지         │              │   Primary 승격      │                 │  │
│   │   │                     │───────────►  │   (Read/Write)      │                 │  │
│   │   │                     │              │                     │                 │  │
│   │   └─────────────────────┘              └─────────────────────┘                 │  │
│   │                                                                                 │  │
│   │   복제 설정:                                                                    │  │
│   │   • Semi-Synchronous Replication                                               │  │
│   │   • GTID 기반 복제 (Global Transaction ID)                                     │  │
│   │   • 읽기 분산: Replica로 읽기 쿼리 분산                                         │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [Live Migration - 계획된 유지보수]                                                    │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │                          Host 1                    Host 2                      │  │
│   │                      (유지보수 예정)                                            │  │
│   │                                                                                 │  │
│   │    단계 1:           ┌─────────┐               ┌─────────┐                     │  │
│   │    메모리 복사       │ [VM-A]  │  ──────────►  │ [VM-A'] │                     │  │
│   │                      │ Running │   메모리      │ 준비 중  │                     │  │
│   │                      └─────────┘   복사        └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 2:           ┌─────────┐               ┌─────────┐                     │  │
│   │    최종 동기화       │ [VM-A]  │  ◄──────────► │ [VM-A'] │                     │  │
│   │                      │ Paused  │   최종 동기화  │ Ready   │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 3:           ┌─────────┐               ┌─────────┐                     │  │
│   │    전환 완료         │   ---   │               │ [VM-A]  │                     │  │
│   │                      │ 종료됨  │               │ Running │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │   • 다운타임: 수 초 이내                                                        │  │
│   │   • 요구사항: Ceph RBD 공유 스토리지, 동일 CPU 아키텍처                         │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [HA 설정 요약]                                                                        │
│   ┌──────────────────┬────────────────┬────────────────────────────────────────────┐  │
│   │      설정 항목   │       값       │                  설명                      │  │
│   ├──────────────────┼────────────────┼────────────────────────────────────────────┤  │
│   │  HA 활성화       │      예        │  클러스터 레벨 HA 활성화                   │  │
│   │  장애 감지 시간  │     30초       │  하트비트 타임아웃                         │  │
│   │  자동 재시작     │      예        │  장애 VM 자동 재시작                       │  │
│   │  재시작 우선순위 │ High/Med/Low   │  DB > App > Web > AI 서버                 │  │
│   │  공유 스토리지   │   Ceph RBD     │  VM 재시작 시 데이터 유지                  │  │
│   │  DB 이중화       │  MariaDB 복제  │  Primary/Replica 구조                      │  │
│   │  모니터링        │ ABLESTACK Mold │  기본 제공 모니터링 기능 활용              │  │
│   └──────────────────┴────────────────┴────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 네트워크 연결 구조

> **보조 다이어그램**: VLAN과 VM 간 통신 경로

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                      네트워크 연결 구조 (역할별 VLAN 기반)                                │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                               ┌────────────────┐                                       │
│                               │   외부 네트워크 │                                       │
│                               │   (인터넷/WAN) │                                       │
│                               └───────┬────────┘                                       │
│                                       │                                                 │
│                                       ▼                                                 │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 10 (DMZ)                                         │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐                                                  │  │
│   │   │ web-01  │     │ web-02  │     nginx (Reverse Proxy + LB)                   │  │
│   │   │ :80/443 │     │ :80/443 │     /api/* → App 서버 프록시                     │  │
│   │   └────┬────┘     └────┬────┘                                                  │  │
│   │        │               │                                                        │  │
│   └────────┼───────────────┼────────────────────────────────────────────────────────┘  │
│            │               │                                                           │
│            └───────┬───────┘                                                           │
│                    │                                                                    │
│                    ▼                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 20 (백엔드망)                                    │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐                                                  │  │
│   │   │ app-01  │     │ app-02  │     Spring Boot (REST API + AMQP Consumer)       │  │
│   │   │ :8080   │     │ :8080   │     RabbitMQ 3.12+ (app-01 내장)                 │  │
│   │   └────┬────┘     └────┬────┘                                                  │  │
│   │        │               │                                                        │  │
│   └────────┼───────────────┼────────────────────────────────────────────────────────┘  │
│            │               │                                                           │
│            │  HTTP         │  DB/NFS 접근                                              │
│            ▼               ▼                                                           │
│   ┌────────────────────┐  ┌────────────────────────────────────────────────────────┐  │
│   │ VLAN 30 (AI망)     │  │               VLAN 40 (DB망)                           │  │
│   │                    │  │                                                        │  │
│   │ ┌──────────────┐  │  │  ┌─────────┐     ┌─────────┐                           │  │
│   │ │ ai-worker-01 │  │  │  │ db-pri  │     │ db-rep  │   MariaDB 11.4 LTS       │  │
│   │ │ OCR  :8001   │  │  │  │ :3306   │────►│ :3306   │   Semi-Sync Replication   │  │
│   │ │ 태깅 :8000   │  │  │  └─────────┘     └─────────┘                           │  │
│   │ │ (Stateless)  │  │  │                                                        │  │
│   │ └──────────────┘  │  └────────────────────────────────────────────────────────┘  │
│   │                    │                                                               │
│   │ ┌──────────────┐  │  ┌────────────────────────────────────────────────────────┐  │
│   │ │ ai-train-01  │  │  │               VLAN 50 (스토리지망)                     │  │
│   │ │ (주기적 학습)│  │  │                                                        │  │
│   │ └──────────────┘  │  │  Ceph 분산 스토리지                                     │  │
│   │                    │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                 │  │
│   │ ※ AI→DB 차단     │  │  │ OSD 1   │  │ OSD 2   │  │ OSD 3   │                 │  │
│   │ ※ AI→NFS 차단    │  │  └─────────┘  └─────────┘  └─────────┘                 │  │
│   │                    │  │  NFS (CephFS): :2049                                    │  │
│   └────────────────────┘  │                                                        │  │
│                            └────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 100 (관리망)                                     │  │
│   │                                                                                 │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                      ABLESTACK Mold (관리 콘솔)                          │   │  │
│   │   │                                                                         │   │  │
│   │   │   • VM 생성/삭제/시작/정지        • CPU/Memory/Disk 모니터링            │   │  │
│   │   │   • 호스트 상태 감시              • 알림 및 이벤트 관리                  │   │  │
│   │   │   • HA/Live Migration 관리        • 리소스 쿼터 관리                     │   │  │
│   │   │                                                                         │   │  │
│   │   │   ※ 별도 모니터링 VM 불필요 (Mold 기본 기능으로 충분)                   │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   [VLAN 요약]                                                                          │
│   ┌────────────┬──────────────────────────────────────────────────────────────────┐   │
│   │  VLAN ID   │                          용도                                    │   │
│   ├────────────┼──────────────────────────────────────────────────────────────────┤   │
│   │    10      │  DMZ (nginx 웹 서버)                                            │   │
│   │    20      │  백엔드망 (Spring Boot + RabbitMQ + AMQP Consumer)              │   │
│   │    30      │  AI망 (OCR FastAPI :8001, 태깅 FastAPI :8000) — Stateless       │   │
│   │    40      │  DB망 (MariaDB Primary/Replica)                                 │   │
│   │    50      │  스토리지망 (Ceph OSD/MDS)                                       │   │
│   │   100      │  관리망 (ABLESTACK Mold)                                        │   │
│   └────────────┴──────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│   [통신 원칙]                                                                          │
│   • 부서 격리: 앱 레벨 RBAC (VLAN이 아닌 Hibernate @Filter 기반)                       │
│   • AI 서버: Stateless — DB/NFS 직접 접근 차단 (방화벽 차단)                           │
│   • 결과 저장: Spring AMQP Consumer가 DB/NFS에 직접 저장                               │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 하드웨어 구성도

> **물리 인프라**: ABLESTACK HCI 3노드 클러스터 물리 구성

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           하드웨어 구성도 (ABLESTACK HCI 3-Node)                          │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│   │                              물리 서버 (3-Node Cluster)                            │ │
│   │                                                                                   │ │
│   │   ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐      │ │
│   │   │       Host 1        │  │       Host 2        │  │       Host 3        │      │ │
│   │   │  ┌───────────────┐  │  │  ┌───────────────┐  │  │  ┌───────────────┐  │      │ │
│   │   │  │ CPU: 8 Core   │  │  │  │ CPU: 8 Core   │  │  │  │ CPU: 8 Core   │  │      │ │
│   │   │  │ RAM: 32GB     │  │  │  │ RAM: 32GB     │  │  │  │ RAM: 32GB     │  │      │ │
│   │   │  │ SSD: 500GB    │  │  │  │ SSD: 500GB    │  │  │  │ SSD: 500GB    │  │      │ │
│   │   │  └───────────────┘  │  │  └───────────────┘  │  │  └───────────────┘  │      │ │
│   │   │  ┌───────────────┐  │  │  ┌───────────────┐  │  │  ┌───────────────┐  │      │ │
│   │   │  │ KVM Hypervisor│  │  │  │ KVM Hypervisor│  │  │  │ KVM Hypervisor│  │      │ │
│   │   │  │ Ceph OSD      │  │  │  │ Ceph OSD      │  │  │  │ Ceph OSD      │  │      │ │
│   │   │  └───────────────┘  │  │  └───────────────┘  │  │  └───────────────┘  │      │ │
│   │   └─────────────────────┘  └─────────────────────┘  └─────────────────────┘      │ │
│   │            │                         │                         │                 │ │
│   │            └─────────────────────────┼─────────────────────────┘                 │ │
│   │                                      │                                           │ │
│   │                         ┌────────────▼────────────┐                              │ │
│   │                         │   10GbE 네트워크 스위치  │                              │ │
│   │                         │   (서버 상호 연결)       │                              │ │
│   │                         └────────────┬────────────┘                              │ │
│   │                                      │                                           │ │
│   │                         ┌────────────▼────────────┐                              │ │
│   │                         │ Ceph 분산 스토리지 풀    │                              │ │
│   │                         │ (3-Way Replication)     │                              │ │
│   │                         │ 총 용량: ~1.5TB 가용    │                              │ │
│   │                         └─────────────────────────┘                              │ │
│   │                                                                                   │ │
│   └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│   [물리 리소스 요약]                                                                    │
│   ┌────────────────┬─────────────────────────────────────────────────────────────────┐ │
│   │    항목        │                         스펙                                    │ │
│   ├────────────────┼─────────────────────────────────────────────────────────────────┤ │
│   │    총 CPU      │  24 Core (8 Core x 3 Node)                                      │ │
│   │    총 RAM      │  96GB (32GB x 3 Node)                                           │ │
│   │    총 SSD      │  1.5TB (500GB x 3 Node)                                         │ │
│   │    가상 CPU    │  48 vCPU (2:1 오버커밋)                                         │ │
│   │    할당 vCPU   │  26 vCPU (54% 사용률)                                           │ │
│   │    할당 RAM    │  52GB (54% 사용률)                                              │ │
│   │    네트워크    │  10GbE (스토리지/VM 통신 공용)                                  │ │
│   └────────────────┴─────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 소프트웨어 구성도

> **소프트웨어 스택**: OS부터 애플리케이션까지 전체 구성

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              소프트웨어 구성도 (Stack)                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              애플리케이션 계층                                    │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │  │
│   │   │   nginx     │  │ Spring Boot │  │ OCR FastAPI │  │  MariaDB    │            │  │
│   │   │ (Reverse    │  │ (REST API + │  │ (:8001)     │  │  11.4 LTS   │            │  │
│   │   │  Proxy)     │  │AMQP Consumer│  │ 태깅 FastAPI│  │ (Primary/   │            │  │
│   │   │             │  │  Java 21)   │  │ (:8000)     │  │  Replica)   │            │  │
│   │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐  ┌─────────────┐                                              │  │
│   │   │  RabbitMQ   │  │Tesseract OCR│                                              │  │
│   │   │ (메시지 큐) │  │ (문서 인식) │                                              │  │
│   │   └─────────────┘  └─────────────┘                                              │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                             │
│                                          ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              컨테이너/런타임 계층                                 │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                           Docker Engine                                  │   │  │
│   │   │   • AI 서버: Python 3.11 + PyTorch + KoBERT + Tesseract                 │   │  │
│   │   │     - OCR FastAPI (:8001) — Stateless                                   │   │  │
│   │   │     - 태깅 FastAPI (:8000) — Stateless                                  │   │  │
│   │   │   • AI Train: Python 3.11 + PyTorch + 학습 환경                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                              JDK 21 Runtime                              │   │  │
│   │   │   • App 서버: Spring Boot 4.0.2 + JPA + Security + Spring AMQP          │   │  │
│   │   │     - REST API (Producer) + AMQP Consumer (@RabbitListener)             │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                             │
│                                          ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              운영체제 계층                                        │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                          Rocky Linux 9                                   │   │  │
│   │   │   • RHEL 호환 엔터프라이즈급 OS                                          │   │  │
│   │   │   • SELinux 활성화 (보안 강화)                                           │   │  │
│   │   │   • systemd 서비스 관리                                                  │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                             │
│                                          ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              가상화/인프라 계층                                   │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                          ABLESTACK Mold + KVM                            │   │  │
│   │   │   • VM 프로비저닝 및 관리                                                │   │  │
│   │   │   • HA / Live Migration                                                  │   │  │
│   │   │   • 리소스 모니터링                                                      │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                          Ceph 분산 스토리지                               │   │  │
│   │   │   • RBD (VM 디스크)                                                      │   │  │
│   │   │   • CephFS (NFS 파일 스토리지 - 문서 저장)                               │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   [소프트웨어 버전 요약]                                                               │
│   ┌────────────────┬────────────────┬────────────────────────────────────────────────┐ │
│   │    구분        │      SW        │                  버전/설명                     │ │
│   ├────────────────┼────────────────┼────────────────────────────────────────────────┤ │
│   │    OS          │  Rocky Linux   │  9.x (RHEL 호환)                               │ │
│   │    웹서버      │  nginx         │  1.24+ (Reverse Proxy, /api/* 프록시)          │ │
│   │    WAS         │  Spring Boot   │  4.0.2 (Java 21, REST API + AMQP Consumer)    │ │
│   │    AI 런타임   │  Python        │  3.11 + PyTorch 2.x                            │ │
│   │    AI 모델     │  KoBERT        │  한국어 BERT 기반 분류 모델                    │ │
│   │    OCR         │  Tesseract     │  5.x (한국어 지원, FastAPI :8001)              │ │
│   │    태깅 API    │  FastAPI       │  태깅 추론 서비스 (:8000, Stateless)           │ │
│   │    DB          │  MariaDB       │  11.4 LTS (Primary/Replica)                    │ │
│   │    메시지큐    │  RabbitMQ      │  3.12+ (App 서버 내장, 비동기 태깅 작업)       │ │
│   │    컨테이너    │  Docker        │  24.x (AI 서버 전용)                           │ │
│   │    가상화      │  ABLESTACK     │  Mold + KVM                                    │ │
│   │    스토리지    │  Ceph          │  Quincy+ (RBD, CephFS)                         │ │
│   └────────────────┴────────────────┴────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 네트워크 토폴로지 구성도

> **물리/논리 네트워크**: VLAN 기반 네트워크 분리 토폴로지

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              네트워크 토폴로지 구성도                                     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                                  ┌─────────────┐                                       │
│                                  │   인터넷    │                                       │
│                                  └──────┬──────┘                                       │
│                                         │                                              │
│                                  ┌──────▼──────┐                                       │
│                                  │   방화벽    │                                       │
│                                  │  (L3/L4)   │                                       │
│                                  └──────┬──────┘                                       │
│                                         │                                              │
│   ═══════════════════════════════════════════════════════════════════════════════════  │
│                                    Core Switch                                         │
│   ═══════════════════════════════════════════════════════════════════════════════════  │
│          │            │            │            │            │                          │
│          │            │            │            │            │                          │
│   ┌──────▼──────┬─────▼─────┬──────▼──────┬─────▼─────┬─────▼─────┐                   │
│   │             │           │             │           │           │                   │
│   │   VLAN 10   │  VLAN 20  │   VLAN 30   │  VLAN 40  │ VLAN 50   │                   │
│   │   (DMZ)     │(백엔드망) │  (AI망)     │  (DB망)   │(스토리지) │                   │
│   │             │           │             │           │           │                   │
│   │ ┌─────────┐ │ ┌───────┐ │ ┌─────────┐ │ ┌───────┐ │ ┌───────┐ │                   │
│   │ │ web-01  │ │ │app-01 │ │ │ai-worker│ │ │db-pri │ │ │ Ceph  │ │                   │
│   │ │ web-02  │ │ │app-02 │ │ │ai-train │ │ │db-rep │ │ │ OSD x3│ │                   │
│   │ │         │ │ │RabbitMQ│ │ │         │ │ │       │ │ │       │ │                   │
│   │ │ nginx   │ │ │       │ │ │Stateless│ │ │MariaDB│ │ │ RBD   │ │                   │
│   │ │         │ │ └───────┘ │ │         │ │ │       │ │ │CephFS │ │                   │
│   │ └─────────┘ │           │ └─────────┘ │ └───────┘ │ └───────┘ │                   │
│   │             │           │             │           │           │                   │
│   └─────────────┴───────────┴─────────────┴───────────┴───────────┘                   │
│                                                                                         │
│                              ┌─────────────┐                                           │
│                              │  VLAN 100   │                                           │
│                              │  (관리망)   │                                           │
│                              │  Mold 콘솔  │                                           │
│                              └─────────────┘                                           │
│                                                                                         │
│   [트래픽 흐름]                                                                         │
│                                                                                         │
│   사용자 ──► VLAN 10 (Web) ──► VLAN 20 (App) ──┬──► VLAN 40 (DB)                      │
│                                                 ├──► VLAN 50 (NFS)                     │
│                                                 └──► VLAN 30 (AI) [HTTP, Stateless]    │
│                                                                                         │
│   ※ VLAN 30 (AI) → VLAN 40 (DB): 차단                                                 │
│   ※ VLAN 30 (AI) → VLAN 50 (NFS): 차단                                                │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [VLAN 구성 요약]                                                                      │
│   ┌──────────┬─────────────────┬──────────────────────────────────────────────────────┐│
│   │ VLAN ID  │      명칭       │                      용도/VM                         ││
│   ├──────────┼─────────────────┼──────────────────────────────────────────────────────┤│
│   │   10     │  DMZ            │  web-01, web-02 (nginx Reverse Proxy)               ││
│   │   20     │  백엔드망       │  app-01, app-02 (Spring Boot + RabbitMQ)            ││
│   │   30     │  AI망           │  ai-worker-01, ai-train-01 (OCR/태깅 FastAPI)       ││
│   │   40     │  DB망           │  db-pri, db-rep (MariaDB Primary/Replica)            ││
│   │   50     │  스토리지망     │  Ceph OSD/MDS 클러스터 통신                         ││
│   │  100     │  관리망         │  ABLESTACK Mold 관리 콘솔                            ││
│   └──────────┴─────────────────┴──────────────────────────────────────────────────────┘│
│                                                                                         │
│   [방화벽 정책 요약]                                                                    │
│   ┌────────────────────┬────────────────────┬─────────────────────────────────────────┐│
│   │      출발지        │       목적지       │           허용 포트                     ││
│   ├────────────────────┼────────────────────┼─────────────────────────────────────────┤│
│   │  외부 (인터넷)     │  DMZ (10)          │  80/443 (HTTPS)                         ││
│   │  DMZ (10)          │  백엔드망 (20)     │  8080 (Spring Boot)                     ││
│   │  백엔드망 (20)     │  AI망 (30)         │  8001 (OCR), 8000 (태깅) — HTTP         ││
│   │  백엔드망 (20)     │  DB망 (40)         │  3306 (MariaDB)                         ││
│   │  백엔드망 (20)     │  스토리지망 (50)   │  2049 (NFS)                             ││
│   │  AI망 (30)         │  DB망 (40)         │  ✗ 차단 (Stateless 원칙)                ││
│   │  AI망 (30)         │  스토리지망 (50)   │  ✗ 차단 (Stateless 원칙)                ││
│   │  관리망 (100)      │  전체              │  SSH (22), 모니터링                     ││
│   └────────────────────┴────────────────────┴─────────────────────────────────────────┘│
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. Excalidraw 작성 가이드

### 10.1 권장 색상 코드

| 구분 | 색상 | Hex 코드 | 용도 |
|------|------|----------|------|
| **DMZ 계층** | 연한 파랑 | `#E3F2FD` | 웹 서버 (nginx) |
| **백엔드 계층** | 연한 하늘 | `#E1F5FE` | App 서버 (Spring Boot + AMQP Consumer) |
| **AI 처리 계층** | 연한 초록 | `#E8F5E9` | AI 서버 (OCR/태깅 FastAPI), Model Train |
| **데이터 계층** | 연한 노랑 | `#FFF8E1` | DB Primary/Replica |
| **인프라** | 연한 보라 | `#F3E5F5` | HCI 호스트, Mold |
| **강조** | 빨강 | `#FFCDD2` | 장애, 경고 |
| **연결선** | 검정 | `#000000` | 데이터 흐름 |
| **메시지 큐** | 연한 분홍 | `#FCE4EC` | RabbitMQ |

### 10.2 아이콘/심볼 권장

| 구성 요소 | 심볼 | 설명 |
|----------|------|------|
| **VM** | 사각형 (둥근 모서리) | vCPU/Memory 스펙 표시 |
| **호스트** | 큰 사각형 | VM 포함 컨테이너 |
| **데이터베이스** | 원통형 | MariaDB |
| **큐** | 사각형 + 화살표 | RabbitMQ |
| **AI 서버** | 뇌 아이콘 또는 별 | OCR/태깅 FastAPI |
| **사용자** | 사람 아이콘 | 사용자 |
| **장애** | X 표시 또는 빨간 테두리 | HA 시나리오 |
| **Mold** | 대시보드 아이콘 | ABLESTACK 관리 콘솔 |
| **복제** | 화살표 (단방향) | DB Replication |

### 10.3 다이어그램 우선순위

| 순위 | 다이어그램 | 목적 | 발표 시 |
|------|-----------|------|---------|
| **1** | 전체 아키텍처 구성도 | 전체 구조 이해 | 필수 |
| **2** | VM 배치 및 Anti-Affinity | HA 전략 설명 | 필수 |
| **3** | 서비스 데이터 흐름 | 동작 원리 설명 | 권장 |
| **4** | 고가용성(HA) 구조 | 장애 복구 설명 | 권장 |
| **5** | 리소스 풀 계층 구조 | 리소스 관리 설명 | 선택 |
| **6** | 네트워크 연결 구조 | 네트워크 팀 협업 시 | 선택 |

### 10.4 Excalidraw 작성 팁

```
1. 레이어 순서
   - 배경 영역 (VLAN, 계층) → 호스트 박스 → VM 박스 → 연결선 → 텍스트

2. 정렬
   - 계층별로 수평 정렬
   - 동일 서비스는 동일 높이에 배치
   - Anti-Affinity VM은 다른 호스트 박스 내에 배치
   - DB Primary/Replica는 서로 다른 Host에 배치

3. 연결선
   - 실선: 직접 통신 (HTTP, DB 접근)
   - 점선: 비동기 통신 (메시지 큐 경유)
   - 화살표: 데이터 흐름 방향
   - 단방향 화살표: DB 복제 방향 (Primary → Replica)

4. 텍스트
   - VM 내부: 이름, 스펙 (4vCPU/8GB)
   - 호스트 상단: Host 1, Host 2, Host 3
   - 계층 레이블: DMZ 계층, 백엔드 계층, AI 처리 계층, 데이터 계층 등

5. 크기 비율
   - Host 박스: 가장 큼
   - VM 박스: 중간
   - 아이콘/심볼: 작음
   - 폰트: 제목 24pt, 본문 14pt, 스펙 12pt

6. 메시지 큐 표현
   - RabbitMQ는 App 서버 내장으로 표현
   - AMQP Consumer → HTTP → AI 서버 흐름을 실선 화살표로 표현
   - 점선 화살표로 비동기 메시지 발행 표현

7. DB 복제 표현
   - Primary → Replica 방향 화살표
   - "Semi-Sync Replication" 라벨 추가

8. AI 서버 Stateless 표현
   - AI 서버에서 DB/NFS 방향 연결선 없음
   - "Stateless" 라벨 명시
   - 결과 저장 화살표는 Consumer → DB/NFS 방향
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-02-06 | 초안 작성 - Excalidraw 기반 아키텍처 다이어그램 가이드 | - |
| 2.0 | 2026-02-06 | 구조 단순화: Elasticsearch 제거, 별도 모니터링 VM 제거 (ABLESTACK Mold 활용), 메시지 큐 연결 명확화 | - |
| 3.0 | 2026-02-06 | **사이징 문서 반영**: 8 VM 구조, PostgreSQL → MariaDB 변경, Web/App 계층 분리, MariaDB Replication HA 구성 추가 | - |
| 4.0 | 2026-02-06 | **구성도 추가**: 하드웨어 구성도, 소프트웨어 구성도, 네트워크 토폴로지 구성도 추가 | - |
| 5.0 | 2026-02-10 | **아키텍처 변경 반영**: VLAN 재설계 (7→6개, 역할별), 테넌트 VLAN 제거 → 앱 레벨 RBAC, AI 서버 Stateless (OCR FastAPI :8001 + 태깅 FastAPI :8000), Spring AMQP Consumer → HTTP → AI 서버 흐름, Celery 제거, 방화벽 AI→DB/NFS 차단 명시 | - |

---

## 관련 문서

- [00_사이징.md](00_사이징.md) - 사이징 가정서 및 요청서
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md) - 컴퓨트 상세 설계
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md) - 네트워크/보안 설계 (VLAN 상세)
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계 (Ceph 연계)
- [07_백엔드_설계서.md](07_백엔드_설계서.md) - 백엔드 설계서
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 전체 개요
