# 컴퓨트 아키텍처 구성도

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 멀티 테넌트 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 컴퓨트 아키텍처 구성도 |
| 버전 | 1.0 |
| 작성일 | 2026-02-06 |
| 담당팀 | 컴퓨트/개발 팀 |
| 목적 | Excalidraw 기반 아키텍처 다이어그램 작성 가이드 |

---

**목차**

1. [전체 아키텍처 구성도](#1-전체-아키텍처-구성도)
2. [리소스 풀 계층 구조](#2-리소스-풀-계층-구조)
3. [VM 배치 및 Anti-Affinity](#3-vm-배치-및-anti-affinity)
4. [서비스 데이터 흐름](#4-서비스-데이터-흐름)
5. [고가용성(HA) 구조](#5-고가용성ha-구조)
6. [네트워크 연결 구조](#6-네트워크-연결-구조)
7. [Excalidraw 작성 가이드](#7-excalidraw-작성-가이드)

---

## 1. 전체 아키텍처 구성도

> **핵심 다이어그램**: 팀/멘토 발표 시 가장 먼저 보여줄 메인 구성도

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                        문서 태깅 플랫폼 컴퓨트 아키텍처 (전체 구성도)                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              사용자 (테넌트)                                      │  │
│   │                                                                                   │  │
│   │         부서 A                    부서 B                    부서 C               │  │
│   │        (VLAN 10)                 (VLAN 20)                 (VLAN 30)             │  │
│   │           │                         │                         │                  │  │
│   └───────────┼─────────────────────────┼─────────────────────────┼──────────────────┘  │
│               │                         │                         │                     │
│               └─────────────────────────┼─────────────────────────┘                     │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                         서비스 계층 (VLAN 40)                                     │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────┐     ┌───────────────┐     ┌───────────────┐        │   │  │
│   │   │   │  dev-svc-     │     │  dev-svc-     │     │  dev-svc-     │        │   │  │
│   │   │   │   web-01      │     │   web-02      │     │   api-01      │        │   │  │
│   │   │   │ ┌───────────┐ │     │ ┌───────────┐ │     │ ┌───────────┐ │        │   │  │
│   │   │   │ │ 2vCPU     │ │     │ │ 2vCPU     │ │     │ │ 2vCPU     │ │        │   │  │
│   │   │   │ │ 4GB RAM   │ │     │ │ 4GB RAM   │ │     │ │ 4GB RAM   │ │        │   │  │
│   │   │   │ │ nginx     │ │     │ │ nginx     │ │     │ │ Kong      │ │        │   │  │
│   │   │   │ └───────────┘ │     │ └───────────┘ │     │ └───────────┘ │        │   │  │
│   │   │   │   웹 서버 #1   │     │   웹 서버 #2   │     │  API Gateway  │        │   │  │
│   │   │   └───────────────┘     └───────────────┘     └───────────────┘        │   │  │
│   │   │          ↑                     ↑                      ↑                 │   │  │
│   │   │          └─────────────────────┴──────────────────────┘                 │   │  │
│   │   │                          Anti-Affinity                                  │   │  │
│   │   │                    (서로 다른 Host에 분산)                               │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                        비즈니스 계층 (VLAN 40)                                    │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────┐     ┌───────────────┐                              │   │  │
│   │   │   │  dev-svc-     │     │  dev-svc-     │                              │   │  │
│   │   │   │  tagging-01   │     │  tagging-02   │       RabbitMQ               │   │  │
│   │   │   │ ┌───────────┐ │     │ ┌───────────┐ │      ┌───────┐               │   │  │
│   │   │   │ │ 4vCPU     │ │     │ │ 4vCPU     │ │      │ Queue │               │   │  │
│   │   │   │ │ 8GB RAM   │ │     │ │ 8GB RAM   │ │◄─────│       │               │   │  │
│   │   │   │ │ Celery    │ │     │ │ Celery    │ │      │       │               │   │  │
│   │   │   │ └───────────┘ │     │ └───────────┘ │      └───────┘               │   │  │
│   │   │   │  태깅 워커 #1  │     │  태깅 워커 #2  │                              │   │  │
│   │   │   └───────────────┘     └───────────────┘                              │   │  │
│   │   │          ↑                     ↑                                        │   │  │
│   │   │          └─────────────────────┘                                        │   │  │
│   │   │              Anti-Affinity (분산 배치)                                  │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                         데이터 계층 (VLAN 50)                                     │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────┐     ┌───────────────┐     ┌───────────────┐        │   │  │
│   │   │   │  dev-data-    │     │  dev-data-    │     │  dev-data-    │        │   │  │
│   │   │   │   model-01    │     │    db-01      │     │  search-01    │        │   │  │
│   │   │   │ ┌───────────┐ │     │ ┌───────────┐ │     │ ┌───────────┐ │        │   │  │
│   │   │   │ │ 4vCPU     │ │     │ │ 4vCPU     │ │     │ │ 4vCPU     │ │        │   │  │
│   │   │   │ │ 8GB RAM   │ │     │ │ 8GB RAM   │ │     │ │ 8GB RAM   │ │        │   │  │
│   │   │   │ │ KoBERT    │ │     │ │PostgreSQL │ │     │ │Elasticsrch│ │        │   │  │
│   │   │   │ │ FastAPI   │ │     │ │           │ │     │ │           │ │        │   │  │
│   │   │   │ └───────────┘ │     │ └───────────┘ │     │ └───────────┘ │        │   │  │
│   │   │   │  모델 서빙     │     │ 메타데이터 DB  │     │   검색 서버    │        │   │  │
│   │   │   │ (CPU 추론)    │     │               │     │               │        │   │  │
│   │   │   └───────────────┘     └───────────────┘     └───────────────┘        │   │  │
│   │   │          ↑                     ↑                      ↑                 │   │  │
│   │   │          └─────────────────────┼──────────────────────┘                 │   │  │
│   │   │                    Affinity (DB-검색 동일 Host)                         │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                         관리 계층 (VLAN 100)                                      │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────┐                                                    │   │  │
│   │   │   │  dev-mgmt-    │                                                    │   │  │
│   │   │   │   mon-01      │     ┌──────────────────────────────────────────┐   │   │  │
│   │   │   │ ┌───────────┐ │     │  메트릭 수집                              │   │   │  │
│   │   │   │ │ 2vCPU     │ │     │  • CPU/Memory/Disk 사용률                 │   │   │  │
│   │   │   │ │ 4GB RAM   │ │◄────│  • 태깅 큐 길이                           │   │   │  │
│   │   │   │ │Prometheus │ │     │  • 처리 지연 시간                         │   │   │  │
│   │   │   │ │ Grafana   │ │     │  • VM 상태 모니터링                       │   │   │  │
│   │   │   │ └───────────┘ │     └──────────────────────────────────────────┘   │   │  │
│   │   │   │  모니터링      │                                                    │   │  │
│   │   │   └───────────────┘                                                    │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ────────────────────────────────────────────────────────────────────────────────────  │
│                                    인프라 계층                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          ABLESTACK HCI 클러스터                                   │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                       │  │
│   │   │   Host 1    │     │   Host 2    │     │   Host 3    │                       │  │
│   │   │   (KVM)     │     │   (KVM)     │     │   (KVM)     │                       │  │
│   │   │ ┌─────────┐ │     │ ┌─────────┐ │     │ ┌─────────┐ │                       │  │
│   │   │ │ Ceph OSD│ │     │ │ Ceph OSD│ │     │ │ Ceph OSD│ │                       │  │
│   │   │ └─────────┘ │     │ └─────────┘ │     │ └─────────┘ │                       │  │
│   │   └─────────────┘     └─────────────┘     └─────────────┘                       │  │
│   │          │                   │                   │                              │  │
│   │          └───────────────────┼───────────────────┘                              │  │
│   │                              │                                                   │  │
│   │                     Ceph 분산 스토리지                                           │  │
│   │                  (공유 스토리지 - Live Migration 지원)                           │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

총 VM: 10대
- 서비스 계층: 5대 (웹 2, API 1, 태깅워커 2)
- 데이터 계층: 3대 (모델서빙 1, DB 1, 검색 1)
- 관리 계층: 1대 (모니터링)
```

---

## 2. 리소스 풀 계층 구조

> **설명용 다이어그램**: 리소스 풀 구조와 오버커밋 정책 설명

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            리소스 풀 계층 구조                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                              ┌─────────────────────────┐                               │
│                              │       Root Pool         │                               │
│                              │    (전체 클러스터)       │                               │
│                              │                         │                               │
│                              │  ┌─────────────────┐   │                               │
│                              │  │ 오버커밋 정책   │   │                               │
│                              │  │ CPU: 2:1       │   │                               │
│                              │  │ Memory: 1:1    │   │                               │
│                              │  │ Storage: Thin  │   │                               │
│                              │  └─────────────────┘   │                               │
│                              └────────────┬────────────┘                               │
│                                           │                                             │
│           ┌───────────────────────────────┼───────────────────────────────┐            │
│           │                               │                               │            │
│           ▼                               ▼                               ▼            │
│   ┌───────────────────┐         ┌───────────────────┐         ┌───────────────────┐   │
│   │    서비스 풀       │         │    데이터 풀       │         │     관리 풀        │   │
│   │  (Service Pool)   │         │   (Data Pool)     │         │  (Management Pool) │   │
│   ├───────────────────┤         ├───────────────────┤         ├───────────────────┤   │
│   │                   │         │                   │         │                   │   │
│   │  할당 리소스:      │         │  할당 리소스:      │         │  할당 리소스:      │   │
│   │  vCPU: ~14개      │         │  vCPU: ~12개      │         │  vCPU: ~2개       │   │
│   │  Memory: ~28GB    │         │  Memory: ~24GB    │         │  Memory: ~4GB     │   │
│   │                   │         │                   │         │                   │   │
│   │  용도:            │         │  용도:            │         │  용도:            │   │
│   │  - 웹 서버        │         │  - 모델 서빙      │         │  - Prometheus     │   │
│   │  - API Gateway    │         │  - 메타데이터 DB  │         │  - Grafana        │   │
│   │  - 태깅 워커      │         │  - 검색 서버      │         │  - 알림 서비스     │   │
│   │                   │         │                   │         │                   │   │
│   └─────────┬─────────┘         └─────────┬─────────┘         └───────────────────┘   │
│             │                             │                                            │
│   ┌─────────┼─────────┐         ┌─────────┼─────────┐                                 │
│   │         │         │         │         │         │                                 │
│   ▼         ▼         ▼         ▼         ▼         ▼                                 │
│ ┌─────┐ ┌─────┐ ┌─────┐     ┌─────┐ ┌─────┐ ┌─────┐                                  │
│ │ Web │ │ API │ │Tag- │     │Model│ │ DB  │ │Srch │                                  │
│ │ x2  │ │ x1  │ │ging │     │Srvng│ │ x1  │ │ x1  │                                  │
│ │     │ │     │ │ x2  │     │ x1  │ │     │ │     │                                  │
│ └─────┘ └─────┘ └─────┘     └─────┘ └─────┘ └─────┘                                  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   오버커밋 정책 상세:                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   CPU 오버커밋 2:1                      Memory 오버커밋 없음 (1:1)              │  │
│   │   ┌───────────────────┐                ┌───────────────────┐                   │  │
│   │   │ 물리 CPU: 16코어  │                │ 물리 Mem: 64GB    │                   │  │
│   │   │        │          │                │        │          │                   │  │
│   │   │        ▼          │                │        ▼          │                   │  │
│   │   │ 가상 CPU: 32vCPU  │                │ 가상 Mem: 64GB    │                   │  │
│   │   │   할당 가능       │                │   할당 가능       │                   │  │
│   │   └───────────────────┘                └───────────────────┘                   │  │
│   │                                                                                 │  │
│   │   이유: CPU는 항상 100%     이유: Memory 스왑 발생 시                           │  │
│   │   사용되지 않음              성능 저하 심함                                      │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. VM 배치 및 Anti-Affinity

> **핵심 다이어그램**: HA를 위한 VM 분산 배치 전략

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          VM 배치 전략 (Anti-Affinity / Affinity)                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [Anti-Affinity 규칙] - 동일 서비스 VM 분산 배치 (HA 목적)                             │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │       Host 1                    Host 2                    Host 3               │  │
│   │   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │ web-01    │  │      │  │ web-02    │  │      │  │ api-01    │  │       │  │
│   │   │  │ 2vCPU/4GB │  │      │  │ 2vCPU/4GB │  │      │  │ 2vCPU/4GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │        │        │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │tagging-01 │  │      │  │tagging-02 │  │      │  │ model-01  │  │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │        │        │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │                 │       │  │
│   │   │  │  db-01    │  │      │  │ search-01 │  │      │                 │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │                 │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │                 │       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   └─────────────────┘      └─────────────────┘      └─────────────────┘       │  │
│   │                                                                                 │  │
│   │   ════════════════════════════════════════════════════════════════════════════ │  │
│   │                                                                                 │  │
│   │   Anti-Affinity 규칙:                                                          │  │
│   │   • AA-001: web-01 ≠ web-02      (웹 서버 분산)                                │  │
│   │   • AA-002: tagging-01 ≠ tagging-02  (태깅 워커 분산)                          │  │
│   │                                                                                 │  │
│   │   ✓ Host 1 장애 → web-02, tagging-02가 서비스 유지                            │  │
│   │   ✓ Host 2 장애 → web-01, tagging-01이 서비스 유지                            │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [Affinity 규칙] - 관련 VM 동일 배치 (성능 목적)                                       │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │       Host 2                                                                    │  │
│   │   ┌─────────────────────────────────────────────────────────────┐              │  │
│   │   │                                                             │              │  │
│   │   │    ┌───────────┐         ┌───────────┐                     │              │  │
│   │   │    │ db-01     │◄───────►│ search-01 │                     │              │  │
│   │   │    │PostgreSQL │ 빈번한  │Elasticsrch│                     │              │  │
│   │   │    │           │ 쿼리    │           │                     │              │  │
│   │   │    └───────────┘         └───────────┘                     │              │  │
│   │   │                                                             │              │  │
│   │   │    Affinity 규칙: AF-001 (DB-검색 동일 Host)               │              │  │
│   │   │    이유: 태그 검색 시 메타데이터 조회 빈번                  │              │  │
│   │   │                                                             │              │  │
│   │   └─────────────────────────────────────────────────────────────┘              │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [배치 규칙 요약표]                                                                    │
│   ┌────────────┬──────────────┬─────────────────────┬──────────────────────────────┐  │
│   │  규칙 ID   │     유형     │      대상 VM        │            설명              │  │
│   ├────────────┼──────────────┼─────────────────────┼──────────────────────────────┤  │
│   │  AA-001    │ Anti-Affinity│  웹 서버 (x2)       │  서비스 HA - 분산 배치       │  │
│   │  AA-002    │ Anti-Affinity│  태깅 워커 (x2)     │  처리 분산 - HA              │  │
│   │  AF-001    │ Affinity     │  DB + 검색 서버     │  쿼리 레이턴시 최소화        │  │
│   └────────────┴──────────────┴─────────────────────┴──────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 서비스 데이터 흐름

> **설명용 다이어그램**: 문서 업로드 → 태깅 → 검색 흐름

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           문서 태깅 서비스 데이터 흐름                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [1단계: 문서 업로드]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────────────┐              │
│   │ 사용자  │──①──►│ 웹 서버 │──②──►│ API GW  │──③──►│ 문서 스토리지   │              │
│   │(부서 A) │      │ (nginx) │      │ (Kong)  │      │ (Ceph RGW)      │              │
│   └─────────┘      └─────────┘      └─────────┘      └─────────────────┘              │
│        │                                │                                              │
│        │                                │ ④ 태깅 요청 큐 등록                          │
│        │                                ▼                                              │
│        │                          ┌───────────┐                                       │
│        │                          │ RabbitMQ  │                                       │
│        │                          │   Queue   │                                       │
│        │                          └─────┬─────┘                                       │
│        │                                │                                              │
│   ──────────────────────────────────────┼──────────────────────────────────────────   │
│                                         │                                              │
│   [2단계: 비동기 태깅 처리]               │                                              │
│                                         │ ⑤ 태깅 작업 수신                            │
│                                         ▼                                              │
│                                   ┌───────────┐                                       │
│                                   │ 태깅 워커 │                                       │
│                                   │ (Celery)  │                                       │
│                                   └─────┬─────┘                                       │
│                                         │                                              │
│                                         │ ⑥ 추론 요청                                 │
│                                         ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                            KoBERT 모델 서빙 (CPU 추론)                           │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   POST /api/v1/predict                                                  │   │  │
│   │   │   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐│   │  │
│   │   │   │ 입력            │      │ KoBERT 처리     │      │ 출력            ││   │  │
│   │   │   │ {               │──►   │ ┌─────────────┐ │  ──► │ {               ││   │  │
│   │   │   │  "text": "..." │      │ │ Tokenize    │ │      │  "tags": [      ││   │  │
│   │   │   │ }               │      │ │     ↓       │ │      │    "인사",      ││   │  │
│   │   │   │                 │      │ │ Embedding   │ │      │    "계약서"     ││   │  │
│   │   │   │ 응답시간:       │      │ │     ↓       │ │      │  ],            ││   │  │
│   │   │   │ < 500ms        │      │ │ Classify    │ │      │  "scores": [...]││   │  │
│   │   │   │ (CPU 추론)     │      │ └─────────────┘ │      │ }               ││   │  │
│   │   │   └─────────────────┘      └─────────────────┘      └─────────────────┘│   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                              │
│                                         │ ⑦ 태그 저장                                 │
│                                         ▼                                              │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [3단계: 메타데이터 저장 및 인덱싱]                                                    │
│                                                                                         │
│   ┌─────────────────┐                              ┌─────────────────┐                │
│   │  PostgreSQL     │◄───── ⑧ 동기화 ──────►       │  Elasticsearch  │                │
│   │  (메타데이터)    │                              │  (검색 인덱스)   │                │
│   │                 │                              │                 │                │
│   │  - 문서 ID      │                              │  - 태그 인덱스   │                │
│   │  - 파일명       │                              │  - 전문 검색     │                │
│   │  - 태그 목록    │                              │  - 필터링        │                │
│   │  - 부서 ID      │                              │                 │                │
│   │  - 생성일       │                              │                 │                │
│   └─────────────────┘                              └─────────────────┘                │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [4단계: 검색 서비스]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌───────────────┐      ┌─────────────────┐       │
│   │ 사용자  │──⑨──►│ 웹 서버 │──⑩──►│ Elasticsearch │──⑪──►│ 검색 결과 반환  │       │
│   │         │◄─⑫───│         │◄─────│ (태그 검색)   │      │ (테넌트 필터)   │       │
│   └─────────┘      └─────────┘      └───────────────┘      └─────────────────┘       │
│                                                                                         │
│   검색 쿼리 예시: "태그: 계약서 AND 부서: A"                                            │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 고가용성(HA) 구조

> **핵심 다이어그램**: 장애 시나리오와 자동 복구

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              고가용성(HA) 설계                                           │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [시나리오 1: 정상 상태]                                                               │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1                        Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   │ web-01  │   │          │   │ web-02  │   │          │   │ api-01  │   ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │                 ││  │
│   │   │   │tagging-01│   │          │   │tagging-02│   │          │                 ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │                 ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │                 ││  │
│   │   │                 │          │                 │          │                 ││  │
│   │   └─────────────────┘          └─────────────────┘          └─────────────────┘│  │
│   │                                                                                 │  │
│   │   ◄─────────────────────── 로드밸런서 ───────────────────────►                 │  │
│   │                            (트래픽 분산)                                        │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [시나리오 2: Host 1 장애 발생]                                                        │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1 (장애!)                Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │                 │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │ web-02  │   │          │   │ api-01  │   ││  │
│   │   │   ╳ web-01 ╳    │  ───►    │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  장애    │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  감지    │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳tagging-01╳  │          │   │tagging-02│   │          │   │ web-01' │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │    ✓    │   │          │   │ (재시작) │   ││  │
│   │   │                 │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │                 │          │                 │          │   ┌─────────┐   ││  │
│   │   │                 │          │                 │          │   │tagging-01'│   ││  │
│   │   │                 │          │                 │          │   │ (재시작) │   ││  │
│   │   └─────────────────┘          └─────────────────┘          │   └─────────┘   ││  │
│   │                                                              └─────────────────┘│  │
│   │                                                                                 │  │
│   │   HA 동작 순서:                                                                 │  │
│   │   ① 하트비트 타임아웃 (30초)                                                    │  │
│   │   ② Host 1 장애 확정                                                            │  │
│   │   ③ web-01, tagging-01 VM 목록 확인                                            │  │
│   │   ④ Host 3에서 VM 자동 재시작                                                   │  │
│   │   ⑤ Ceph RBD 스토리지 재연결 (공유 스토리지)                                    │  │
│   │   ⑥ 서비스 복구 완료                                                            │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [Live Migration - 계획된 유지보수]                                                    │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │                          Host 1                    Host 2                      │  │
│   │                      (유지보수 예정)                                            │  │
│   │                                                                                 │  │
│   │    단계 1:           ┌─────────┐               ┌─────────┐                     │  │
│   │    메모리 복사       │ [VM-A]  │  ──────────►  │ [VM-A'] │                     │  │
│   │                      │ Running │   메모리      │ 준비 중  │                     │  │
│   │                      └─────────┘   복사        └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 2:           ┌─────────┐               ┌─────────┐                     │  │
│   │    최종 동기화       │ [VM-A]  │  ◄──────────► │ [VM-A'] │                     │  │
│   │                      │ Paused  │   최종 동기화  │ Ready   │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 3:           ┌─────────┐               ┌─────────┐                     │  │
│   │    전환 완료         │   ---   │               │ [VM-A]  │                     │  │
│   │                      │ 종료됨  │               │ Running │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │   • 다운타임: 수 초 이내                                                        │  │
│   │   • 요구사항: Ceph RBD 공유 스토리지, 동일 CPU 아키텍처                         │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [HA 설정 요약]                                                                        │
│   ┌──────────────────┬────────────────┬────────────────────────────────────────────┐  │
│   │      설정 항목   │       값       │                  설명                      │  │
│   ├──────────────────┼────────────────┼────────────────────────────────────────────┤  │
│   │  HA 활성화       │      예        │  클러스터 레벨 HA 활성화                   │  │
│   │  장애 감지 시간  │     30초       │  하트비트 타임아웃                         │  │
│   │  자동 재시작     │      예        │  장애 VM 자동 재시작                       │  │
│   │  재시작 우선순위 │ High/Med/Low   │  DB > 모델 > 워커 > 웹                     │  │
│   │  공유 스토리지   │   Ceph RBD     │  VM 재시작 시 데이터 유지                  │  │
│   └──────────────────┴────────────────┴────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 네트워크 연결 구조

> **보조 다이어그램**: VLAN과 VM 간 통신 경로

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           네트워크 연결 구조 (VLAN 기반)                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                               ┌────────────────┐                                       │
│                               │   외부 네트워크 │                                       │
│                               │   (인터넷/WAN) │                                       │
│                               └───────┬────────┘                                       │
│                                       │                                                 │
│                               ┌───────▼────────┐                                       │
│                               │   방화벽/LB    │                                       │
│                               │  (VLAN 1 DMZ) │                                       │
│                               └───────┬────────┘                                       │
│                                       │                                                 │
│   ┌───────────────────────────────────┼───────────────────────────────────┐            │
│   │                                   │                                   │            │
│   ▼                                   ▼                                   ▼            │
│   ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐              │
│   │    VLAN 10        │   │    VLAN 20        │   │    VLAN 30        │              │
│   │   (부서 A 망)     │   │   (부서 B 망)     │   │   (부서 C 망)     │              │
│   │                   │   │                   │   │                   │              │
│   │  ┌─────────────┐  │   │  ┌─────────────┐  │   │  ┌─────────────┐  │              │
│   │  │ 부서 A 사용자│  │   │  │ 부서 B 사용자│  │   │  │ 부서 C 사용자│  │              │
│   │  └─────────────┘  │   │  └─────────────┘  │   │  └─────────────┘  │              │
│   │         │         │   │         │         │   │         │         │              │
│   │    문서 접근       │   │    문서 접근       │   │    문서 접근       │              │
│   │    (자기 부서만)   │   │    (자기 부서만)   │   │    (자기 부서만)   │              │
│   │                   │   │                   │   │                   │              │
│   └─────────┬─────────┘   └─────────┬─────────┘   └─────────┬─────────┘              │
│             │                       │                       │                         │
│             └───────────────────────┼───────────────────────┘                         │
│                                     │                                                  │
│                                     ▼                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 40 (서비스 망)                                    │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐                  │  │
│   │   │ web-01  │     │ web-02  │     │ api-01  │     │ tagging │                  │  │
│   │   │ :80/443 │     │ :80/443 │     │ :8000   │     │ :5672   │                  │  │
│   │   └────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘                  │  │
│   │        │               │               │               │                        │  │
│   └────────┼───────────────┼───────────────┼───────────────┼────────────────────────┘  │
│            │               │               │               │                           │
│            └───────────────┴───────────────┴───────────────┘                           │
│                                     │                                                  │
│                                     ▼                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 50 (데이터 망)                                    │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐                                  │  │
│   │   │model-01 │     │  db-01  │     │search-01│                                  │  │
│   │   │ :8080   │     │ :5432   │     │ :9200   │                                  │  │
│   │   └────┬────┘     └────┬────┘     └────┬────┘                                  │  │
│   │        │               │               │                                        │  │
│   └────────┼───────────────┼───────────────┼────────────────────────────────────────┘  │
│            │               │               │                                           │
│            └───────────────┴───────────────┘                                           │
│                            │                                                           │
│                            ▼                                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 60 (스토리지 망)                                  │  │
│   │                                                                                 │  │
│   │                        Ceph 분산 스토리지                                        │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐                                  │  │
│   │   │ OSD 1   │     │ OSD 2   │     │ OSD 3   │                                  │  │
│   │   └─────────┘     └─────────┘     └─────────┘                                  │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 100 (관리 망)                                     │  │
│   │                                                                                 │  │
│   │   ┌─────────┐                                                                   │  │
│   │   │ mon-01  │  ◄──── 모든 VM에서 메트릭 수집                                   │  │
│   │   │ :9090   │        (node_exporter :9100)                                     │  │
│   │   │ :3000   │                                                                   │  │
│   │   └─────────┘                                                                   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   [VLAN 요약]                                                                          │
│   ┌────────────┬──────────────────────────────────────────────────────────────────┐   │
│   │  VLAN ID   │                          용도                                    │   │
│   ├────────────┼──────────────────────────────────────────────────────────────────┤   │
│   │    10      │  부서 A 전용 네트워크 (테넌트 격리)                              │   │
│   │    20      │  부서 B 전용 네트워크 (테넌트 격리)                              │   │
│   │    30      │  부서 C 전용 네트워크 (테넌트 격리)                              │   │
│   │    40      │  서비스 망 (웹, API, 태깅 워커)                                  │   │
│   │    50      │  데이터 망 (모델 서빙, DB, 검색 서버)                            │   │
│   │    60      │  스토리지 망 (Ceph 백엔드)                                       │   │
│   │   100      │  관리 망 (모니터링, 운영)                                        │   │
│   └────────────┴──────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Excalidraw 작성 가이드

### 7.1 권장 색상 코드

| 구분 | 색상 | Hex 코드 | 용도 |
|------|------|----------|------|
| **서비스 계층** | 연한 파랑 | `#E3F2FD` | 웹 서버, API Gateway |
| **비즈니스 계층** | 연한 초록 | `#E8F5E9` | 태깅 워커 |
| **데이터 계층** | 연한 노랑 | `#FFF8E1` | DB, 모델 서빙, 검색 |
| **관리 계층** | 연한 회색 | `#F5F5F5` | 모니터링 |
| **인프라** | 연한 보라 | `#F3E5F5` | HCI 호스트 |
| **테넌트** | 연한 주황 | `#FFF3E0` | 부서별 영역 |
| **강조** | 빨강 | `#FFCDD2` | 장애, 경고 |
| **연결선** | 검정 | `#000000` | 데이터 흐름 |

### 7.2 아이콘/심볼 권장

| 구성 요소 | 심볼 | 설명 |
|----------|------|------|
| **VM** | 사각형 (둥근 모서리) | vCPU/Memory 스펙 표시 |
| **호스트** | 큰 사각형 | VM 포함 컨테이너 |
| **데이터베이스** | 원통형 | PostgreSQL, Elasticsearch |
| **큐** | 사각형 + 화살표 | RabbitMQ |
| **AI 모델** | 뇌 아이콘 또는 별 | KoBERT |
| **사용자** | 사람 아이콘 | 테넌트 사용자 |
| **장애** | X 표시 또는 빨간 테두리 | HA 시나리오 |

### 7.3 다이어그램 우선순위

| 순위 | 다이어그램 | 목적 | 발표 시 |
|------|-----------|------|---------|
| **1** | 전체 아키텍처 구성도 | 전체 구조 이해 | 필수 |
| **2** | VM 배치 및 Anti-Affinity | HA 전략 설명 | 필수 |
| **3** | 서비스 데이터 흐름 | 동작 원리 설명 | 권장 |
| **4** | 고가용성(HA) 구조 | 장애 복구 설명 | 권장 |
| **5** | 리소스 풀 계층 구조 | 리소스 관리 설명 | 선택 |
| **6** | 네트워크 연결 구조 | 네트워크 팀 협업 시 | 선택 |

### 7.4 Excalidraw 작성 팁

```
1. 레이어 순서
   - 배경 영역 (VLAN, 계층) → 호스트 박스 → VM 박스 → 연결선 → 텍스트

2. 정렬
   - 계층별로 수평 정렬
   - 동일 서비스는 동일 높이에 배치
   - Anti-Affinity VM은 다른 호스트 박스 내에 배치

3. 연결선
   - 실선: 직접 통신
   - 점선: 간접 통신, 비동기
   - 화살표: 데이터 흐름 방향

4. 텍스트
   - VM 내부: 이름, 스펙 (2vCPU/4GB)
   - 호스트 상단: Host 1, Host 2, Host 3
   - 계층 레이블: 서비스 계층, 데이터 계층 등

5. 크기 비율
   - Host 박스: 가장 큼
   - VM 박스: 중간
   - 아이콘/심볼: 작음
   - 폰트: 제목 24pt, 본문 14pt, 스펙 12pt
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-02-06 | 초안 작성 - Excalidraw 기반 아키텍처 다이어그램 가이드 | - |

---

## 관련 문서

- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md) - 컴퓨트 상세 설계
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md) - 네트워크/보안 설계 (VLAN 상세)
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계 (Ceph 연계)
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 전체 개요
