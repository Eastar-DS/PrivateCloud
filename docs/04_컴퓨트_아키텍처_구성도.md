# 컴퓨트 아키텍처 구성도

## 공공기관 AI 공동 활용 인프라 구축 프로젝트
### AI 기반 문서 태깅 시스템을 위한 멀티 테넌트 프라이빗 클라우드 설계

| 항목 | 내용 |
|------|------|
| 문서명 | 컴퓨트 아키텍처 구성도 |
| 버전 | 3.0 |
| 작성일 | 2026-02-06 |
| 담당팀 | 컴퓨트/개발 팀 |
| 목적 | Excalidraw 기반 아키텍처 다이어그램 작성 가이드 |

---

**목차**

1. [전체 아키텍처 구성도](#1-전체-아키텍처-구성도)
2. [리소스 풀 계층 구조](#2-리소스-풀-계층-구조)
3. [VM 배치 및 Anti-Affinity](#3-vm-배치-및-anti-affinity)
4. [서비스 데이터 흐름](#4-서비스-데이터-흐름)
5. [고가용성(HA) 구조](#5-고가용성ha-구조)
6. [네트워크 연결 구조](#6-네트워크-연결-구조)
7. [Excalidraw 작성 가이드](#7-excalidraw-작성-가이드)

---

## 1. 전체 아키텍처 구성도

> **핵심 다이어그램**: 팀/멘토 발표 시 가장 먼저 보여줄 메인 구성도

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                        문서 태깅 플랫폼 컴퓨트 아키텍처 (전체 구성도)                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                              사용자 (테넌트)                                      │  │
│   │                                                                                   │  │
│   │         부서 A                    부서 B                    부서 C               │  │
│   │        (VLAN 10)                 (VLAN 20)                 (VLAN 30)             │  │
│   │           │                         │                         │                  │  │
│   └───────────┼─────────────────────────┼─────────────────────────┼──────────────────┘  │
│               │                         │                         │                     │
│               └─────────────────────────┼─────────────────────────┘                     │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          프론트엔드 계층 (VLAN 40)                                │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-svc-web-01        │     │     dev-svc-web-02        │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 2vCPU / 4GB RAM   │   │     │   │ 2vCPU / 4GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ nginx             │   │     │   │ nginx             │   │      │   │  │
│   │   │   │   │ (Reverse Proxy)   │   │     │   │ (Reverse Proxy)   │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │       웹 서버 #1          │     │       웹 서버 #2          │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                ↑                              ↑                         │   │  │
│   │   │                └──────────────────────────────┘                         │   │  │
│   │   │                      Anti-Affinity (분산 배치)                          │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                        애플리케이션 계층 (VLAN 40)                                │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-svc-app-01        │     │     dev-svc-app-02        │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 4vCPU / 8GB RAM   │   │     │   │ 4vCPU / 8GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ Spring Boot       │   │     │   │ Spring Boot       │   │      │   │  │
│   │   │   │   │ (REST API)        │   │     │   │ (REST API)        │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │       App 서버 #1         │     │       App 서버 #2         │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                ↑                              ↑                         │   │  │
│   │   │                └──────────────────────────────┘                         │   │  │
│   │   │                      Anti-Affinity (분산 배치)                          │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         │ RabbitMQ (메시지 큐)                          │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          AI 처리 계층 (VLAN 50)                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-ai-worker-01      │     │     dev-ai-train-01       │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 4vCPU / 8GB RAM   │   │     │   │ 4vCPU / 8GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ Docker Python     │   │     │   │ Docker Python     │   │      │   │  │
│   │   │   │   │ - KoBERT 추론     │   │     │   │ - 모델 파인튜닝   │   │      │   │  │
│   │   │   │   │ - OCR 처리        │   │     │   │ - 주기적 학습     │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │    AI 태깅/OCR 워커        │     │    모델 학습 워커         │      │   │  │
│   │   │   │      (상시 운영)           │     │     (주기적 운영)         │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          데이터 계층 (VLAN 50)                                    │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌───────────────────────────┐     ┌───────────────────────────┐      │   │  │
│   │   │   │     dev-data-db-pri       │     │     dev-data-db-rep       │      │   │  │
│   │   │   │   ┌───────────────────┐   │     │   ┌───────────────────┐   │      │   │  │
│   │   │   │   │ 4vCPU / 8GB RAM   │   │     │   │ 4vCPU / 8GB RAM   │   │      │   │  │
│   │   │   │   │ Rocky Linux 9     │   │     │   │ Rocky Linux 9     │   │      │   │  │
│   │   │   │   │ MariaDB 10.11     │   │     │   │ MariaDB 10.11     │   │      │   │  │
│   │   │   │   │ (Read/Write)      │   │     │   │ (Read Only)       │   │      │   │  │
│   │   │   │   └───────────────────┘   │     │   └───────────────────┘   │      │   │  │
│   │   │   │     DB Primary            │     │     DB Replica            │      │   │  │
│   │   │   │      (쓰기 담당)           │ ──► │      (읽기 담당)           │      │   │  │
│   │   │   └───────────────────────────┘     └───────────────────────────┘      │   │  │
│   │   │                ↑                              ↑                         │   │  │
│   │   │                └──────────────────────────────┘                         │   │  │
│   │   │                   Anti-Affinity (Primary/Replica 분산)                  │   │  │
│   │   │                                                                         │   │  │
│   │   │    ※ 검색 기능: MariaDB Full-text Search (추후 검색엔진 확장 가능)      │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ────────────────────────────────────────────────────────────────────────────────────  │
│                                    인프라 계층                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                          ABLESTACK HCI 클러스터                                   │  │
│   │                                                                                   │  │
│   │   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                       │  │
│   │   │   Host 1    │     │   Host 2    │     │   Host 3    │                       │  │
│   │   │   (KVM)     │     │   (KVM)     │     │   (KVM)     │                       │  │
│   │   │ ┌─────────┐ │     │ ┌─────────┐ │     │ ┌─────────┐ │                       │  │
│   │   │ │ Ceph OSD│ │     │ │ Ceph OSD│ │     │ │ Ceph OSD│ │                       │  │
│   │   │ └─────────┘ │     │ └─────────┘ │     │ └─────────┘ │                       │  │
│   │   └─────────────┘     └─────────────┘     └─────────────┘                       │  │
│   │          │                   │                   │                              │  │
│   │          └───────────────────┼───────────────────┘                              │  │
│   │                              │                                                   │  │
│   │                     Ceph 분산 스토리지                                           │  │
│   │                  (공유 스토리지 - Live Migration 지원)                           │  │
│   │                                                                                   │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                     ABLESTACK Mold (모니터링)                            │   │  │
│   │   │   • VM 상태 모니터링      • CPU/Memory/Disk 사용률                       │   │  │
│   │   │   • 호스트 상태 감시      • 알림 및 이벤트 관리                          │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                   │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

총 VM: 8대
- 프론트엔드 계층: 2대 (웹 서버 x2)
- 애플리케이션 계층: 2대 (App 서버 x2)
- AI 처리 계층: 2대 (AI Worker x1, Model Train x1)
- 데이터 계층: 2대 (DB Primary x1, DB Replica x1)
- 모니터링: ABLESTACK Mold 기본 기능 활용

총 리소스: 26 vCPU, 52GB RAM, 850GB VM 디스크
```

---

## 2. 리소스 풀 계층 구조

> **설명용 다이어그램**: 리소스 풀 구조와 오버커밋 정책 설명

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            리소스 풀 계층 구조                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                              ┌─────────────────────────┐                               │
│                              │       Root Pool         │                               │
│                              │    (전체 클러스터)       │                               │
│                              │                         │                               │
│                              │  ┌─────────────────┐   │                               │
│                              │  │ 오버커밋 정책   │   │                               │
│                              │  │ CPU: 2:1       │   │                               │
│                              │  │ Memory: 1:1    │   │                               │
│                              │  │ Storage: Thin  │   │                               │
│                              │  └─────────────────┘   │                               │
│                              └────────────┬────────────┘                               │
│                                           │                                             │
│               ┌───────────────────────────┼───────────────────────────┐                │
│               │                           │                           │                │
│               ▼                           ▼                           ▼                │
│   ┌───────────────────────┐   ┌───────────────────────┐   ┌───────────────────────┐   │
│   │       서비스 풀        │   │       데이터 풀        │   │       관리 풀         │   │
│   │    (Service Pool)     │   │      (Data Pool)      │   │    (Mgmt Pool)       │   │
│   ├───────────────────────┤   ├───────────────────────┤   ├───────────────────────┤   │
│   │                       │   │                       │   │                       │   │
│   │  할당 리소스:          │   │  할당 리소스:          │   │  할당 리소스:          │   │
│   │  vCPU: 12개           │   │  vCPU: 12개           │   │  (Mold 기본 기능)     │   │
│   │  Memory: 24GB         │   │  Memory: 24GB         │   │                       │   │
│   │                       │   │                       │   │                       │   │
│   │  용도:                │   │  용도:                │   │  용도:                │   │
│   │  - 웹 서버 (x2)       │   │  - DB Primary (x1)    │   │  - ABLESTACK Mold    │   │
│   │  - App 서버 (x2)      │   │  - DB Replica (x1)    │   │  - 모니터링/관리      │   │
│   │                       │   │  - AI Worker (x1)     │   │                       │   │
│   │                       │   │  - Model Train (x1)   │   │                       │   │
│   │                       │   │                       │   │                       │   │
│   └───────────┬───────────┘   └───────────┬───────────┘   └───────────────────────┘   │
│               │                           │                                             │
│   ┌───────────┼───────────┐   ┌───────────┼───────────────────────┐                   │
│   │   │       │   │       │   │   │       │       │       │       │                   │
│   ▼   ▼       ▼   ▼       │   ▼   ▼       ▼       ▼       ▼       │                   │
│ ┌─────┐┌─────┐┌─────┐┌─────┐ ┌─────┐┌─────┐┌─────┐┌─────┐        │                   │
│ │ Web ││ Web ││ App ││ App │ │DB   ││DB   ││ AI  ││Model│        │                   │
│ │ #1  ││ #2  ││ #1  ││ #2  │ │Pri  ││Rep  ││Workr││Train│        │                   │
│ │     ││     ││     ││     │ │     ││     ││     ││     │        │                   │
│ └─────┘└─────┘└─────┘└─────┘ └─────┘└─────┘└─────┘└─────┘        │                   │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   오버커밋 정책 상세:                                                                   │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   CPU 오버커밋 2:1                      Memory 오버커밋 없음 (1:1)              │  │
│   │   ┌───────────────────┐                ┌───────────────────┐                   │  │
│   │   │ 물리 CPU: 24코어  │                │ 물리 Mem: 96GB    │                   │  │
│   │   │        │          │                │        │          │                   │  │
│   │   │        ▼          │                │        ▼          │                   │  │
│   │   │ 가상 CPU: 48vCPU  │                │ 가상 Mem: 96GB    │                   │  │
│   │   │   할당 가능       │                │   할당 가능       │                   │  │
│   │   │                   │                │                   │                   │  │
│   │   │ 현재 할당: 26vCPU │                │ 현재 할당: 52GB   │                   │  │
│   │   └───────────────────┘                └───────────────────┘                   │  │
│   │                                                                                 │  │
│   │   이유: CPU는 항상 100%     이유: Memory 스왑 발생 시                           │  │
│   │   사용되지 않음              성능 저하 심함                                      │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. VM 배치 및 Anti-Affinity

> **핵심 다이어그램**: HA를 위한 VM 분산 배치 전략

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          VM 배치 전략 (Anti-Affinity / Affinity)                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [Anti-Affinity 규칙] - 동일 서비스 VM 분산 배치 (HA 목적)                             │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │       Host 1                    Host 2                    Host 3               │  │
│   │   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │ web-01    │  │      │  │ web-02    │  │      │  │ai-worker-01│  │       │  │
│   │   │  │ 2vCPU/4GB │  │      │  │ 2vCPU/4GB │  │      │  │ 4vCPU/8GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │        │        │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │  ┌───────────┐  │       │  │
│   │   │  │ app-01    │  │      │  │ app-02    │  │      │  │ai-train-01│  │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │  └───────────┘  │       │  │
│   │   │        │        │      │        │        │      │                 │       │  │
│   │   │  ┌───────────┐  │      │  ┌───────────┐  │      │                 │       │  │
│   │   │  │ db-pri    │  │      │  │ db-rep    │  │      │                 │       │  │
│   │   │  │ 4vCPU/8GB │  │      │  │ 4vCPU/8GB │  │      │                 │       │  │
│   │   │  └───────────┘  │      │  └───────────┘  │      │                 │       │  │
│   │   │                 │      │                 │      │                 │       │  │
│   │   └─────────────────┘      └─────────────────┘      └─────────────────┘       │  │
│   │                                                                                 │  │
│   │   리소스 배분:                                                                  │  │
│   │   • Host 1: 10vCPU / 20GB (web-01, app-01, db-pri)                            │  │
│   │   • Host 2: 10vCPU / 20GB (web-02, app-02, db-rep)                            │  │
│   │   • Host 3: 8vCPU / 16GB (ai-worker-01, ai-train-01)                          │  │
│   │                                                                                 │  │
│   │   ════════════════════════════════════════════════════════════════════════════ │  │
│   │                                                                                 │  │
│   │   Anti-Affinity 규칙:                                                          │  │
│   │   • AA-001: web-01 ≠ web-02           (웹 서버 분산)                           │  │
│   │   • AA-002: app-01 ≠ app-02           (App 서버 분산)                          │  │
│   │   • AA-003: db-pri ≠ db-rep           (DB Primary/Replica 분산)               │  │
│   │                                                                                 │  │
│   │   ✓ Host 1 장애 → web-02, app-02, db-rep가 서비스 유지                        │  │
│   │   ✓ Host 2 장애 → web-01, app-01, db-pri가 서비스 유지                        │  │
│   │   ✓ Host 3 장애 → AI 처리 일시 중단 (서비스 영향 최소화)                       │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [배치 규칙 요약표]                                                                    │
│   ┌────────────┬──────────────┬─────────────────────┬──────────────────────────────┐  │
│   │  규칙 ID   │     유형     │      대상 VM        │            설명              │  │
│   ├────────────┼──────────────┼─────────────────────┼──────────────────────────────┤  │
│   │  AA-001    │ Anti-Affinity│  웹 서버 (x2)       │  서비스 HA - 분산 배치       │  │
│   │  AA-002    │ Anti-Affinity│  App 서버 (x2)      │  API 서비스 HA - 분산 배치   │  │
│   │  AA-003    │ Anti-Affinity│  DB Pri/Rep (x2)    │  DB HA - Primary/Replica 분산│  │
│   └────────────┴──────────────┴─────────────────────┴──────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 서비스 데이터 흐름

> **설명용 다이어그램**: 문서 업로드 → 태깅 → 검색 흐름

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           문서 태깅 서비스 데이터 흐름                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [1단계: 문서 업로드]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌─────────────┐      ┌─────────────────┐          │
│   │ 사용자  │──①──►│ 웹 서버 │──②──►│ App 서버    │──③──►│ 문서 스토리지   │          │
│   │(부서 A) │      │ (nginx) │      │(Spring Boot)│      │ (Ceph RGW)      │          │
│   └─────────┘      └─────────┘      └─────────────┘      └─────────────────┘          │
│        │                                   │                                           │
│        │                                   │ ④ 태깅 요청 큐 등록                       │
│        │                                   ▼                                           │
│        │                             ┌───────────┐                                    │
│        │                             │ RabbitMQ  │  ◄─── App 서버와 AI Worker 연결   │
│        │                             │   Queue   │       메시지 큐                    │
│        │                             └─────┬─────┘                                    │
│        │                                   │                                           │
│   ──────────────────────────────────────────┼─────────────────────────────────────────   │
│                                            │                                           │
│   [2단계: 비동기 태깅 처리]                  │                                           │
│                                            │ ⑤ 태깅 작업 수신 (Celery)                │
│                                            ▼                                           │
│                                      ┌───────────┐                                    │
│                                      │AI Worker  │                                    │
│                                      │(Python)   │                                    │
│                                      └─────┬─────┘                                    │
│                                            │                                           │
│                                            │ ⑥ 추론 처리                              │
│                                            ▼                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                            KoBERT 모델 추론 + OCR 처리                          │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   POST /api/v1/predict                                                  │   │  │
│   │   │   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐│   │  │
│   │   │   │ 입력            │      │ 처리 파이프라인 │      │ 출력            ││   │  │
│   │   │   │ {               │──►   │ ┌─────────────┐ │  ──► │ {               ││   │  │
│   │   │   │  "file": "..." │      │ │ OCR 추출    │ │      │  "tags": [      ││   │  │
│   │   │   │ }               │      │ │     ↓       │ │      │    "인사",      ││   │  │
│   │   │   │                 │      │ │ KoBERT 추론 │ │      │    "계약서"     ││   │  │
│   │   │   │ 응답시간:       │      │ │     ↓       │ │      │  ],            ││   │  │
│   │   │   │ < 5초          │      │ │ 태그 분류   │ │      │  "scores": [...]││   │  │
│   │   │   │ (CPU 추론)     │      │ └─────────────┘ │      │ }               ││   │  │
│   │   │   └─────────────────┘      └─────────────────┘      └─────────────────┘│   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                            │                                           │
│                                            │ ⑦ 태그 저장                              │
│                                            ▼                                           │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [3단계: 메타데이터 저장]                                                              │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                      MariaDB Replication (Primary/Replica)                      │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                                                                         │   │  │
│   │   │   ┌─────────────────────┐        ┌─────────────────────┐               │   │  │
│   │   │   │    DB Primary       │        │    DB Replica       │               │   │  │
│   │   │   │   (Read/Write)      │───────►│   (Read Only)       │               │   │  │
│   │   │   │                     │  복제  │                     │               │   │  │
│   │   │   └─────────────────────┘        └─────────────────────┘               │   │  │
│   │   │                                                                         │   │  │
│   │   │   저장 데이터:                                                           │   │  │
│   │   │   - 문서 ID, 파일명, 파일 경로                                          │   │  │
│   │   │   - 태그 목록 (JSON)                                                    │   │  │
│   │   │   - 부서 ID (테넌트)                                                    │   │  │
│   │   │   - 생성일, 수정일                                                       │   │  │
│   │   │                                                                         │   │  │
│   │   │   검색 기능: MariaDB Full-text Search                                   │   │  │
│   │   │   ※ 추후 필요 시 검색엔진(Elasticsearch 등) 확장 가능                   │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [4단계: 검색 서비스]                                                                  │
│                                                                                         │
│   ┌─────────┐      ┌─────────┐      ┌─────────────┐      ┌─────────────────┐       │
│   │ 사용자  │──⑧──►│ 웹 서버 │──⑨──►│ App 서버    │──⑩──►│  DB Replica     │       │
│   │         │◄─⑪───│         │◄─────│(Spring Boot)│◄─────│ (읽기 분산)     │       │
│   └─────────┘      └─────────┘      └─────────────┘      └─────────────────┘       │
│                                                                                         │
│   검색 쿼리 예시: SELECT * FROM documents WHERE tags LIKE '%계약서%' AND dept_id = 'A' │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 고가용성(HA) 구조

> **핵심 다이어그램**: 장애 시나리오와 자동 복구

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              고가용성(HA) 설계                                           │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   [시나리오 1: 정상 상태]                                                               │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1                        Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   │ web-01  │   │          │   │ web-02  │   │          │   │ai-worker│   ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   │ app-01  │   │          │   │ app-02  │   │          │   │ai-train │   ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ┌─────────┐   │          │   ┌─────────┐   │          │                 ││  │
│   │   │   │ db-pri  │   │          │   │ db-rep  │   │          │                 ││  │
│   │   │   │    ✓    │   │          │   │    ✓    │   │          │                 ││  │
│   │   │   └─────────┘   │          │   └─────────┘   │          │                 ││  │
│   │   │                 │          │                 │          │                 ││  │
│   │   └─────────────────┘          └─────────────────┘          └─────────────────┘│  │
│   │                                                                                 │  │
│   │   ◄─────────────────────── 로드밸런서 ───────────────────────►                 │  │
│   │                            (트래픽 분산)                                        │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [시나리오 2: Host 1 장애 발생]                                                        │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   Host 1 (장애!)                Host 2                        Host 3           │  │
│   │   ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐│  │
│   │   │                 │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │ web-02  │   │          │   │ai-worker│   ││  │
│   │   │   ╳ web-01 ╳    │  ───►    │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  장애    │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │  감지    │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳ app-01 ╳    │          │   │ app-02  │   │          │   │ai-train │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │    ✓    │   │          │   │    ✓    │   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │   ╳ db-pri ╳    │          │   ┌─────────┐   │          │   ┌─────────┐   ││  │
│   │   │   ╳╳╳╳╳╳╳╳╳    │          │   │ db-rep  │   │          │   │ web-01' │   ││  │
│   │   │                 │          │   │   승격   │   │          │   │ (재시작)│   ││  │
│   │   │                 │          │   └─────────┘   │          │   └─────────┘   ││  │
│   │   │                 │          │                 │          │   ┌─────────┐   ││  │
│   │   │                 │          │                 │          │   │ app-01' │   ││  │
│   │   │                 │          │                 │          │   │ (재시작)│   ││  │
│   │   └─────────────────┘          └─────────────────┘          │   └─────────┘   ││  │
│   │                                                              └─────────────────┘│  │
│   │                                                                                 │  │
│   │   HA 동작 순서:                                                                 │  │
│   │   ① 하트비트 타임아웃 (30초)                                                    │  │
│   │   ② Host 1 장애 확정                                                            │  │
│   │   ③ web-01, app-01, db-pri VM 목록 확인                                        │  │
│   │   ④ Host 3에서 web-01, app-01 VM 자동 재시작                                   │  │
│   │   ⑤ db-rep를 Primary로 승격 (수동 또는 자동)                                   │  │
│   │   ⑥ Ceph RBD 스토리지 재연결 (공유 스토리지)                                    │  │
│   │   ⑦ 서비스 복구 완료                                                            │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [MariaDB Replication HA]                                                             │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │   ┌─────────────────────┐              ┌─────────────────────┐                 │  │
│   │   │    DB Primary       │              │    DB Replica       │                 │  │
│   │   │   (dev-data-db-pri) │───────────►  │  (dev-data-db-rep)  │                 │  │
│   │   │                     │  Semi-Sync   │                     │                 │  │
│   │   │   Read/Write        │  Replication │   Read Only         │                 │  │
│   │   │                     │              │                     │                 │  │
│   │   └─────────────────────┘              └─────────────────────┘                 │  │
│   │            │                                     │                              │  │
│   │            │ 장애 발생 시                        │                              │  │
│   │            ▼                                     ▼                              │  │
│   │   ┌─────────────────────┐              ┌─────────────────────┐                 │  │
│   │   │   장애 감지         │              │   Primary 승격      │                 │  │
│   │   │                     │───────────►  │   (Read/Write)      │                 │  │
│   │   │                     │              │                     │                 │  │
│   │   └─────────────────────┘              └─────────────────────┘                 │  │
│   │                                                                                 │  │
│   │   복제 설정:                                                                    │  │
│   │   • Semi-Synchronous Replication                                               │  │
│   │   • GTID 기반 복제 (Global Transaction ID)                                     │  │
│   │   • 읽기 분산: Replica로 읽기 쿼리 분산                                         │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [Live Migration - 계획된 유지보수]                                                    │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                                 │  │
│   │                          Host 1                    Host 2                      │  │
│   │                      (유지보수 예정)                                            │  │
│   │                                                                                 │  │
│   │    단계 1:           ┌─────────┐               ┌─────────┐                     │  │
│   │    메모리 복사       │ [VM-A]  │  ──────────►  │ [VM-A'] │                     │  │
│   │                      │ Running │   메모리      │ 준비 중  │                     │  │
│   │                      └─────────┘   복사        └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 2:           ┌─────────┐               ┌─────────┐                     │  │
│   │    최종 동기화       │ [VM-A]  │  ◄──────────► │ [VM-A'] │                     │  │
│   │                      │ Paused  │   최종 동기화  │ Ready   │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │    단계 3:           ┌─────────┐               ┌─────────┐                     │  │
│   │    전환 완료         │   ---   │               │ [VM-A]  │                     │  │
│   │                      │ 종료됨  │               │ Running │                     │  │
│   │                      └─────────┘               └─────────┘                     │  │
│   │                                                                                 │  │
│   │   • 다운타임: 수 초 이내                                                        │  │
│   │   • 요구사항: Ceph RBD 공유 스토리지, 동일 CPU 아키텍처                         │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   [HA 설정 요약]                                                                        │
│   ┌──────────────────┬────────────────┬────────────────────────────────────────────┐  │
│   │      설정 항목   │       값       │                  설명                      │  │
│   ├──────────────────┼────────────────┼────────────────────────────────────────────┤  │
│   │  HA 활성화       │      예        │  클러스터 레벨 HA 활성화                   │  │
│   │  장애 감지 시간  │     30초       │  하트비트 타임아웃                         │  │
│   │  자동 재시작     │      예        │  장애 VM 자동 재시작                       │  │
│   │  재시작 우선순위 │ High/Med/Low   │  DB > App > Web > AI Worker               │  │
│   │  공유 스토리지   │   Ceph RBD     │  VM 재시작 시 데이터 유지                  │  │
│   │  DB 이중화       │  MariaDB 복제  │  Primary/Replica 구조                      │  │
│   │  모니터링        │ ABLESTACK Mold │  기본 제공 모니터링 기능 활용              │  │
│   └──────────────────┴────────────────┴────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 네트워크 연결 구조

> **보조 다이어그램**: VLAN과 VM 간 통신 경로

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           네트워크 연결 구조 (VLAN 기반)                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│                               ┌────────────────┐                                       │
│                               │   외부 네트워크 │                                       │
│                               │   (인터넷/WAN) │                                       │
│                               └───────┬────────┘                                       │
│                                       │                                                 │
│                               ┌───────▼────────┐                                       │
│                               │   방화벽/LB    │                                       │
│                               │  (VLAN 1 DMZ) │                                       │
│                               └───────┬────────┘                                       │
│                                       │                                                 │
│   ┌───────────────────────────────────┼───────────────────────────────────┐            │
│   │                                   │                                   │            │
│   ▼                                   ▼                                   ▼            │
│   ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐              │
│   │    VLAN 10        │   │    VLAN 20        │   │    VLAN 30        │              │
│   │   (부서 A 망)     │   │   (부서 B 망)     │   │   (부서 C 망)     │              │
│   │                   │   │                   │   │                   │              │
│   │  ┌─────────────┐  │   │  ┌─────────────┐  │   │  ┌─────────────┐  │              │
│   │  │ 부서 A 사용자│  │   │  │ 부서 B 사용자│  │   │  │ 부서 C 사용자│  │              │
│   │  └─────────────┘  │   │  └─────────────┘  │   │  └─────────────┘  │              │
│   │         │         │   │         │         │   │         │         │              │
│   │    문서 접근       │   │    문서 접근       │   │    문서 접근       │              │
│   │    (자기 부서만)   │   │    (자기 부서만)   │   │    (자기 부서만)   │              │
│   │                   │   │                   │   │                   │              │
│   └─────────┬─────────┘   └─────────┬─────────┘   └─────────┬─────────┘              │
│             │                       │                       │                         │
│             └───────────────────────┼───────────────────────┘                         │
│                                     │                                                  │
│                                     ▼                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 40 (서비스 망)                                    │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐                  │  │
│   │   │ web-01  │     │ web-02  │     │ app-01  │     │ app-02  │                  │  │
│   │   │ :80/443 │     │ :80/443 │     │ :8080   │     │ :8080   │                  │  │
│   │   └────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘                  │  │
│   │        │               │               │               │                        │  │
│   └────────┼───────────────┼───────────────┼───────────────┼────────────────────────┘  │
│            │               │               │               │                           │
│            └───────────────┴───────────────┴───────────────┘                           │
│                                     │                                                  │
│                                     ▼                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 50 (데이터 망)                                    │  │
│   │                                                                                 │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐                  │  │
│   │   │ai-worker│     │ai-train │     │ db-pri  │     │ db-rep  │                  │  │
│   │   │ :8000   │     │ :8000   │     │ :3306   │     │ :3306   │                  │  │
│   │   └────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘                  │  │
│   │        │               │               │               │                        │  │
│   └────────┼───────────────┼───────────────┼───────────────┼────────────────────────┘  │
│            │               │               │               │                           │
│            └───────────────┴───────────────┴───────────────┘                           │
│                            │                                                           │
│                            ▼                                                           │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 60 (스토리지 망)                                  │  │
│   │                                                                                 │  │
│   │                        Ceph 분산 스토리지                                        │  │
│   │   ┌─────────┐     ┌─────────┐     ┌─────────┐                                  │  │
│   │   │ OSD 1   │     │ OSD 2   │     │ OSD 3   │                                  │  │
│   │   └─────────┘     └─────────┘     └─────────┘                                  │  │
│   │                                                                                 │  │
│   │   스토리지 풀:                                                                  │  │
│   │   • 공동 문서 스토리지 (Alliance): 1TB                                          │  │
│   │   • 기밀 문서 스토리지 (Confidential): 500GB x 3 테넌트                         │  │
│   │   • 백업 풀: Alliance 1TB + Confidential 1.5TB                                  │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   ──────────────────────────────────────────────────────────────────────────────────   │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│   │                           VLAN 100 (관리 망)                                     │  │
│   │                                                                                 │  │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│   │   │                      ABLESTACK Mold (관리 콘솔)                          │   │  │
│   │   │                                                                         │   │  │
│   │   │   • VM 생성/삭제/시작/정지        • CPU/Memory/Disk 모니터링            │   │  │
│   │   │   • 호스트 상태 감시              • 알림 및 이벤트 관리                  │   │  │
│   │   │   • HA/Live Migration 관리        • 리소스 쿼터 관리                     │   │  │
│   │   │                                                                         │   │  │
│   │   │   ※ 별도 모니터링 VM 불필요 (Mold 기본 기능으로 충분)                   │   │  │
│   │   │                                                                         │   │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│   │                                                                                 │  │
│   └─────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
│   [VLAN 요약]                                                                          │
│   ┌────────────┬──────────────────────────────────────────────────────────────────┐   │
│   │  VLAN ID   │                          용도                                    │   │
│   ├────────────┼──────────────────────────────────────────────────────────────────┤   │
│   │    10      │  부서 A 전용 네트워크 (테넌트 격리)                              │   │
│   │    20      │  부서 B 전용 네트워크 (테넌트 격리)                              │   │
│   │    30      │  부서 C 전용 네트워크 (테넌트 격리)                              │   │
│   │    40      │  서비스 망 (웹, App 서버)                                        │   │
│   │    50      │  데이터 망 (AI Worker, DB Primary/Replica)                       │   │
│   │    60      │  스토리지 망 (Ceph 백엔드)                                       │   │
│   │   100      │  관리 망 (ABLESTACK Mold)                                        │   │
│   └────────────┴──────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Excalidraw 작성 가이드

### 7.1 권장 색상 코드

| 구분 | 색상 | Hex 코드 | 용도 |
|------|------|----------|------|
| **프론트엔드 계층** | 연한 파랑 | `#E3F2FD` | 웹 서버 |
| **애플리케이션 계층** | 연한 하늘 | `#E1F5FE` | App 서버 (Spring Boot) |
| **AI 처리 계층** | 연한 초록 | `#E8F5E9` | AI Worker, Model Train |
| **데이터 계층** | 연한 노랑 | `#FFF8E1` | DB Primary/Replica |
| **인프라** | 연한 보라 | `#F3E5F5` | HCI 호스트, Mold |
| **테넌트** | 연한 주황 | `#FFF3E0` | 부서별 영역 |
| **강조** | 빨강 | `#FFCDD2` | 장애, 경고 |
| **연결선** | 검정 | `#000000` | 데이터 흐름 |
| **메시지 큐** | 연한 분홍 | `#FCE4EC` | RabbitMQ |

### 7.2 아이콘/심볼 권장

| 구성 요소 | 심볼 | 설명 |
|----------|------|------|
| **VM** | 사각형 (둥근 모서리) | vCPU/Memory 스펙 표시 |
| **호스트** | 큰 사각형 | VM 포함 컨테이너 |
| **데이터베이스** | 원통형 | MariaDB |
| **큐** | 사각형 + 화살표 | RabbitMQ |
| **AI 모델** | 뇌 아이콘 또는 별 | KoBERT |
| **사용자** | 사람 아이콘 | 테넌트 사용자 |
| **장애** | X 표시 또는 빨간 테두리 | HA 시나리오 |
| **Mold** | 대시보드 아이콘 | ABLESTACK 관리 콘솔 |
| **복제** | 화살표 (단방향) | DB Replication |

### 7.3 다이어그램 우선순위

| 순위 | 다이어그램 | 목적 | 발표 시 |
|------|-----------|------|---------|
| **1** | 전체 아키텍처 구성도 | 전체 구조 이해 | 필수 |
| **2** | VM 배치 및 Anti-Affinity | HA 전략 설명 | 필수 |
| **3** | 서비스 데이터 흐름 | 동작 원리 설명 | 권장 |
| **4** | 고가용성(HA) 구조 | 장애 복구 설명 | 권장 |
| **5** | 리소스 풀 계층 구조 | 리소스 관리 설명 | 선택 |
| **6** | 네트워크 연결 구조 | 네트워크 팀 협업 시 | 선택 |

### 7.4 Excalidraw 작성 팁

```
1. 레이어 순서
   - 배경 영역 (VLAN, 계층) → 호스트 박스 → VM 박스 → 연결선 → 텍스트

2. 정렬
   - 계층별로 수평 정렬
   - 동일 서비스는 동일 높이에 배치
   - Anti-Affinity VM은 다른 호스트 박스 내에 배치
   - DB Primary/Replica는 서로 다른 Host에 배치

3. 연결선
   - 실선: 직접 통신
   - 점선: 비동기 통신 (메시지 큐 경유)
   - 화살표: 데이터 흐름 방향
   - 단방향 화살표: DB 복제 방향 (Primary → Replica)

4. 텍스트
   - VM 내부: 이름, 스펙 (4vCPU/8GB)
   - 호스트 상단: Host 1, Host 2, Host 3
   - 계층 레이블: 프론트엔드 계층, 애플리케이션 계층, AI 처리 계층, 데이터 계층 등

5. 크기 비율
   - Host 박스: 가장 큼
   - VM 박스: 중간
   - 아이콘/심볼: 작음
   - 폰트: 제목 24pt, 본문 14pt, 스펙 12pt

6. 메시지 큐 표현
   - RabbitMQ는 App 서버와 AI Worker 계층 사이에 배치
   - 점선 화살표로 비동기 연결 표현

7. DB 복제 표현
   - Primary → Replica 방향 화살표
   - "Semi-Sync Replication" 라벨 추가
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-02-06 | 초안 작성 - Excalidraw 기반 아키텍처 다이어그램 가이드 | - |
| 2.0 | 2026-02-06 | 구조 단순화: Elasticsearch 제거, 별도 모니터링 VM 제거 (ABLESTACK Mold 활용), 메시지 큐 연결 명확화 | - |
| 3.0 | 2026-02-06 | **사이징 문서 반영**: 8 VM 구조 (Web x2, App x2, AI Worker x1, AI Train x1, DB Pri x1, DB Rep x1), PostgreSQL → MariaDB 변경, Web/App 계층 분리, MariaDB Replication HA 구성 추가 | - |

---

## 관련 문서

- [00_사이징.md](00_사이징.md) - 사이징 가정서 및 요청서
- [04_컴퓨트_설계서.md](04_컴퓨트_설계서.md) - 컴퓨트 상세 설계
- [05_네트워크_보안_설계서.md](05_네트워크_보안_설계서.md) - 네트워크/보안 설계 (VLAN 상세)
- [06_스토리지_설계서.md](06_스토리지_설계서.md) - 스토리지 설계 (Ceph 연계)
- [01_프로젝트_개요서.md](01_프로젝트_개요서.md) - 프로젝트 전체 개요
